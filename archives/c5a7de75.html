<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Shell 脚本编程 | 穿着草鞋前往</title><meta name="author" content="Wu Hao"><meta name="copyright" content="Wu Hao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Shell脚本的基本使用 流程控制 函数 高级变量等"><link rel="shortcut icon" href="/img/image.jpg"><link rel="canonical" href="https://wuhaolam.github.io/archives/c5a7de75.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-sPKc2fWStl"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Shell 脚本编程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-16 15:12:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/%E5%A4%B4%E5%83%8F.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="穿着草鞋前往"><span class="site-name">穿着草鞋前往</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Shell 脚本编程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-25T01:22:00.000Z" title="发表于 2022-09-25 09:22:00">2022-09-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-16T07:12:55.612Z" title="更新于 2023-04-16 15:12:55">2023-04-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Shell%E8%84%9A%E6%9C%AC/">Shell脚本</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Shell 脚本编程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一、Shell-脚本的基本用法"><a href="#一、Shell-脚本的基本用法" class="headerlink" title="一、Shell 脚本的基本用法"></a>一、Shell 脚本的基本用法</h2><h3 id="1-1-Shell-脚本的用途"><a href="#1-1-Shell-脚本的用途" class="headerlink" title="1.1 Shell 脚本的用途"></a>1.1 Shell 脚本的用途</h3><ul>
<li>将简单的命令进行组合完成复杂的工作，能够自动化执行，从而提高工作效率</li>
<li>减少命令的重复输入</li>
<li>将软件或应用的安装及配置实现标准化</li>
<li>方便日常性、重复性的运维工作实现，如：文件的打包压缩备份、监控系统的运行状态等</li>
</ul>
<h3 id="1-2-Shell-脚本的基本结构"><a href="#1-2-Shell-脚本的基本结构" class="headerlink" title="1.2 Shell 脚本的基本结构"></a>1.2 Shell 脚本的基本结构</h3><p>Shell 脚本编程：是基于过程式、解释执行的语言</p>
<p>Shell 脚本：包含一些命令或声明，符合一定格式的文本文件，首行需shebang机制</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shebang机制如下类型</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#!/usr/bin/perl</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-Shell-脚本注释规范"><a href="#1-3-Shell-脚本注释规范" class="headerlink" title="1.3 Shell 脚本注释规范"></a>1.3 Shell 脚本注释规范</h3><p>（1）首行为调用使用的语言，即shebang机制</p>
<p>（2）程序名，避免因更改文件名而无法找到正确的文件 </p>
<p>（3）该脚本的版本号</p>
<p>（4）更改后的时间</p>
<p>（5）作者的相关信息</p>
<p>（6）该程序的作用及注意事项</p>
<p>（7）各版本的更新简要说明</p>
<h3 id="1-4-第一个简单Shell脚本示例"><a href="#1-4-第一个简单Shell脚本示例" class="headerlink" title="1.4 第一个简单Shell脚本示例"></a>1.4 第一个简单Shell脚本示例</h3><p><strong>示例：第一个脚本示例</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># vim /shell/hello.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#----------------------------------------------</span></span><br><span class="line"><span class="comment"># Filename:       hello.sh</span></span><br><span class="line"><span class="comment"># Version:        1.0</span></span><br><span class="line"><span class="comment"># Date:           2022/10/01</span></span><br><span class="line"><span class="comment"># Author:         Herbert</span></span><br><span class="line"><span class="comment"># Email:          wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># Website:        wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># Description:    This is the first script</span></span><br><span class="line"><span class="comment">#----------------------------------------------</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;Hello, world!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行方式1</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># bash /shell/hello.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行方式2</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cat /shell/hello.sh | bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行方式3</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># bash &lt; /shell/hello.sh </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行方式4</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># chmod +x /shell/hello.sh</span></span><br><span class="line"><span class="comment">## 绝对路径</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># /shell/hello.sh</span></span><br><span class="line"><span class="comment">## 相对路径</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cd /shell</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># ./hello.sh</span></span><br></pre></td></tr></table></figure>

<h3 id="1-5-脚本调试"><a href="#1-5-脚本调试" class="headerlink" title="1.5 脚本调试"></a>1.5 脚本调试</h3><p>只检测脚本中的语法错误，不检查命令错误，并不执行脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -n /path/script</span><br></pre></td></tr></table></figure>

<p>调试并执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bash -x /path/script</span><br><span class="line"></span><br><span class="line">[root@centos7 shell]<span class="comment"># bash -x hello.sh </span></span><br><span class="line">+ <span class="built_in">echo</span> <span class="string">&#x27;Hello, world!&#x27;</span></span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure>

<p>注：常见的三种脚本错误方式</p>
<ul>
<li>语法错误，后续命令将无法执行，使用 bash -n 检查错误，提示的出错行数不一定准确</li>
<li>命令错误，默认后续的命令还会执行，使用 bash -x 进行观察</li>
<li>逻辑错误，只能使用 bash -x 进行观察</li>
</ul>
<h3 id="1-6-变量"><a href="#1-6-变量" class="headerlink" title="1.6 变量"></a>1.6 变量</h3><h4 id="1-6-1-变量"><a href="#1-6-1-变量" class="headerlink" title="1.6.1 变量"></a>1.6.1 变量</h4><p>变量表示命名的内存空间，将数据放在内存空间中，通过变量名的引用来获取数据</p>
<h4 id="1-6-2-Shell-中变量的命名法则"><a href="#1-6-2-Shell-中变量的命名法则" class="headerlink" title="1.6.2 Shell 中变量的命名法则"></a>1.6.2 Shell 中变量的命名法则</h4><p><strong>1、命名要求</strong></p>
<ul>
<li>区分大小写</li>
<li>不能使用程序中的保留字和内置变量</li>
<li>只能使用字母、数字、下划线，不能以数字开头，不支持短横线 “-”</li>
</ul>
<p><strong>2、命名习惯</strong></p>
<ul>
<li>见名知义，用英文命名，体现出实际作用，不可用简写，如：ATM</li>
<li>变量名要大写</li>
<li>局部变量小写</li>
<li>函数名小写</li>
<li>大驼峰形式：StudentFirstName</li>
<li>小驼峰形式：studentFirstName</li>
<li>下划线：student_name</li>
</ul>
<h4 id="1-6-3-变量的定义和引用"><a href="#1-6-3-变量的定义和引用" class="headerlink" title="1.6.3 变量的定义和引用"></a>1.6.3 变量的定义和引用</h4><p>变量的类型</p>
<ul>
<li>普通变量：生效范围为当前shell进程；对当前 shell 之外的其它 shell 进程，或当前 shell 的子 shell 进程均无效</li>
<li>环境变量：生效范围为当前shell及其子进程</li>
<li>本地变量：生效范围为当前shell进程中某代码片段，通常指某段函数中</li>
</ul>
<p>变量赋值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">&#x27;value&#x27;</span></span><br><span class="line"></span><br><span class="line">value 形式如下：</span><br><span class="line">	直接字符串: name=<span class="string">&#x27;root&#x27;</span></span><br><span class="line">	变量引用: name=<span class="string">&quot;<span class="variable">$USER</span>&quot;</span></span><br><span class="line">	命令引用: name=`COMMAND` 或 name=$(COMMAND)</span><br><span class="line">	</span><br><span class="line"><span class="comment">#	注：变量赋值是临时生效，当退出终端后，变量会自动删除，无法持久保存，脚本中的变量会随着脚本结束自动删除</span></span><br></pre></td></tr></table></figure>

<p>变量引用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$name</span></span><br><span class="line"><span class="variable">$&#123;name&#125;</span></span><br></pre></td></tr></table></figure>

<p>弱引用和强引用</p>
<ul>
<li>“$name”      弱引用，其中定义的变量会被替换为变量值</li>
<li>‘$name’       强引用，定义的变量不会被替换为变量值，引号中是什么就会输出什么</li>
</ul>
<p>显示定义的变量和删除变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span></span><br><span class="line"><span class="built_in">unset</span> &lt;name&gt;</span><br></pre></td></tr></table></figure>

<p><strong>示例：变量的各种赋值和引用</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># echo &quot;I am $NAME&quot;</span></span><br><span class="line">I am Herbert</span><br><span class="line">[root@centos7 ~]<span class="comment"># echo &#x27;I am $NAME&#x27;</span></span><br><span class="line">I am <span class="variable">$NAME</span></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># NAME=$USER</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># echo $NAME</span></span><br><span class="line">root</span><br><span class="line">[root@centos7 ~]<span class="comment"># NAME=`whoami`</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># echo $NAME</span></span><br><span class="line">root</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># FILE=`ls /run`</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># echo $FILE</span></span><br><span class="line">auditd.pid console crond.pid cron.reboot cryptsetup dbus dhclient-eth0.pid dmeventd-client dmeventd-server faillock httpd initramfs lock <span class="built_in">log</span> lvm lvmetad.pid mount netreport NetworkManager plymouth sepermit setrans sshd.pid sudo syslogd.pid systemd tmpfiles.d tuned udev user utmp vmware</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># FILE=/etc/*;echo $FILE</span></span><br><span class="line">/etc/adjtime /etc/aliases /etc/aliases.db /etc/alternatives /etc/anacrontab</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># NUM=`seq 3`;echo $NUM</span></span><br><span class="line">1 2 3</span><br><span class="line">[root@centos7 ~]<span class="comment"># NUM=`seq 3`;echo &quot;$NUM&quot;</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># NAMES=&quot;zhao</span></span><br><span class="line">&gt; qian</span><br><span class="line">&gt; sun</span><br><span class="line">&gt; li<span class="string">&quot;</span></span><br><span class="line"><span class="string">[root@centos7 ~]# echo <span class="variable">$NAMES</span></span></span><br><span class="line"><span class="string">zhao qian sun li</span></span><br><span class="line"><span class="string">[root@centos7 ~]# echo &quot;</span><span class="variable">$NAMES</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">zhao</span></span><br><span class="line"><span class="string">qian</span></span><br><span class="line"><span class="string">sun</span></span><br><span class="line"><span class="string">li</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@centos7 ~]# NAME=Herbert</span></span><br><span class="line"><span class="string">[root@centos7 ~]# AGE=20</span></span><br><span class="line"><span class="string">[root@centos7 ~]# echo $NAME_<span class="variable">$AGE</span></span></span><br><span class="line"><span class="string">20</span></span><br><span class="line"><span class="string">[root@centos7 ~]# echo <span class="variable">$&#123;NAME&#125;</span>_<span class="variable">$AGE</span></span></span><br><span class="line"><span class="string">Herbert_20</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 利用变量实现动态命令</span></span><br><span class="line"><span class="string">[root@centos7 ~]# CMD=hostname</span></span><br><span class="line"><span class="string">[root@centos7 ~]# <span class="variable">$CMD</span></span></span><br><span class="line"><span class="string">centos7</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 删除定义的变量</span></span><br><span class="line"><span class="string">[root@centos7 ~]# NAME=Herbert;echo <span class="variable">$NAME</span></span></span><br><span class="line"><span class="string">Herbert</span></span><br><span class="line"><span class="string">[root@centos7 ~]# unset NAME;echo <span class="variable">$NAME</span></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<h5 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h5><p>1、编写脚本 systeminfo.sh，显示当前主机系统信息，包括:主机名，IPv4地址，操作系统版本，内核<br>版本，CPU型号，内存大小，硬盘大小</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment"># cat systeminfo.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : systeminfo.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 2.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-03</span></span><br><span class="line"><span class="comment"># * Description   : display information about the system</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line">RED=<span class="string">&quot;\E[1;31m&quot;</span></span><br><span class="line">GREEN=<span class="string">&quot;\E[1;32m&quot;</span></span><br><span class="line">END=<span class="string">&quot;\E[0m&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$GREEN</span>---------------------Host Systeminfo-------------------------<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;HOSTNAME:           <span class="variable">$RED</span>`hostname`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;IPADDR:             <span class="variable">$RED</span>`ifconfig eth0 | awk &#x27;/\&lt;inet\&gt;/&#123;print <span class="variable">$2</span>&#125;&#x27;`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;OSVersion:          <span class="variable">$RED</span>`cat /etc/redhat-release`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;KERNAL:             <span class="variable">$RED</span>`uname -r`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;CPU:                <span class="variable">$RED</span>`lscpu | grep &#x27;Model name&#x27; | tr -s &#x27; &#x27;|cut -d : -f2`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;MEMORY:             <span class="variable">$RED</span>`free -h | awk &#x27;/^Mem/&#123;print <span class="variable">$2</span>&#125;&#x27;`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;DISK:               <span class="variable">$RED</span>`lsblk | awk -v ORS=&#x27;,&#x27; &#x27;/^sd/&#123;print <span class="variable">$1</span>,<span class="variable">$4</span>&#125;&#x27;`<span class="variable">$END</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$GREEN</span>---------------------      END      -------------------------<span class="variable">$END</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>2、编写脚本 backup.sh，可实现每日将 &#x2F;etc&#x2F; 目录备份到 &#x2F;backup&#x2F;etcYYYY-mm-dd中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment"># cat backup.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32mStart Backup\E[0m&quot;</span></span><br><span class="line">[ -d /backup ] || <span class="built_in">mkdir</span> /backup</span><br><span class="line"><span class="built_in">cp</span> -a /etc /backup/etc_`<span class="built_in">date</span> +%F`</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32mBackup finished\E[0m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每天的凌晨2点运行脚本</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># crontab -e</span></span><br><span class="line"> * 2 * * * <span class="string">&quot;bash /shell/backup.sh&quot;</span></span><br></pre></td></tr></table></figure>

<p>3、编写脚本 disk.sh，显示当前硬盘分区中空间利用率最大的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment"># vim disk_utilization_rate.sh</span></span><br><span class="line">Most_Disk_Rate=`<span class="built_in">df</span> -Th | awk <span class="string">&#x27;/^\/dev\/sd/&#123;print $6&#125;&#x27;</span> | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n1`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;磁盘空间利用率最大值为：<span class="variable">$Most_Disk_Rate</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-6-4-环境变量"><a href="#1-6-4-环境变量" class="headerlink" title="1.6.4 环境变量"></a>1.6.4 环境变量</h4><p>环境变量的特点</p>
<ul>
<li>子进程可以继承父进程的变量，但父进程无法使用子进程的变量</li>
<li>一旦子进程修改从父进程继承的变量，新的值将会传递给孙子进程</li>
<li>一般在系统配置文件中使用，脚本中使用较少</li>
</ul>
<p>变量的声明和赋值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 声明并赋值</span></span><br><span class="line"><span class="built_in">export</span> name=value</span><br><span class="line"><span class="built_in">declare</span> -x name=value</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分步实现</span></span><br><span class="line">name=value</span><br><span class="line"><span class="built_in">export</span> name</span><br></pre></td></tr></table></figure>

<p>变量的引用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$name</span></span><br><span class="line"><span class="variable">$&#123;name&#125;</span></span><br></pre></td></tr></table></figure>

<p>显示所有环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">env</span></span><br><span class="line"><span class="built_in">printenv</span></span><br><span class="line"><span class="built_in">export</span></span><br><span class="line"><span class="built_in">declare</span> -x</span><br></pre></td></tr></table></figure>

<p>查看指定进程的环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/<span class="variable">$PID</span>/environ</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># cat /proc/1495/environ | tr &#x27;\0&#x27; &#x27;\n&#x27;</span></span><br><span class="line">USER=root</span><br><span class="line">LOGNAME=root</span><br><span class="line">HOME=/root</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin</span><br><span class="line">MAIL=/var/mail/root</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">SSH_CLIENT=192.168.119.1 12198 22</span><br><span class="line">SSH_CONNECTION=192.168.119.1 12198 192.168.119.165 22</span><br><span class="line">SSH_TTY=/dev/pts/0</span><br><span class="line">TERM=xterm</span><br><span class="line">XDG_SESSION_ID=1</span><br><span class="line">XDG_RUNTIME_DIR=/run/user/0</span><br></pre></td></tr></table></figure>

<p>删除变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> name</span><br></pre></td></tr></table></figure>

<h4 id="1-6-5-只读变量"><a href="#1-6-5-只读变量" class="headerlink" title="1.6.5 只读变量"></a>1.6.5 只读变量</h4><p>​	只能声明定义，后续不能修改和删除，即常量</p>
<p>声明只读变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">readonly</span> name</span><br><span class="line"><span class="built_in">declare</span> -r name</span><br></pre></td></tr></table></figure>

<p>查看只读变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">readonly</span></span><br><span class="line"><span class="built_in">declare</span> -r</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># readonly PI=3.14159;echo $PI</span></span><br><span class="line">3.14159</span><br><span class="line">[root@centos7 ~]<span class="comment"># PI=3.14</span></span><br><span class="line">-bash: PI: <span class="built_in">readonly</span> variable</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># exit</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># echo $PI</span></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<h4 id="1-6-6-位置变量"><a href="#1-6-6-位置变量" class="headerlink" title="1.6.6 位置变量"></a>1.6.6 位置变量</h4><p>​	在bash shell中内置的变量，在脚本代码中通过调用命令行传递给脚本的参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$1</span>,<span class="variable">$2</span>,<span class="variable">$3</span>,··· 对应第1、第2、第3个等参数，<span class="built_in">shift</span> [n]换位置</span><br><span class="line"><span class="variable">$0</span>	命令本身，包括路径</span><br><span class="line">$*	传递给脚本的所有参数，全部参数合并成一个字符串</span><br><span class="line"><span class="variable">$@</span>	传递给脚本的所有参数，每个参数为独立字符串</span><br><span class="line"><span class="variable">$#</span>	传递给脚本的参数个数</span><br><span class="line"></span><br><span class="line">$*和<span class="variable">$@</span> 只在被双引号包起来的时候才会有差异</span><br><span class="line"></span><br><span class="line">清空所有位置变量</span><br><span class="line"><span class="built_in">set</span> --</span><br></pre></td></tr></table></figure>

<p><strong>示例1</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 位置变量的简单使用</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cat /shell/arg.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : arg.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-03</span></span><br><span class="line"><span class="comment"># * Description   : 位置变量的简单使用</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1st arg is <span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2st arg is <span class="variable">$2</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;3st arg is <span class="variable">$3</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;10st arg is <span class="variable">$&#123;10&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;11st arg is <span class="variable">$&#123;11&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The number of arg is <span class="variable">$#</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;All args are: $*&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;All args are: <span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The script path is <span class="variable">$0</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The scriptname is `basename <span class="variable">$0</span>`&quot;</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># bash /shell/arg.sh &#123;a..z&#125;</span></span><br><span class="line">1st arg is a</span><br><span class="line">2st arg is b</span><br><span class="line">3st arg is c</span><br><span class="line">10st arg is j</span><br><span class="line">11st arg is k</span><br><span class="line">The number of arg is 26</span><br><span class="line">All args are: a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br><span class="line">All args are: a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br><span class="line">The script path is /shell/arg.sh</span><br><span class="line">The scriptname is arg.sh</span><br></pre></td></tr></table></figure>

<p><strong>示例2</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $* 和 $@ 的区别</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># cat f1.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;f1.sh: all args are <span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;f1.sh: all args are $*&quot;</span></span><br><span class="line"></span><br><span class="line">./file.sh <span class="string">&quot;$*&quot;</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># cat f2.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;f2.sh: all args are <span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;f2.sh: all args are $*&quot;</span></span><br><span class="line"></span><br><span class="line">./file.sh <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># cat file.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;file.sh: 1st arg is <span class="variable">$1</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## $*将所有的参数作为一个整体进行传递，而$@将所有参数当作独立的参数全部传递过去</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># bash f1.sh a b c</span></span><br><span class="line">f1.sh: all args are a b c</span><br><span class="line">f1.sh: all args are a b c</span><br><span class="line">file.sh: 1st arg is a b c</span><br><span class="line">[root@centos7 shell]<span class="comment"># bash f2.sh a b c</span></span><br><span class="line">f2.sh: all args are a b c</span><br><span class="line">f2.sh: all args are a b c</span><br><span class="line">file.sh: 1st arg is a</span><br></pre></td></tr></table></figure>

<p><strong>示例3</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用软链接实现同一个脚本的不同功能</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$0</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># ln -s test.sh a.sh</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># ln -s test.sh b.sh</span></span><br><span class="line"></span><br><span class="line">[root@centos7 shell]<span class="comment"># bash a.sh </span></span><br><span class="line">a.sh</span><br><span class="line">[root@centos7 shell]<span class="comment"># bash b.sh </span></span><br><span class="line">b.sh</span><br></pre></td></tr></table></figure>

<p><strong>示例4</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删库跑路命令安全实现</span></span><br><span class="line">[root@centos7 shell]<span class="comment"># cat rm.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">DIR=/tmp/`<span class="built_in">date</span> +%F_%T`</span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$DIR</span></span><br><span class="line"><span class="built_in">mv</span> $* <span class="variable">$DIR</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Move  $* to <span class="variable">$DIR</span>&quot;</span></span><br><span class="line"></span><br><span class="line">[root@centos7 shell]<span class="comment"># chmod +x rm.sh </span></span><br><span class="line">[root@centos7 shell]<span class="comment"># alias rm=&#x27;/shell/rm.sh&#x27;</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># touch &#123;1..5&#125;.txt</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># rm *.txt</span></span><br><span class="line">Move  1.txt 2.txt 3.txt 4.txt 5.txt to /tmp/2022-10-03_21:57:42</span><br></pre></td></tr></table></figure>

<h4 id="1-6-7-退出状态码变量"><a href="#1-6-7-退出状态码变量" class="headerlink" title="1.6.7 退出状态码变量"></a>1.6.7 退出状态码变量</h4><p>​	进程执行后，将使用变量$?保存状态码的相关数字，不同的值反映出成功或失败，$?取值范围0~255</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$? 为0，进程返回状态为成功 </span><br><span class="line">$? 为1~255，失败</span><br></pre></td></tr></table></figure>

<p>用户可以在脚本中自定义退出的状态码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span> [n]</span><br></pre></td></tr></table></figure>

<p>注意</p>
<ul>
<li>脚本中一旦遇到 exit 命令，脚本会立即终止；终止退出的状态取决于 exit 命令后面的数字</li>
<li>如果 exit 后面无数字，终止退出状态取决于 exit 命令前面命令执行结果</li>
<li>如果没有给脚本指定退出状态码，整个脚本的退出状态码取决于脚本中执行的最后一条命令的状态码</li>
</ul>
<h4 id="1-6-8-展开命令行"><a href="#1-6-8-展开命令行" class="headerlink" title="1.6.8 展开命令行"></a>1.6.8 展开命令行</h4><p>展开命令执行顺序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">把命令行分成单个命令词</span><br><span class="line">展开别名</span><br><span class="line">展开大括号的声明&#123;&#125;</span><br><span class="line">展开波浪符声明 ~</span><br><span class="line">命令替换$() 和 ``</span><br><span class="line">再次把命令行分成命令词</span><br><span class="line">展开文件通配*、?、[abc]等等</span><br><span class="line">准备I/0重导向 &lt;、&gt;</span><br><span class="line">运行命令</span><br></pre></td></tr></table></figure>

<h4 id="1-6-9-脚本安全和set"><a href="#1-6-9-脚本安全和set" class="headerlink" title="1.6.9 脚本安全和set"></a>1.6.9 脚本安全和set</h4><p>set 命令：可以用来定制 shell 环境</p>
<p><strong>$- 变量</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">h: hashall，打开选项后，Shell 会将命令所在的路径<span class="built_in">hash</span>下来，避免每次都要查询。通过<span class="built_in">set</span> +h将h选项关闭</span><br><span class="line">i: interactive-comments，包含这个选项说明当前的 shell 是一个交互式的 shell。所谓的交互式shell,在脚本中，i选项是关闭的</span><br><span class="line">m: monitor，打开监控模式，就可以通过Job control来控制进程的停止、继续，后台或者前台执行等</span><br><span class="line">B: braceexpand，大括号扩展</span><br><span class="line">H: <span class="built_in">history</span>，H选项打开，可以展开历史列表中的命令，可以通过!感叹号来完成，例如“!!”返回上最近的一个历史命令，“!n”返回第 n 个历史命令</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $-</span></span><br><span class="line">himBHs</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># set +h</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $-</span></span><br><span class="line">imBHs</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># hash</span></span><br><span class="line">-bash: <span class="built_in">hash</span>: hashing disabled</span><br></pre></td></tr></table></figure>

<p><strong>set 命令实现脚本安全</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">-u	在扩展一个没有设置的变量时，显示错误信息，等同 <span class="built_in">set</span> -o nounset</span><br><span class="line">-e	如果一个命令返回一个非0退出状态值就退出，等同 <span class="built_in">set</span> -o errexit</span><br><span class="line">-o	option	显示，打开或关闭选项</span><br><span class="line">    <span class="built_in">set</span> -o	显示选项</span><br><span class="line">    <span class="built_in">set</span> -o 选项	打开选项</span><br><span class="line">    <span class="built_in">set</span> +o 选项	关闭选项</span><br><span class="line">-x	当执行命令时，打印命令及其参数，类似 bash -x</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># set -o</span></span><br><span class="line">allexport       off</span><br><span class="line">braceexpand     on</span><br><span class="line">emacs           on</span><br><span class="line">errexit         off</span><br><span class="line">errtrace        off</span><br><span class="line">functrace       off</span><br><span class="line">hashall         off</span><br><span class="line">histexpand      on</span><br><span class="line"><span class="built_in">history</span>         on</span><br><span class="line">ignoreeof       off</span><br><span class="line">interactive-comments    on</span><br><span class="line">keyword         off</span><br><span class="line">monitor         on</span><br><span class="line">noclobber       off</span><br><span class="line">noexec          off</span><br><span class="line"><span class="built_in">noglob</span>          off</span><br><span class="line">nolog           off</span><br><span class="line">notify          off</span><br><span class="line">nounset         off</span><br><span class="line">onecmd          off</span><br><span class="line">physical        off</span><br><span class="line">pipefail        off</span><br><span class="line">posix           off</span><br><span class="line">privileged      off</span><br><span class="line">verbose         off</span><br><span class="line">vi              off</span><br><span class="line">xtrace          off</span><br></pre></td></tr></table></figure>

<h3 id="1-7-格式化输出-printf"><a href="#1-7-格式化输出-printf" class="headerlink" title="1.7 格式化输出 printf"></a>1.7 格式化输出 printf</h3><p><strong>常用格式替换符</strong></p>
<table>
<thead>
<tr>
<th>替换符</th>
<th align="left">功能</th>
</tr>
</thead>
<tbody><tr>
<td>%s</td>
<td align="left">字符串</td>
</tr>
<tr>
<td>%d,%i</td>
<td align="left">十进制整数</td>
</tr>
<tr>
<td>%f</td>
<td align="left">浮点格式</td>
</tr>
<tr>
<td>%c</td>
<td align="left">ASCII字符</td>
</tr>
<tr>
<td>%b</td>
<td align="left">相对应的参数中包含转义字符，可对转义字符进行转义</td>
</tr>
<tr>
<td>%o</td>
<td align="left">八进制值</td>
</tr>
<tr>
<td>%u</td>
<td align="left">无符号十进制值</td>
</tr>
<tr>
<td>%x</td>
<td align="left">小写的十六进制 a~f</td>
</tr>
<tr>
<td>%X</td>
<td align="left">大写的十六进制 A~F</td>
</tr>
<tr>
<td>%%</td>
<td align="left">%本身</td>
</tr>
</tbody></table>
<p>说明</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%<span class="comment">#s	中的数字代表此替换符中的输出字符宽度，不足补空格，默认右对齐。%-10s表示10个字符宽，- 表示左对齐</span></span><br><span class="line">%03d	表示<span class="number">3</span>为宽度，不足前面用<span class="number">0</span>补全，超出位数原样输出</span><br><span class="line">%<span class="number">.2</span>f	表示保留<span class="number">2</span>位小数</span><br></pre></td></tr></table></figure>

<p><strong>常用转义字符</strong></p>
<table>
<thead>
<tr>
<th align="left">转义符</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td align="left">\a</td>
<td>警告字符，通常为ASCII中的BEL字符</td>
</tr>
<tr>
<td align="left">\b</td>
<td>后退</td>
</tr>
<tr>
<td align="left">\f</td>
<td>换页</td>
</tr>
<tr>
<td align="left">\n</td>
<td>换行</td>
</tr>
<tr>
<td align="left">\r</td>
<td>回车</td>
</tr>
<tr>
<td align="left">\t</td>
<td>水平制表符</td>
</tr>
<tr>
<td align="left">\v</td>
<td>垂直制表符</td>
</tr>
<tr>
<td align="left">\\</td>
<td>表示\本身</td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># printf &quot;%s&quot; 1 2 3 4</span></span><br><span class="line">1234[root@centos7 ~]<span class="comment">#</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># printf &quot;%s %s %s %s \n&quot;  1 2 3 4</span></span><br><span class="line">1 2 3 4 </span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># printf &quot;%.2f\n&quot; 2.458 </span></span><br><span class="line">2.46</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># strvar=&quot;I love you&quot;;printf &quot;\033[1;32m%s\033[0m\n&quot; &quot;$strvar&quot;</span></span><br><span class="line">I love you</span><br></pre></td></tr></table></figure>

<h3 id="1-8-算数运算"><a href="#1-8-算数运算" class="headerlink" title="1.8 算数运算"></a>1.8 算数运算</h3><p>注：bash 只支持整数，不支持小数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ARITHMETIC EVALUATION</span><br><span class="line">       The shell allows arithmetic expressions to be evaluated, under certain circumstances (see the <span class="built_in">let</span> and <span class="built_in">declare</span> <span class="built_in">builtin</span>  commands  and  Arithmetic Expansion).   Evaluation  is  <span class="keyword">done</span>  <span class="keyword">in</span> fixed-width integers with no check <span class="keyword">for</span> overflow, though division by 0 is trapped and flagged as an error.</span><br><span class="line">       The operators and their precedence, associativity, and values are the same as <span class="keyword">in</span> the C language.  The following list  of  operators  is  grouped into levels of equal-precedence operators.  The levels are listed <span class="keyword">in</span> order of decreasing precedence.</span><br><span class="line"></span><br><span class="line">* / %			multiplication, division, remainder, %表示取模，即取余数，示例：9%4=1，5%3=2</span><br><span class="line">+ - 			addition, subtraction</span><br><span class="line">i++ i--			variable post-increment and post-decrement</span><br><span class="line">++i --i 		variable pre-increment and pre-decrement</span><br><span class="line">= *= /= %= += -= &lt;&lt;= &gt;&gt;= &amp;= ^= |=		assignment</span><br><span class="line">- + 			unary minus and plus</span><br><span class="line">! ~ 			logical and bitwise negation</span><br><span class="line">** 				exponentiation 乘方,即指数运算</span><br><span class="line">&lt;&lt; &gt;&gt; 			left and right bitwise shifts</span><br><span class="line">&lt;= &gt;= &lt; &gt; 		comparison</span><br><span class="line">== != 			equality and inequality</span><br><span class="line">&amp; 				bitwise AND</span><br><span class="line">| 				bitwise OR</span><br><span class="line">^ 				bitwise exclusive OR</span><br><span class="line">&amp;&amp; 				logical AND</span><br><span class="line">|| 				logical OR</span><br><span class="line"><span class="built_in">expr</span>?<span class="built_in">expr</span>:<span class="built_in">expr</span> 				conditional operator</span><br><span class="line">expr1 , expr2 comma</span><br></pre></td></tr></table></figure>

<p>算数运算实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(1)	<span class="built_in">let</span> var=算术表达式</span><br><span class="line">(2)	((var=算术表达式))</span><br><span class="line">(3)	var=$[算术表达式]</span><br><span class="line">(4)	var=$((算术表达式))</span><br><span class="line">(5)	var=$(<span class="built_in">expr</span> arg1 arg2 arg3 ...)</span><br><span class="line">(6)	<span class="built_in">declare</span> -i var = 数值</span><br><span class="line">(7)	<span class="built_in">echo</span> <span class="string">&#x27;算术表达式&#x27;</span> | bc</span><br><span class="line"></span><br><span class="line">随机数生成器	<span class="variable">$RANDOM</span></span><br><span class="line">	ooa random <span class="built_in">integer</span> between 0 and 32767 is generated.</span><br><span class="line">	</span><br><span class="line"><span class="comment">## 注：乘法符号在有些场景需要转义</span></span><br><span class="line"><span class="comment"># mul=$(expr $num1 \* $num2)</span></span><br></pre></td></tr></table></figure>

<p>示例：随机字体颜色生成</p>
<p><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221004172137142.png" alt="image-20221004172137142"></p>
<p>增强型赋值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+=	i+=10 等同于 i=i+10</span><br><span class="line">-=</span><br><span class="line">*=</span><br><span class="line">/=</span><br><span class="line">%=</span><br><span class="line">++	i++ ++i</span><br><span class="line">--	i-- --i</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(1)</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># num1=3</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># num2=5</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># let sum=$num1+$num2</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $sum</span></span><br><span class="line">8</span><br><span class="line">(2)</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo &quot;The sum is $[$num1+$num2]&quot;</span></span><br><span class="line">The <span class="built_in">sum</span> is 8</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo &quot;The sum is $(($num1+$num2))&quot;</span></span><br><span class="line">The <span class="built_in">sum</span> is 8</span><br><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># echo &quot;$((num1+num2))&quot;</span></span><br><span class="line">8</span><br><span class="line">(3)</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mul=$(expr $num1 \* $num2);echo $mul</span></span><br><span class="line">15</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mul=$[$num1 * $num2];echo $mul</span></span><br><span class="line">15</span><br><span class="line">(4)</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $RANDOM</span></span><br><span class="line">14098</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $RANDOM</span></span><br><span class="line">3320</span><br></pre></td></tr></table></figure>

<h3 id="1-9-逻辑运算"><a href="#1-9-逻辑运算" class="headerlink" title="1.9 逻辑运算"></a>1.9 逻辑运算</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">与	&amp;			0&amp;0=0；0&amp;1=0；1&amp;1=1</span><br><span class="line">或	|           0&amp;0=0；0&amp;1=1；1&amp;1=1</span><br><span class="line">非	!			取反；!0=1</span><br><span class="line">异或	^         相同为假，不同为真</span><br><span class="line">短路与	&amp;&amp;</span><br><span class="line">短路或	||</span><br></pre></td></tr></table></figure>

<p>示例：关于异或运算达成数值的交换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 两个数字x，y异或得z；z和任意一个数字x或y做异或运算，得到另一个数字y或x</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># x=10;y=20;x=$[x^y];y=$[x^y];x=$[x^y];echo &quot;x=$x,y=$y&quot;</span></span><br><span class="line">x=20,y=10</span><br></pre></td></tr></table></figure>

<p>示例：关于短路运算</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 短路与 &amp;&amp;</span></span><br><span class="line">CMD1 &amp;&amp; CMD2</span><br><span class="line">CMD1结果为真 (1)，第二个CMD2必须要参与运算，才能得到最终的结果</span><br><span class="line">CMD1结果为假 (0)，总的结果必定为0，因此不需要执行CMD2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 短路或 ||</span></span><br><span class="line">CMD1 || CMD2</span><br><span class="line">CMD1结果为真 (1)，总的结果必定为1，因此不需要执行CMD2</span><br><span class="line">CMD1结果为假 (0)，第二个CMD2 必须要参与运算,才能得到最终的结果</span><br></pre></td></tr></table></figure>

<h3 id="1-10-条件测试命令"><a href="#1-10-条件测试命令" class="headerlink" title="1.10 条件测试命令"></a>1.10 条件测试命令</h3><p>条件测试：判断某需求是否满足；若条件测试为真，则返回的状态码$?为0；反之则不为0</p>
<p>条件测试命令</p>
<ul>
<li>test EXPRESSION</li>
<li>[ EXPRESSION ]</li>
<li>[[ EXPRESSION ]]    支持扩展的正则表达式和通配符</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># type [</span></span><br><span class="line">[ is a shell <span class="built_in">builtin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注：括号中的 EXPRESSION 两边一定要有空白字符</span></span><br></pre></td></tr></table></figure>

<p>bash 中的测试类型查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># help test</span></span><br><span class="line"><span class="built_in">test</span>: <span class="built_in">test</span> [<span class="built_in">expr</span>]</span><br><span class="line">    Evaluate conditional expression.</span><br><span class="line">    </span><br><span class="line">    Exits with a status of 0 (<span class="literal">true</span>) or 1 (<span class="literal">false</span>) depending on</span><br><span class="line">    the evaluation of EXPR.  Expressions may be unary or binary.  Unary</span><br><span class="line">    expressions are often used to examine the status of a file.  There</span><br><span class="line">    are string operators and numeric comparison operators as well.</span><br><span class="line">    </span><br><span class="line">    The behavior of <span class="built_in">test</span> depends on the number of arguments.  Read the</span><br><span class="line">    bash manual page <span class="keyword">for</span> the complete specification.</span><br><span class="line">    </span><br><span class="line">    File operators:</span><br><span class="line">    </span><br><span class="line">      -a FILE        True <span class="keyword">if</span> file exists.</span><br><span class="line">      -b FILE        True <span class="keyword">if</span> file is block special.</span><br><span class="line">      -c FILE        True <span class="keyword">if</span> file is character special.</span><br><span class="line">      -d FILE        True <span class="keyword">if</span> file is a directory.</span><br><span class="line">      -e FILE        True <span class="keyword">if</span> file exists.</span><br><span class="line">      -f FILE        True <span class="keyword">if</span> file exists and is a regular file.</span><br><span class="line">      -g FILE        True <span class="keyword">if</span> file is set-group-id.</span><br><span class="line">      -h FILE        True <span class="keyword">if</span> file is a symbolic <span class="built_in">link</span>.</span><br><span class="line">      -L FILE        True <span class="keyword">if</span> file is a symbolic <span class="built_in">link</span>.</span><br><span class="line">      -k FILE        True <span class="keyword">if</span> file has its `sticky<span class="string">&#x27; bit set.</span></span><br><span class="line"><span class="string">      -p FILE        True if file is a named pipe.</span></span><br><span class="line"><span class="string">      -r FILE        True if file is readable by you.</span></span><br><span class="line"><span class="string">      -s FILE        True if file exists and is not empty.</span></span><br><span class="line"><span class="string">      -S FILE        True if file is a socket.</span></span><br><span class="line"><span class="string">      -t FD          True if FD is opened on a terminal.</span></span><br><span class="line"><span class="string">      -u FILE        True if the file is set-user-id.</span></span><br><span class="line"><span class="string">      -w FILE        True if the file is writable by you.</span></span><br><span class="line"><span class="string">      -x FILE        True if the file is executable by you.</span></span><br><span class="line"><span class="string">      -O FILE        True if the file is effectively owned by you.</span></span><br><span class="line"><span class="string">      -G FILE        True if the file is effectively owned by your group.</span></span><br><span class="line"><span class="string">      -N FILE        True if the file has been modified since it was last read.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">      FILE1 -nt FILE2  True if file1 is newer than file2 (according to</span></span><br><span class="line"><span class="string">                       modification date).</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">      FILE1 -ot FILE2  True if file1 is older than file2.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">      FILE1 -ef FILE2  True if file1 is a hard link to file2.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    String operators:</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">      -z STRING      True if string is empty.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">      -n STRING</span></span><br><span class="line"><span class="string">         STRING      True if string is not empty.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">      STRING1 = STRING2</span></span><br><span class="line"><span class="string">                     True if the strings are equal.</span></span><br><span class="line"><span class="string">      STRING1 != STRING2</span></span><br><span class="line"><span class="string">                     True if the strings are not equal.</span></span><br><span class="line"><span class="string">      STRING1 &lt; STRING2</span></span><br><span class="line"><span class="string">                     True if STRING1 sorts before STRING2 lexicographically.</span></span><br><span class="line"><span class="string">      STRING1 &gt; STRING2</span></span><br><span class="line"><span class="string">                     True if STRING1 sorts after STRING2 lexicographically.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Other operators:</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">      -o OPTION      True if the shell option OPTION is enabled.</span></span><br><span class="line"><span class="string">      -v VAR	 True if the shell variable VAR is set</span></span><br><span class="line"><span class="string">      ! EXPR         True if expr is false.</span></span><br><span class="line"><span class="string">      EXPR1 -a EXPR2 True if both expr1 AND expr2 are true.</span></span><br><span class="line"><span class="string">      EXPR1 -o EXPR2 True if either expr1 OR expr2 is true.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">      arg1 OP arg2   Arithmetic tests.  OP is one of -eq, -ne,</span></span><br><span class="line"><span class="string">                     -lt, -le, -gt, or -ge.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Arithmetic binary operators return true if ARG1 is equal, not-equal,</span></span><br><span class="line"><span class="string">    less-than, less-than-or-equal, greater-than, or greater-than-or-equal</span></span><br><span class="line"><span class="string">    than ARG2.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Exit Status:</span></span><br><span class="line"><span class="string">    Returns success if EXPR evaluates to true; fails if EXPR evaluates to</span></span><br><span class="line"><span class="string">    false or an invalid argument is given.</span></span><br></pre></td></tr></table></figure>

<h4 id="1-10-1-变量测试"><a href="#1-10-1-变量测试" class="headerlink" title="1.10.1 变量测试"></a>1.10.1 变量测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断变量是否定义 </span></span><br><span class="line">[ -v NAME ]</span><br><span class="line"><span class="comment"># 判断变量是否定义并且是名称引用,bash 4.4新特性</span></span><br><span class="line">[ -R NAME ]</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># echo &quot;$BASH_VERSION&quot;</span></span><br><span class="line">4.2.46(2)-release</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo &quot;$BASH_VERSION&quot;</span></span><br><span class="line">4.4.20(1)-release</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># unset x</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># [ -v x ]</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $?</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h4 id="1-10-2-数值测试"><a href="#1-10-2-数值测试" class="headerlink" title="1.10.2 数值测试"></a>1.10.2 数值测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-eq 是否等于</span><br><span class="line">-ne	是否不等于</span><br><span class="line">-gt 是否大于</span><br><span class="line">-ge 是否大于等于</span><br><span class="line">-lt 是否小于</span><br><span class="line">-le	是否小于等于</span><br><span class="line"></span><br><span class="line">算数表达式比较</span><br><span class="line">==	!=	&lt;=	&gt;=	&lt;	&gt;</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># i=10</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># j=8</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [ $i -lt $j ];echo $?</span></span><br><span class="line">1</span><br><span class="line">[root@centos7 ~]<span class="comment"># [ i -gt j ];echo $?</span></span><br><span class="line">-bash: [: i: <span class="built_in">integer</span> expression expected</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># (( i &gt;= j ));echo $?</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h4 id="1-10-3-字符串测试"><a href="#1-10-3-字符串测试" class="headerlink" title="1.10.3 字符串测试"></a>1.10.3 字符串测试</h4><p><strong>test 和 [] 用法</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-z STRING        字符串是否为空，空为真</span><br><span class="line">-n STRING        字符串是否不空，不空为真</span><br><span class="line">   STRING</span><br><span class="line"></span><br><span class="line">STRING1 = STRING2	是否等于</span><br><span class="line">STRING1 != STRING2	是否不等于</span><br><span class="line">&gt;、&lt;		比较的是ASCII码的大小值</span><br></pre></td></tr></table></figure>

<p><strong>[[]] 用法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[[ expression ]]</span><br><span class="line">==	左侧字符串是否和右侧的PATTERN相同</span><br><span class="line">		note: 此表达式使用于[[]]，PATTERN支持通配符</span><br><span class="line">=~	左侧字符串是否能被右侧的正则表达式的PATTERN匹配</span><br><span class="line">		note: 此表达式使用于[[]]时，使用扩展的正则表达式</span><br></pre></td></tr></table></figure>

<p>[  ] 示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在比较字符串时，建议变量放在&quot;&quot;中</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># str1=Tom</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># str2=Jerry</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [ &quot;$str1&quot; = &quot;$str2&quot; ];echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># str3=&quot;I love you&quot;</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [ $str3 ]</span></span><br><span class="line">-bash: [: love: binary operator expected</span><br><span class="line">[root@centos7 ~]<span class="comment"># [ &quot;$str3&quot; ];echo $?</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>[[  ]] 和通配符示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># strvar1=&quot;Rocky_linux&quot;</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [[ &quot;$strvar1&quot; == Rocky* ]];echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># [[ &quot;$strvar1&quot; == &quot;Rocky*&quot; ]];echo $?</span></span><br><span class="line">1</span><br><span class="line">[root@centos7 ~]<span class="comment"># strvar1=&quot;Rocky*&quot;</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [[ &quot;$strvar1&quot; == &quot;Rocky*&quot; ]];echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 右侧的模式作为通配符时不需要加&quot;&quot;,只是表达字符本身,加&quot;&quot;或转义</span></span><br></pre></td></tr></table></figure>

<p>[[  ]]和扩展正则表达式示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断合理的考试成绩</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># SCORE=101</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [[ $SCORE =~ ^(100|[0-9]&#123;1,2&#125;)$ ]];echo $?</span></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断文件后缀</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># FILE=abc.log</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [[ &quot;$FILE&quot; =~ \.log$ ]];echo $?</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h4 id="1-10-4-文件测试"><a href="#1-10-4-文件测试" class="headerlink" title="1.10.4 文件测试"></a>1.10.4 文件测试</h4><p>存在性测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-a FILE: 同 -e</span><br><span class="line">-e FILE: 判断文件是否存在，存在则为真</span><br><span class="line">-b FILE: 是否是块设备文件</span><br><span class="line">-c FILE: 是否存在且为字符设备文件</span><br><span class="line">-d FILE: 是否存在且为目录文件</span><br><span class="line">-f FILE: 是否存在且为普通文件</span><br><span class="line">-h FILE 或 -L FILE: 存在且为符号链接文件</span><br><span class="line">-p FILE: 是否存在且为命名管道文件</span><br><span class="line">-S FILE: 是否存在且为套接字文件</span><br><span class="line"></span><br><span class="line">! 非   例: [ ! -a FILE ] 判断该文件是否不存在</span><br></pre></td></tr></table></figure>

<p>文件权限测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-r FILE: 是否存在且可读</span><br><span class="line">-w FILE: 是否存在且可写</span><br><span class="line">-x FILE: 是否存在且可执行</span><br><span class="line">-u FILE: 是否存在且拥有suid权限</span><br><span class="line">-g FILE: 是否存在且拥有sgid权限</span><br><span class="line">-k FILE: 是否存在且拥有sticky权限</span><br><span class="line"></span><br><span class="line">note: 最终结果由用户对文件的实际权限决定，而非文件属性决定</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/shadow 属性和root用户实际权限</span></span><br><span class="line"><span class="comment"># 判断文件是否具有某一权限，应根据该用户对文件的实际执行操作结果为准</span></span><br><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># ll /etc/shadow</span></span><br><span class="line">---------- 1 root root 759 Mar 27 02:44 /etc/shadow     </span><br><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># [ -w /etc/shadow ]; echo $?</span></span><br><span class="line">0</span><br><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># [ -x /etc/shadow ]; echo $? </span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p>文件属性测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-s FILE				  	是否存在且非空</span><br><span class="line">-t fd 					fd 文件描述符是否在某终端已经打开</span><br><span class="line">-N FILE 				文件自从上一次被读取之后是否被修改过</span><br><span class="line">-O FILE				 	当前有效用户是否为文件属主</span><br><span class="line">-G FILE					当前有效用户是否为文件属组</span><br><span class="line">FILE1 -ef FILE2 	FILE1是否是FILE2的硬链接</span><br><span class="line">FILE1 -nt FILE2	    FILE1是否新于FILE2（mtime）</span><br><span class="line">FILE1 -ot FILE2 	FILE1是否旧于FILE2</span><br></pre></td></tr></table></figure>

<h3 id="1-11-关于-与"><a href="#1-11-关于-与" class="headerlink" title="1.11 关于 () 与 {}"></a>1.11 关于 () 与 {}</h3><p>(CMD1;CMD2;···) 和 { CMD1;CMD2;···; } 都可以将多个命令组合在一起，批量执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(list) 会开启子shell，并且list中变量赋值及内部命令执行后,将不再影响后续的环境</span><br><span class="line"></span><br><span class="line">&#123; list; &#125; 不会启子shell, 在当前shell中运行,会影响当前shell环境</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索(list)</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># man bash</span></span><br><span class="line">(list) list  is  executed  <span class="keyword">in</span>  a subshell environment (see COMMAND EXECUTION ENVIRONMENT below).  Variable assignments and <span class="built_in">builtin</span> commands that affect the shell<span class="string">&#x27;s environment do not remain in effect after the command completes.  The return status is the exit status of list.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123; list; &#125; list is simply executed in the current shell environment.  list must be terminated with a newline or semicolon.  This is known as a group command.  The return status is the exit status of list.  Note that unlike the metacharacters ( and ), &#123; and &#125; are reserved words and must occur where a reserved word is permitted to be recognized.  Since they do not cause a word break, they must be  separated  from  list  by whitespace or another shell metacharacter.</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># name=Tom;(echo $name;name=Jerry;echo $name);echo $name</span></span><br><span class="line">Tom</span><br><span class="line">Jerry</span><br><span class="line">Tom</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># name=Tom;&#123; echo $name;name=Jerry;echo $name; &#125;;echo $name</span></span><br><span class="line">Tom</span><br><span class="line">Jerry</span><br><span class="line">Jerry</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当我们需要临时切换到某个目录执行某些操作，之后在返回原先的目录，可使用小括号</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># (cd /data/test/; rm -f f1.txt)</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="1-12-组合测试条件"><a href="#1-12-组合测试条件" class="headerlink" title="1.12 组合测试条件"></a>1.12 组合测试条件</h3><h4 id="1-12-1-第一种方式"><a href="#1-12-1-第一种方式" class="headerlink" title="1.12.1 第一种方式"></a>1.12.1 第一种方式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[ EXPRESSION1 -a EXPRESSION2 ] 并且，EXPRESSION1和EXPRESSION2都是真，结果才为真</span><br><span class="line">[ EXPRESSION1 -o EXPRESSION2 ] 或者，EXPRESSION1和EXPRESSION2只要有一个真，结果就为</span><br><span class="line">真</span><br><span class="line">[ ! EXPRESSION ] 取反</span><br><span class="line"></span><br><span class="line">note:	-a 和 -o 需要使用测试命令进行，[[]]	不支持</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># ll /shell/test.sh </span></span><br><span class="line">-rw-r--r-- 1 root root 350 Oct  3 21:46 /shell/test.sh</span><br><span class="line">[root@centos7 ~]<span class="comment"># FILE=/shell/test.sh </span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [ -f  &quot;$FILE&quot; -a -x &quot;$FILE&quot; ];echo $?</span></span><br><span class="line">1</span><br><span class="line">[root@centos7 ~]<span class="comment"># chmod +x /shell/test.sh </span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [ -f  &quot;$FILE&quot; -a -x &quot;$FILE&quot; ];echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># chmod -x /shell/test.sh </span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [ -f  &quot;$FILE&quot; -o -x &quot;$FILE&quot; ];echo $?</span></span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># [ ! -x &quot;$FILE&quot; ];echo $?</span></span><br><span class="line">0</span><br><span class="line">[root@centos7 ~]<span class="comment"># ! [ -x &quot;$FILE&quot; ];echo $?</span></span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<h4 id="1-12-2-第二种方式"><a href="#1-12-2-第二种方式" class="headerlink" title="1.12.2 第二种方式"></a>1.12.2 第二种方式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">COMMAND1 &amp;&amp; COMMAND2 <span class="comment">#并且，短路与，代表条件性的AND THEN</span></span><br><span class="line">如果COMMAND1 成功,将执行COMMAND2,否则,将不执行COMMAND2</span><br><span class="line"></span><br><span class="line">COMMAND1 || COMMAND2 <span class="comment">#或者，短路或，代表条件性的OR ELSE</span></span><br><span class="line">如果COMMAND1 成功,将不执行COMMAND2,否则,将执行COMMAND2</span><br><span class="line"></span><br><span class="line">! COMMAND <span class="comment">#非,取反</span></span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># [ &quot;a&quot; = &quot;B&quot; ] &amp;&amp; echo &quot;String is same.&quot;</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># [ &quot;a&quot; = &quot;a&quot; ] &amp;&amp; echo &quot;String is same.&quot;</span></span><br><span class="line">String is same.</span><br><span class="line">[root@centos7 ~]<span class="comment"># [ -f /etc/fstab -a -x /bin/cat ] &amp;&amp; cat /etc/fstab</span></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># id wh &amp;&gt; /dev/null || useradd wh</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># getent passwd wh</span></span><br><span class="line">wh:x:1000:1000::/home/wh:/bin/bash</span><br></pre></td></tr></table></figure>

<p>示例：&amp;&amp; 和 || 组合使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># NAME=Herbert;id $NAME &amp;&gt; /dev/null &amp;&amp; echo &quot;$NAME is exist&quot; || echo &quot;$NAME is not exist&quot;</span></span><br><span class="line">Herbert is not exist</span><br></pre></td></tr></table></figure>

<h4 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h4><p>1、编写脚本 argsnum.sh，接受一个文件路径作为参数；如果参数个数小于1，则提示用户“至少应该给一个参数”，并立即退出；如果参数个数不小于1，则显示第一个参数所指向的文件中的空白行数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># cat argsnum.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">[ <span class="variable">$#</span> -lt 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Please input a path!&quot;</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> has space characters:  `grep -E &#x27;^[[:space:]]+$&#x27; <span class="variable">$1</span> | wc -l`&quot;</span></span><br></pre></td></tr></table></figure>



<p>2、编写脚本 hostping.sh，接受一个主机的IPv4地址做为参数，测试是否可连通。如果能ping通，则提示用户“该IP地址可访问”；如果不可ping通，则提示用户“该IP地址不可访问”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># cat hostping.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">IP=<span class="variable">$1</span></span><br><span class="line">fping <span class="variable">$IP</span> &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span> is reachable!&quot;</span> || &#123; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span> is unreachable!&quot;</span>;<span class="built_in">exit</span>; &#125;</span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;Script is finished&quot;</span></span><br></pre></td></tr></table></figure>

<p>3、编写脚本 checkdisk.sh，检查磁盘分区空间和inode使用率，如果超过80%，就发广播警告空间将满</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># cat checkdisk.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">Error=80</span><br><span class="line">MAIL=wuhaolam@163.com</span><br><span class="line"></span><br><span class="line">Disk=`<span class="built_in">df</span> -Th | sed -n <span class="string">&#x27;/^\/dev\/sd*/p&#x27;</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> % | <span class="built_in">cut</span> -d% -f6 | <span class="built_in">sort</span> -r | <span class="built_in">head</span> -1`</span><br><span class="line">[ <span class="variable">$Disk</span> -ge <span class="variable">$Error</span> ] &amp;&amp; (<span class="built_in">echo</span> <span class="string">&quot;`hostname -I ` insufficient disk space &quot;</span>| mail -s <span class="string">&quot;Linux Disk Warning&quot;</span> wuhaolam@163.com )</span><br><span class="line"></span><br><span class="line">Inode=`<span class="built_in">df</span> -ih | sed -n <span class="string">&#x27;/^\/dev\/sd*/p&#x27;</span> | <span class="built_in">tr</span> -s <span class="string">&#x27; &#x27;</span> % | <span class="built_in">cut</span> -d% -f5 | <span class="built_in">sort</span> -r | <span class="built_in">head</span> -1`</span><br><span class="line">[ <span class="variable">$Inode</span> -ge <span class="variable">$Error</span> ] &amp;&amp; ( <span class="built_in">echo</span> <span class="string">&quot;`hostname -I ` insufficient inode space &quot;</span>| mail -s <span class="string">&quot;Linux Inode Warning&quot;</span> <span class="variable">$MAIL</span>)</span><br></pre></td></tr></table></figure>

<p>4、编写脚本 per.sh，判断当前用户的指定参数文件，是否不可读并且不可写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[wh@Rocky8-mini ~]$ [ ! -r /etc/gshadow -a ! -w /etc/gshadow ]   </span><br><span class="line">[wh@Rocky8-mini ~]$ <span class="built_in">echo</span> $?</span><br><span class="line">0</span><br></pre></td></tr></table></figure>

<p>5、编写脚本 excute.sh ，判断参数文件是否为sh后缀的普通文件，如果是，添加所有人可执行权限，否则提示用户非脚本文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># cat excute.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">Path=/root/*</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$Path</span>; <span class="keyword">do</span></span><br><span class="line">        [[ <span class="string">&quot;<span class="variable">$i</span>&quot;</span> == *<span class="string">&quot;.&quot;</span>sh ]] &amp;&amp; <span class="built_in">chmod</span> +x <span class="string">&quot;<span class="variable">$i</span>&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$i</span> is not script file!&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>6、编写脚本 nologin.sh和 login.sh，实现禁止和允许普通用户登录系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># cat nologin.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">[ `<span class="built_in">id</span> -u <span class="variable">$1</span>` -ge 1000 ] &amp;&amp; usermod <span class="string">&quot;<span class="variable">$1</span>&quot;</span> -s /sbin/nologin </span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini <span class="built_in">test</span>]<span class="comment"># cat login.sh   </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">[ `<span class="built_in">id</span> -u <span class="variable">$1</span>` -ge 1000 ] &amp;&amp; usermod <span class="string">&quot;<span class="variable">$1</span>&quot;</span> -s /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="1-13-接收键盘的输入—read命令"><a href="#1-13-接收键盘的输入—read命令" class="headerlink" title="1.13 接收键盘的输入—read命令"></a>1.13 接收键盘的输入—read命令</h3><p>​	使用read命令将输入值分配给一个或多个shell变量。read 命令从标准输入读取值，给每个单词分配一个变量，当所有单词分配完成还剩余变量没有分配，则默认的值为系统内置变量REPLY</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> [options] [name ...]</span><br><span class="line"></span><br><span class="line">常见选项：</span><br><span class="line">-p 			指定要显示的提示</span><br><span class="line">-s 			静默输入，一般用于密码</span><br><span class="line">-n N 		指定输入的字符长度N</span><br><span class="line">-d 			<span class="string">&#x27;字符&#x27;</span> 输入结束符</span><br><span class="line">-t N		TIMEOUT为N秒</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># echo $REPLY</span></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># read</span></span><br><span class="line">TEST</span><br><span class="line">[root@centos7 ~]<span class="comment"># echo $REPLY</span></span><br><span class="line">TEST</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># read -p &quot;Please input your name: &quot; NAME</span></span><br><span class="line">Please input your name: Tom   </span><br><span class="line">[root@centos7 ~]<span class="comment"># echo $NAME</span></span><br><span class="line">Tom</span><br></pre></td></tr></table></figure>

<p>示例：read命令使用管道符时的注意点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Pipelines</span><br><span class="line">       A pipeline is a sequence of one or more commands separated by one of the control operators | or |&amp;.</span><br><span class="line">       </span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo Jerry | read NAME</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $NAME</span></span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo Jerry | &#123; read NAME; echo $NAME; &#125;</span></span><br><span class="line">Jerry</span><br></pre></td></tr></table></figure>

<p>实例：read和输入重定向</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.txt </span></span><br><span class="line">1 2</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># read i j &lt; test.txt;echo &quot;i=$i,j=$j&quot;</span></span><br><span class="line">i=1,j=2</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo 1 2 | read i j;echo &quot;i=$i,j=$j&quot;</span></span><br><span class="line">i=,j=</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo 1 2 | (read i j;echo &quot;i=$i,j=$j&quot;)</span></span><br><span class="line">i=1,j=2</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo 1 2 | &#123; read i j;echo &quot;i=$i,j=$j&quot;; &#125;</span></span><br><span class="line">i=1,j=2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Each command in a pipeline is executed as a separate process (i.e., in a subshell).</span></span><br></pre></td></tr></table></figure>

<p>实例：实现运维工作菜单</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># cat /shell/work_menu.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -en <span class="string">&quot;\E[1;$[RANDOM%7+31]m&quot;</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">1) 备份数据库</span></span><br><span class="line"><span class="string">2) 清理日志</span></span><br><span class="line"><span class="string">3) 软件升级</span></span><br><span class="line"><span class="string">4) 软件回滚</span></span><br><span class="line"><span class="string">5) 删库跑路</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">echo</span> -en <span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please input your choice(1-5): &quot;</span> MENU</span><br><span class="line">[ <span class="variable">$MENU</span> -eq 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;备份数据库&quot;</span></span><br><span class="line">[ <span class="variable">$MENU</span> -eq 2 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;清理日志&quot;</span></span><br><span class="line">[ <span class="variable">$MENU</span> -eq 3 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;软件升级&quot;</span></span><br><span class="line">[ <span class="variable">$MENU</span> -eq 4 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;软件回滚&quot;</span></span><br><span class="line">[ <span class="variable">$MENU</span> -eq 5 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;删库跑路&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="二、bash-shell-配置文件"><a href="#二、bash-shell-配置文件" class="headerlink" title="二、bash shell 配置文件"></a>二、bash shell 配置文件</h2><h3 id="2-1-按照生效范围划分"><a href="#2-1-按照生效范围划分" class="headerlink" title="2.1 按照生效范围划分"></a>2.1 按照生效范围划分</h3><p>全局配置：针对所有用户生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/profile</span><br><span class="line">/etc/profile.d/*.sh</span><br><span class="line">/etc/bashrc</span><br></pre></td></tr></table></figure>

<p>个人配置：仅对指定用户生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/.bash_profile</span><br><span class="line">~/.bashrc</span><br></pre></td></tr></table></figure>

<h3 id="2-2-shell-登录两种方式分类"><a href="#2-2-shell-登录两种方式分类" class="headerlink" title="2.2 shell 登录两种方式分类"></a>2.2 shell 登录两种方式分类</h3><h4 id="2-2-1-交互式登录"><a href="#2-2-1-交互式登录" class="headerlink" title="2.2.1 交互式登录"></a>2.2.1 交互式登录</h4><ul>
<li>直接通过终端输入账号密码登录</li>
<li>使用 su - USERNAME 切换登录</li>
</ul>
<h4 id="2-2-2-非交互式登录"><a href="#2-2-2-非交互式登录" class="headerlink" title="2.2.2 非交互式登录"></a>2.2.2 非交互式登录</h4><ul>
<li>su USERNAME</li>
<li>图形界面下打开的终端</li>
<li>执行脚本</li>
<li>任何其它的bash实例</li>
</ul>
<h3 id="2-3-按照功能划分"><a href="#2-3-按照功能划分" class="headerlink" title="2.3 按照功能划分"></a>2.3 按照功能划分</h3><h4 id="2-3-1-profile-类"><a href="#2-3-1-profile-类" class="headerlink" title="2.3.1 profile 类"></a>2.3.1 profile 类</h4><p>profile 类为交互式登录的shell提供配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">全局: /etc/profile, /etc/profile.d/*.sh</span><br><span class="line">个人: ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>功用：</p>
<p>（1）一般用于定义环境变量</p>
<p>（2）运行命令或脚本</p>
<h4 id="2-3-2-bashrc-类"><a href="#2-3-2-bashrc-类" class="headerlink" title="2.3.2 bashrc 类"></a>2.3.2 bashrc 类</h4><p>bashrc 类为交互式和交互式登录的shell提供配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">全局: /etc/bashrc</span><br><span class="line">个人: ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>功用：</p>
<p>（1）定义命令别名和函数</p>
<p>（2）定义本地变量</p>
<h3 id="2-4-编辑配置文件生效"><a href="#2-4-编辑配置文件生效" class="headerlink" title="2.4 编辑配置文件生效"></a>2.4 编辑配置文件生效</h3><p>修改profile和bashrc文件后使其生效的两种方法</p>
<p>（1）重新启动shell进程</p>
<p>（2）source | .</p>
<h3 id="2-5-退出任务"><a href="#2-5-退出任务" class="headerlink" title="2.5 退出任务"></a>2.5 退出任务</h3><p>保存在~&#x2F;.bash_logout文件中，在退出登录shell时运行</p>
<p>功能：</p>
<p>（1）创建自动备份</p>
<p>（2）清除临时文件</p>
<h3 id="练习-2"><a href="#练习-2" class="headerlink" title="练习"></a>练习</h3><p>1、让所有用户的PATH环境变量的值多出一个路径，例如：&#x2F;usr&#x2F;local&#x2F;apache&#x2F;bin</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># echo &quot;PATH=/usr/local/apache/bin:$PATH&quot; &gt;&gt; /etc/profile</span></span><br></pre></td></tr></table></figure>

<p>2、用户 root 登录时，将命令指示符变成红色，并自动启用如下别名： </p>
<p>rm&#x3D;‘rm -i’<br>cdnet&#x3D;‘cd &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;’<br>editnet&#x3D;‘vim &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0’<br>editnet&#x3D;‘vim &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eno16777736 或 ifcfg-ens33 ’ (如果系统是CentOS7)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改命令指示符颜色</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#echo &#x27;PS1=&quot;\[\e[1;31m\][\u@\h \W]\\$\[\e[0m\]&quot;&#x27; &gt;&gt; ~/.bash_profile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义别名</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#vim ~/.bashrc</span></span><br><span class="line"><span class="built_in">rm</span>=<span class="string">&#x27;rm -i&#x27;</span></span><br><span class="line">cdnet=<span class="string">&#x27;cd /etc/sysconfig/network-scripts/&#x27;</span></span><br><span class="line">editnet=<span class="string">&#x27;vim /etc/sysconfig/network-scripts/ifcfg-eth0&#x27;</span></span><br></pre></td></tr></table></figure>

<p>3、任意用户登录系统时，显示红色字体的警示提醒信息“Hi,dangerous！”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/issue 登录前脚本提示</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># vim /etc/issue</span></span><br><span class="line">^[[1;31mHi, dangerous(login before)^[[0m</span><br><span class="line"><span class="comment"># /etc/motd	 登录后脚本提示</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># vim /etc/motd</span></span><br><span class="line">^[[1;31mHi, dangerous!(login after)^[[0m</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221008224950634.png" alt="image-20221008224950634"></p>
<p>4、编写生成脚本基本格式的脚本，包括作者，联系方式，版本，时间，描述等</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下信息包括文件名、作者、版本、邮箱、站点、时间、描述</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cat .vimrc</span></span><br><span class="line">autocmd BufNewFile *.sh <span class="built_in">exec</span> <span class="string">&quot;:call AddTitleForShell()&quot;</span></span><br><span class="line"><span class="keyword">function</span>  AddTitleForShell()</span><br><span class="line">   call append(0,<span class="string">&quot;#!/bin/bash&quot;</span>)</span><br><span class="line">   call append(1,<span class="string">&quot;# **********************************************************&quot;</span>)</span><br><span class="line">   call append(2,<span class="string">&quot;# * Filename      : &quot;</span>.<span class="built_in">expand</span>(<span class="string">&quot;%:t&quot;</span>))</span><br><span class="line">   call append(3,<span class="string">&quot;# * Author        : Herbert&quot;</span>)</span><br><span class="line">   call append(4,<span class="string">&quot;# * Version       : 1.0&quot;</span>)</span><br><span class="line">   call append(5,<span class="string">&quot;# * Email         : wuhaolam@163.com&quot;</span>)</span><br><span class="line">   call append(6,<span class="string">&quot;# * Website       : wuhaolam.github.io&quot;</span>)</span><br><span class="line">   call append(7,<span class="string">&quot;# * Date          : &quot;</span>.strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>))</span><br><span class="line">   call append(8,<span class="string">&quot;# * Description   : &quot;</span>)</span><br><span class="line">   call append(9,<span class="string">&quot;# **********************************************************&quot;</span>)</span><br><span class="line">endfunction</span><br></pre></td></tr></table></figure>

<h2 id="三、流程控制"><a href="#三、流程控制" class="headerlink" title="三、流程控制"></a>三、流程控制</h2><h3 id="3-1-条件选择"><a href="#3-1-条件选择" class="headerlink" title="3.1 条件选择"></a>3.1 条件选择</h3><h4 id="3-1-1-选择执行-if-语句"><a href="#3-1-1-选择执行-if-语句" class="headerlink" title="3.1.1 选择执行 if 语句"></a>3.1.1 选择执行 if 语句</h4><p>单分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 判断条件;<span class="keyword">then</span></span><br><span class="line">	条件成立时的代码</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>多分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 判断条件;<span class="keyword">then</span></span><br><span class="line">	条件为真的代码</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	条件不成立时执行代码</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>多分支</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 判断条件1;<span class="keyword">then</span></span><br><span class="line">	条件1成立时执行代码</span><br><span class="line"><span class="keyword">elif</span> 判断条件2;<span class="keyword">then</span></span><br><span class="line">	条件2成立时执行代码</span><br><span class="line"><span class="keyword">elif</span> 判断条件3;<span class="keyword">then</span></span><br><span class="line">	条件3成立时执行代码</span><br><span class="line">···</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	以上条件都不成立时执行该语句</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-条件判断-case-语句"><a href="#3-1-2-条件判断-case-语句" class="headerlink" title="3.1.2 条件判断 case 语句"></a>3.1.2 条件判断 case 语句</h4><p>语法格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> 变量引用 <span class="keyword">in</span></span><br><span class="line">PAT1)</span><br><span class="line">	分支1</span><br><span class="line">	;;</span><br><span class="line">PAT2)</span><br><span class="line">	分支2</span><br><span class="line">	;;</span><br><span class="line">···</span><br><span class="line">*)</span><br><span class="line">	默认分支</span><br><span class="line">	;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>case 支持glob风格的通配符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 任意长度任意字符</span><br><span class="line">? 任意单个字符</span><br><span class="line">[] 指定范围内的任意单个字符</span><br><span class="line">| 或者，如: a|b</span><br></pre></td></tr></table></figure>

<h4 id="练习-3"><a href="#练习-3" class="headerlink" title="练习"></a>练习</h4><p>1、编写脚本 createuser.sh，实现如下功能：使用一个用户名做为参数，如果指定参数的用户存在，就显示其存在，否则添加之。并设置初始密码为123456，显示添加的用户的id号等信息，在此新用户第一次登录时，会提示用户立即改密码，如果没有参数，就提示：请输入用户名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7-mini ~]<span class="comment"># cat createuser.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">USERNAME=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;请输入用户名！&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span> <span class="variable">$USERNAME</span> &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;该用户已经存在!&quot;</span> || &#123; useradd <span class="variable">$USERNAME</span>;<span class="built_in">echo</span> <span class="string">&quot;123456&quot;</span> | passwd --stdin <span class="variable">$USERNAME</span>&gt;/dev/null;<span class="built_in">echo</span> <span class="string">&quot;该用户信息为：`id <span class="variable">$USERNAME</span>`&quot;</span>;<span class="built_in">echo</span> <span class="string">&quot;请修改您的密码对于第一次登录，若非第一次登录请忽略！&quot;</span> &gt;&gt; /home/<span class="variable">$USERNAME</span>/.bashrc; &#125;</span><br></pre></td></tr></table></figure>

<p>2、编写脚本 yesorno.sh，提示用户输入yes或no,并判断用户输入的是yes还是no,或是其它信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7-mini ~]<span class="comment"># cat yesorno.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;please input &#x27;yes&#x27; or &#x27;no&#x27;: &quot;</span> INPUT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INPUT=`<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$INPUT</span>&quot;</span> | <span class="built_in">tr</span> -s <span class="string">&#x27;[A-Z]&#x27;</span> <span class="string">&#x27;[a-z]&#x27;</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$INPUT</span> <span class="keyword">in</span></span><br><span class="line">y|<span class="built_in">yes</span>)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Your input is YES!&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">n|no)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Your input is NO!&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">*)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Input false! Please input yes or no!&quot;</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<p>3、编写脚本 filetype.sh，判断用户输入文件路径，显示其文件类型（普通，目录，管道，其它文件类型）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7-mini ~]<span class="comment"># cat filetype.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please input a file path: &quot;</span> ROUTE</span><br><span class="line">TYPE=`<span class="built_in">ls</span> -l -d <span class="string">&quot;<span class="variable">$ROUTE</span>&quot;</span> | <span class="built_in">head</span> -c1`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$TYPE</span>&quot;</span> = <span class="string">&quot;-&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ROUTE</span> is a common file!&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$TYPE</span>&quot;</span> = <span class="string">&quot;d&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ROUTE</span> is a directory file!&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$TYPE</span>&quot;</span> = <span class="string">&quot;p&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ROUTE</span> is a Pipe file!&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ROUTE</span> is a other file!&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>4、编写脚本 checkint.sh，判断用户输入的参数是否为正整数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos7-mini ~]<span class="comment"># cat checkint.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;请输入一个数字：&quot;</span> INTNUM</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$INTNUM</span> =~ ^[0-9]+$ ]];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$INTNUM</span> 是一个正整数!&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$INTNUM</span> 不是一个正整数!&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-循环"><a href="#3-2-循环" class="headerlink" title="3.2 循环"></a>3.2 循环</h3><h4 id="3-2-1-循环-for"><a href="#3-2-1-循环-for" class="headerlink" title="3.2.1 循环 for"></a>3.2.1 循环 for</h4><h5 id="格式1"><a href="#格式1" class="headerlink" title="格式1"></a>格式1</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式1</span></span><br><span class="line"><span class="keyword">for</span> 变量名 <span class="keyword">in</span> 列表;<span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#方式2</span></span><br><span class="line"><span class="keyword">for</span> 变量名 <span class="keyword">in</span> 列表</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>for 循环列表生成方式</p>
<ul>
<li>直接给出列表</li>
<li>整数列表</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;star..end&#125;</span><br><span class="line">$(<span class="built_in">seq</span> [start [step]] end)</span><br></pre></td></tr></table></figure>

<ul>
<li>返回列表的命令</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(COMMAND)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用glob，如：*.sh</li>
<li>变量引用，如：$@, $*, $#</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当不指定列表时，默认使用位置变量 $@</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> NAME; <span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$NAME</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># bash -x test.sh Tom Jerry</span></span><br><span class="line">+ <span class="keyword">for</span> NAME <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">+ <span class="built_in">echo</span> Tom</span><br><span class="line">Tom</span><br><span class="line">+ <span class="keyword">for</span> NAME <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line">+ <span class="built_in">echo</span> Jerry</span><br><span class="line">Jerry</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计算 1+2+3+...+100 的结果</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># sum=0;for i in &#123;1..100&#125;;do sum=$[$sum+$i];done;echo &quot;sum=$sum&quot;</span></span><br><span class="line"><span class="built_in">sum</span>=5050</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># seq -s+ 100 | bc</span></span><br><span class="line">5050</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 100以内的奇数之和</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># sum=0;for i in &#123;1..100..2&#125;;do let sum=sum+i;done;echo &quot;sum=$sum&quot;</span></span><br><span class="line"><span class="built_in">sum</span>=2500</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># seq -s+ 1 2 100 | bc</span></span><br><span class="line">2500</span><br></pre></td></tr></table></figure>

<p>实例：自定义输入数字计算之和</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat for_sum.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : for_sum.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-09</span></span><br><span class="line"><span class="comment"># * Description   : 接收命令行传来的参数计算之和</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $*; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">sum</span>=$[<span class="built_in">sum</span>+i]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sum=<span class="variable">$sum</span>&quot;</span></span><br><span class="line">[root@centos7 shell]<span class="comment">#bash for_sum.sh 1 2 3 4 5</span></span><br><span class="line"><span class="built_in">sum</span>=15</span><br></pre></td></tr></table></figure>

<p>实例：传递用户名参数自动创建</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat CreateUser.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : CreateUser.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-09</span></span><br><span class="line"><span class="comment"># * Description   : Create Users in Batchers</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line">[ <span class="variable">$#</span> -eq 0 ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">&quot;USAGE: CreateUser.sh USERNAME ...&quot;</span>;<span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="keyword">for</span> USERS;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">id</span> <span class="variable">$USERS</span> &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;user <span class="variable">$USERS</span> already exists&quot;</span> || &#123; useradd <span class="variable">$USERS</span>;<span class="built_in">echo</span> <span class="string">&quot;&#x27;<span class="variable">$USERS</span>&#x27; user created successfully!&quot;</span>; &#125;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@centos7 shell]<span class="comment">#bash CreateUser.sh Tom Jerry</span></span><br><span class="line"><span class="string">&#x27;Tom&#x27;</span> user created successfully!</span><br><span class="line"><span class="string">&#x27;Jerry&#x27;</span> user created successfully!</span><br></pre></td></tr></table></figure>

<p>实例：批量创建用户并设置随机密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat UsersAndPasswords.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : UsersAndPasswords.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-09</span></span><br><span class="line"><span class="comment"># * Description   : Create Users in Branchers and Set Passwords</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line">[ <span class="variable">$#</span> -eq 0 ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">&quot;USAGE: CreateUser.sh USERNAME ...&quot;</span>;<span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="keyword">for</span> User;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">id</span> <span class="variable">$User</span> &amp;&gt; /dev/null &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">&quot;user <span class="variable">$User</span> already exists&quot;</span>;<span class="built_in">continue</span>; &#125;</span><br><span class="line">  useradd <span class="variable">$User</span></span><br><span class="line">  PASS=`<span class="built_in">cat</span> /dev/urandom | <span class="built_in">tr</span> -dc <span class="string">&#x27;[:alnum:]&#x27;</span> | <span class="built_in">head</span> -c12`</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$PASS</span>&quot;</span> | passwd --stdin <span class="variable">$User</span> &amp;&gt; /dev/null</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$User</span>:<span class="variable">$PASS</span>&quot;</span> &gt;&gt; /backup/UsersAndPasswords.<span class="built_in">log</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;&#x27;<span class="variable">$User</span>&#x27; user created successfully!&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@centos7 shell]<span class="comment">#bash UsersAndPasswords.sh Tom Jerry</span></span><br><span class="line"><span class="string">&#x27;Tom&#x27;</span> user created successfully!</span><br><span class="line"><span class="string">&#x27;Jerry&#x27;</span> user created successfully!</span><br><span class="line">[root@centos7 shell]<span class="comment">#cat  /backup/UsersAndPasswords.log </span></span><br><span class="line">Tom:5OO4dZXKZSXl</span><br><span class="line">Jerry:DFshykfzYUBL</span><br></pre></td></tr></table></figure>

<p>实例：九九乘法表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式一</span></span><br><span class="line">[root@centos7 shell]<span class="comment">#cat MultiplicationTable.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..9&#125;;<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> `<span class="built_in">seq</span> <span class="variable">$i</span>`;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$j</span>*<span class="variable">$i</span>=$[j*i]\t\c&quot;</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二,printf 打印九九乘法表</span></span><br><span class="line">[root@centos7 shell]<span class="comment">#cat MultiplicationTable.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..9&#125;;<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> `<span class="built_in">seq</span> <span class="variable">$i</span>`;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;%s*%s=%d\t&quot;</span> <span class="variable">$j</span> <span class="variable">$i</span> $[i*j]</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;\n&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式三，打印多彩九九乘法表</span></span><br><span class="line">[root@centos7 shell]<span class="comment">#cat MultiplicationTable.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..9&#125;;<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> `<span class="built_in">seq</span> <span class="variable">$i</span>`;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;$[RANDOM%7+31]m<span class="variable">$j</span>*<span class="variable">$i</span>=$[j*i]\t\c\E[0m&quot;</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>生产案例：将指定目录下文件所有文件后缀名改为bak后缀</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat suffix.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">DIR=/data/test</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$DIR</span> || &#123; <span class="built_in">echo</span> <span class="string">&quot;Can not access to!&quot;</span>;<span class="built_in">exit</span> 1; &#125;</span><br><span class="line"><span class="keyword">for</span> FILE <span class="keyword">in</span> *;<span class="keyword">do</span></span><br><span class="line">  PRE=`<span class="built_in">echo</span> <span class="variable">$FILE</span> | grep -Eo <span class="string">&quot;.*\.&quot;</span>`</span><br><span class="line">  <span class="built_in">mv</span> <span class="variable">$FILE</span> <span class="variable">$&#123;PRE&#125;</span>bak</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>面试题：将目录YYYY-MM-DD&#x2F;中所有文件，移动到YYYY-MM&#x2F;DD&#x2F;下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat MoveFile.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : MoveFile.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-10</span></span><br><span class="line"><span class="comment"># * Description   : Directory file movement</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line">PDIR=/data</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..365&#125;;<span class="keyword">do</span></span><br><span class="line">  DIR=`<span class="built_in">date</span> -d <span class="string">&quot;-<span class="variable">$i</span> day&quot;</span> +%F`</span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$PDIR</span>/<span class="variable">$DIR</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$PDIR</span>/<span class="variable">$DIR</span>/</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> &#123;1..10&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">touch</span> <span class="variable">$&#123;RANDOM&#125;</span>.<span class="built_in">log</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;31mRelated directroy files have been created\nStart to move related directories and files\E[0m&quot;</span></span><br><span class="line"></span><br><span class="line">DIR=/data</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$DIR</span> || &#123; <span class="built_in">echo</span> <span class="string">&quot;Can not access to!&quot;</span>;exit1; &#125;</span><br><span class="line"><span class="keyword">for</span> SUBDIR <span class="keyword">in</span> *;<span class="keyword">do</span></span><br><span class="line">  YYYY_MM=`<span class="built_in">echo</span> <span class="variable">$SUBDIR</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;-&#x27;</span> -f1,2`</span><br><span class="line">  DD=`<span class="built_in">echo</span> <span class="variable">$SUBDIR</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;-&#x27;</span> -f3`</span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$DIR</span>/<span class="variable">$YYYY_MM</span>/<span class="variable">$DD</span></span><br><span class="line">  <span class="built_in">mv</span> <span class="variable">$SUBDIR</span> ./<span class="variable">$YYYY_MM</span>/<span class="variable">$DD</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32mSuccessfully!\E[0m&quot;</span></span><br></pre></td></tr></table></figure>

<p>面试题：扫描一个网段：192.168.0.0&#x2F;24，判断此网段中所有主机在线状态，将在线的主机的IP打印出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat ScanHost.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">NET=192.168.0</span><br><span class="line"><span class="keyword">for</span> ID <span class="keyword">in</span> &#123;1..254&#125;;<span class="keyword">do</span></span><br><span class="line">        fping <span class="variable">$NET</span>.<span class="variable">$ID</span> &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$NET</span>.<span class="variable">$ID</span> is alived&quot;</span> | <span class="built_in">tee</span> -a /tmp/ip_alived.log || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$NET</span>.<span class="variable">$ID</span> is down&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h5 id="格式2"><a href="#格式2" class="headerlink" title="格式2"></a>格式2</h5><p>​	双小括号法，即 ((…)) 格式，也可以用于算数运算，双小括号号方法可以使bash shell实现C语言风格的变量操作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ((控制变量初始化;条件判断表达式;控制变量的修正表达式))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1~100的和</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#cat sum.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> ((sum=<span class="number">0</span>,i=<span class="number">1</span>;i&lt;=<span class="number">100</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">sum</span>=$[<span class="built_in">sum</span>+i]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1~100的和为：<span class="variable">$sum</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 九九乘法表 </span></span><br><span class="line">[root@centos7 ~]<span class="comment">#cat /shell/MultiplicationTable.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : MultiplicationTable.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.2</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-10</span></span><br><span class="line"><span class="comment"># * Description   : 9*9 multiplication table</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">1</span>;i&lt;=<span class="number">9</span>;i++));<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> ((j=<span class="number">1</span>;j&lt;=i;j++));<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;$[RANDOM%7+31]m<span class="variable">$j</span>*<span class="variable">$i</span>=$[j*i]\t\c\E[0m&quot;</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span>	</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印等腰三角形</span></span><br><span class="line">[root@centos7 shell]<span class="comment">#cat EquicruralTriangle.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : EquicruralTriangle.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-11</span></span><br><span class="line"><span class="comment"># * Description   : print equicrural triangle</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please enter the number of rows of triangle: &quot;</span> LINE</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">1</span>;i&lt;=LINE;i++));<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> ((j=<span class="number">1</span>;j&lt;=LINE-i;j++));<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&#x27; \c&#x27;</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="keyword">for</span> ((k=<span class="number">1</span>;k&lt;=<span class="number">2</span>*i-<span class="number">1</span>;k++));<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;$[RANDOM%7+31]m*\E[0m\c&quot;</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221011204213932.png" alt="image-20221011204213932"></p>
<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成进度条</span></span><br><span class="line">[root@centos7 shell]<span class="comment">#for ((i=0;i&lt;=100;i++));do printf &quot;\e[4D%3d%%&quot; $i;sleep 0.1s;done</span></span><br></pre></td></tr></table></figure>

<h4 id="练习（for实现）"><a href="#练习（for实现）" class="headerlink" title="练习（for实现）"></a>练习（for实现）</h4><p>1、判断&#x2F;var&#x2F;目录下所有文件的类型</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> /var</span><br><span class="line"><span class="keyword">for</span> FILE <span class="keyword">in</span> /var/*;<span class="keyword">do</span></span><br><span class="line">  TYPE=`<span class="built_in">ls</span> -l -d <span class="string">&quot;<span class="variable">$FILE</span>&quot;</span> | <span class="built_in">head</span> -c1`</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$TYPE</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">  <span class="string">&quot;-&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> is a test file!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;b&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> is a Block file!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;c&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> is a Character file!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;l&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> is a Link file!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;p&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> is a Pipe file!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;d&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> is a Directory file!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">&quot;s&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> is a Socket file!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> is a other file!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>2、添加10个用户user1-user10，密码为8位随机字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;;<span class="keyword">do</span></span><br><span class="line">	NewUser=<span class="string">&quot;user<span class="variable">$i</span>&quot;</span></span><br><span class="line">	<span class="built_in">id</span> <span class="string">&quot;<span class="variable">$NewUser</span>&quot;</span> &amp;&gt; /dev/null &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$NewUser</span> is exist!&quot;</span>;<span class="built_in">continue</span>; &#125;</span><br><span class="line">	useradd <span class="string">&quot;<span class="variable">$NewUser</span>&quot;</span></span><br><span class="line">	Password=`<span class="built_in">cat</span> /dev/urandom | <span class="built_in">tr</span> -dc [[:alnum:]] | <span class="built_in">head</span> -c8`</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$Password</span>&quot;</span> | passwd --stdin <span class="string">&quot;<span class="variable">$NewUser</span>&quot;</span> &gt; /dev/null</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32mUsers create Successfully!\E[0m&quot;</span></span><br></pre></td></tr></table></figure>

<p>3、&#x2F;etc&#x2F;rc.d&#x2F;rc3.d目录下分别有多个以K开头和以S开头的文件；分别读取每个文件，以K开头的输出为文件加stop，以S开头的输出为文件名加start，如K34filename stop S66filename start</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Centos6-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"><span class="built_in">set</span> -u</span><br><span class="line"><span class="built_in">cd</span> /etc/rc.d/rc3.d/</span><br><span class="line"><span class="keyword">for</span> FILE <span class="keyword">in</span> `<span class="built_in">ls</span>`;<span class="keyword">do</span></span><br><span class="line">  Character=`<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span>&quot;</span> | <span class="built_in">head</span> -c1`</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$Character</span>&quot;</span> = <span class="string">&#x27;K&#x27;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> stop&quot;</span></span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$FILE</span> start&quot;</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>4、编写脚本，提示输入正整数n的值，计算1+2+…+n的总和</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please input a positive integer: &quot;</span> N</span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> <span class="variable">$N</span>`;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">let</span> <span class="built_in">sum</span>=<span class="variable">$sum</span>+<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1+..+<span class="variable">$N</span> equal is <span class="variable">$sum</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>5、计算100以内所有能被3整除的整数之和</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">echo</span> &#123;3..100&#125;;<span class="keyword">do</span></span><br><span class="line">	RESULT=$[<span class="variable">$i</span>%3]</span><br><span class="line">	<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$RESULT</span>&quot;</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">let</span> <span class="built_in">sum</span>=<span class="variable">$sum</span>+<span class="variable">$i</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32m100以内所有能被3整除的整数之和为: <span class="variable">$sum</span>\E[0m&quot;</span></span><br></pre></td></tr></table></figure>

<p>6、在&#x2F;testdir目录下创建10个html文件,文件名格式为数字N（从1到10）加随机8个字母，如：1AbCdeFgH.html</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">seq</span> 10`;<span class="keyword">do</span></span><br><span class="line">	[ ! -d /testdir ] &amp;&amp; <span class="built_in">mkdir</span> /testdir</span><br><span class="line">	<span class="built_in">cd</span> /testdir</span><br><span class="line">	RandomLetters=`<span class="built_in">cat</span> /dev/urandom | <span class="built_in">tr</span> -dc [[:alpha:]] | <span class="built_in">head</span> -c8`</span><br><span class="line">	<span class="built_in">touch</span> <span class="string">&quot;$i<span class="variable">$RandomLetters</span>.html&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>7、猴子第一天摘下若干个桃子，当即吃了一半，还不瘾，又多吃了一个。第二天早上又将剩下的桃子吃掉一半，又多吃了一个。以后每天早上都吃了前一天剩下的一半多一个。到第10天早上想再吃时，只剩下一个桃子了。求第一天共摘了多少？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">sum</span>=1</span><br><span class="line"><span class="keyword">for</span> (( i=<span class="number">2</span>; i&lt;=<span class="number">10</span>; i++ ))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">sum</span>=$[(<span class="variable">$sum</span>+1)*2]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The monkey picked <span class="variable">$sum</span> peaches on the first day&quot;</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment">#bash test.sh</span></span><br><span class="line">The monkey picked 1534 peaches on the first day</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-循环-while"><a href="#3-2-2-循环-while" class="headerlink" title="3.2.2 循环 while"></a>3.2.2 循环 while</h4><p>格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> CONDITION; <span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 无限循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> :;<span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>实例：磁盘检查并发出邮件警告</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实现报警功能需提前设置好报警功能</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#cat while_check_disk.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">WARNING=80</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  CAPACITY=`<span class="built_in">df</span> -Th | awk <span class="string">&#x27;/\/dev\/sd/&#123;print $6&#125;&#x27;</span> | <span class="built_in">cut</span> -d<span class="string">&quot;%&quot;</span> -f1 | <span class="built_in">sort</span> -nr | <span class="built_in">head</span> -n1`</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$CAPACITY</span> -ge <span class="variable">$WARNING</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Disk will be full from `hostname -I`&quot;</span> | mail -s <span class="string">&quot;Linux disk check&quot;</span> wuhaolam@163.com</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">sleep</span> 10</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h4 id="练习-4"><a href="#练习-4" class="headerlink" title="练习"></a>练习</h4><p>1、编写脚本，求100以内所有正奇数之和</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 100 ];<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">sum</span>=$[<span class="built_in">sum</span>+i]</span><br><span class="line">	i=$[i+2]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The sum of odd numbers(1~100) is <span class="variable">$sum</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>2、编写脚本，提示请输入网络地址，如:192.168.0.0，判断输入的网段中主机在线状态，并统计在线和离线主机各多少</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat host.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">NET=192.168.0</span><br><span class="line">SUB=1</span><br><span class="line">UP=0</span><br><span class="line">DOWN=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$SUB</span> -lt 255 ];<span class="keyword">do</span></span><br><span class="line">	IP=<span class="variable">$NET</span>.<span class="variable">$SUB</span></span><br><span class="line">	<span class="keyword">if</span> `fping <span class="variable">$IP</span> &amp;&gt; /dev/null`;<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span> is alived&quot;</span></span><br><span class="line">		UP=$[<span class="variable">$UP</span>+1]</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span> is down&quot;</span></span><br><span class="line">		DOWN=$[<span class="variable">$DOWN</span>+1]</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	SUB=$[<span class="variable">$SUB</span>+1]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The online host has <span class="variable">$UP</span>;offline host has <span class="variable">$DOWN</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>3、编写脚本，打印九九乘法表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 9 ];<span class="keyword">do</span></span><br><span class="line">	j=1</span><br><span class="line">	<span class="keyword">while</span> [ <span class="variable">$j</span> -le <span class="variable">$i</span> ];<span class="keyword">do</span></span><br><span class="line">		<span class="built_in">echo</span> -e -n <span class="string">&quot;\E[1;$[<span class="variable">$RANDOM</span>%7+31]m<span class="variable">$j</span>*<span class="variable">$i</span>=$[<span class="variable">$j</span>*<span class="variable">$i</span>]\t\E[0m&quot;</span></span><br><span class="line">		j=$[<span class="variable">$j</span>+1]</span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	<span class="built_in">echo</span></span><br><span class="line">	i=$[<span class="variable">$i</span>+1]</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>4、编写脚本，利用变量RANDOM生成10个随机数字，输出这个10数字，并显示其中的最大值和最小值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line">MAX=0</span><br><span class="line">MIN=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -lt 11 ];<span class="keyword">do</span></span><br><span class="line">	NUM=<span class="variable">$RANDOM</span></span><br><span class="line">	[ <span class="variable">$i</span> -eq 1 ] &amp;&amp; MIN=<span class="variable">$NUM</span></span><br><span class="line">	<span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$NUM</span> &quot;</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$NUM</span> -gt <span class="variable">$MAX</span> ];<span class="keyword">then</span></span><br><span class="line">		MAX=<span class="variable">$NUM</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$NUM</span> -lt <span class="variable">$MIN</span> ];<span class="keyword">then</span></span><br><span class="line">		MIN=<span class="variable">$NUM</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	i=$[<span class="variable">$i</span>+1]</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;The largest number is <span class="variable">$MAX</span>,smallest number is <span class="variable">$MIN</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>5、编写脚本，实现打印国际象棋棋盘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">i=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le 8 ];<span class="keyword">do</span></span><br><span class="line">	j=1</span><br><span class="line">	value1=$[<span class="variable">$i</span>%2]</span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$value1</span> -ne 0 ];<span class="keyword">then</span></span><br><span class="line">		<span class="keyword">while</span> [ <span class="variable">$j</span> -le 8 ];<span class="keyword">do</span></span><br><span class="line">			value2=$[<span class="variable">$j</span>%2]</span><br><span class="line">			<span class="keyword">if</span> [ <span class="variable">$value2</span> -ne 0 ];<span class="keyword">then</span></span><br><span class="line">				<span class="built_in">echo</span> -e -n <span class="string">&quot;\E[1;47m  \E[0m&quot;</span></span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="built_in">echo</span> -e -n <span class="string">&quot;\E[1;41m  \E[0m&quot;</span></span><br><span class="line">			<span class="keyword">fi</span></span><br><span class="line">			j=$[<span class="variable">$j</span>+1]</span><br><span class="line">		<span class="keyword">done</span></span><br><span class="line">		<span class="built_in">echo</span>				</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">    <span class="keyword">while</span> [ <span class="variable">$j</span> -le 8 ];<span class="keyword">do</span></span><br><span class="line">  		value2=$[<span class="variable">$j</span>%2]</span><br><span class="line">  		<span class="keyword">if</span> [ <span class="variable">$value2</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">  			<span class="built_in">echo</span> -e -n <span class="string">&quot;\E[1;47m  \E[0m&quot;</span></span><br><span class="line">  		<span class="keyword">else</span></span><br><span class="line">  			<span class="built_in">echo</span> -e -n <span class="string">&quot;\E[1;41m  \E[0m&quot;</span></span><br><span class="line">  		<span class="keyword">fi</span></span><br><span class="line">  		j=$[<span class="variable">$j</span>+1]</span><br><span class="line">  	<span class="keyword">done</span></span><br><span class="line">		<span class="built_in">echo</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	i=$[<span class="variable">$i</span>+1]</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>6、后续六个字符串：efbaf275cd、4be9c40b8b、44b2395c46、f8c8873ce0、b902c16c8b、ad865d2f63是通过对随机数变量RANDOM随机执行命令： echo $RANDOM|md5sum|cut -c1-10后的结果，请破解这些字符串对应的RANDOM值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> words <span class="keyword">in</span> efbaf275cd 4be9c40b8b 44b2395c46 f8c8873ce0 b902c16c8b ad865d2f63;<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">	INIT_VALUE=<span class="variable">$RANDOM</span></span><br><span class="line">	PW=`<span class="built_in">echo</span> <span class="variable">$INIT_VALUE</span> | <span class="built_in">md5sum</span> | <span class="built_in">cut</span> -c1-10`</span><br><span class="line">		<span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$words</span>&quot;</span> = <span class="string">&quot;<span class="variable">$PW</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$words</span> initial value is <span class="variable">$INIT_VALUE</span>&quot;</span></span><br><span class="line">			<span class="built_in">break</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># bash test.sh</span></span><br><span class="line">efbaf275cd initial value is 15000</span><br><span class="line">4be9c40b8b initial value is 12000</span><br><span class="line">44b2395c46 initial value is 9000</span><br><span class="line">f8c8873ce0 initial value is 6000</span><br><span class="line">b902c16c8b initial value is 3000</span><br><span class="line">ad865d2f63 initial value is 1000</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-循环-until"><a href="#3-2-3-循环-until" class="headerlink" title="3.2.3 循环 until"></a>3.2.3 循环 until</h4><p>格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">until CONDITION; <span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 无限循环</span></span><br><span class="line">until <span class="literal">false</span>; <span class="keyword">do</span></span><br><span class="line">	循环体</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">进入条件 CONDITION 为 <span class="literal">false</span></span><br><span class="line">推出条件 CONDITION 为 <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># sum=0;i=1;until [ $i -gt 100 ];do let sum=sum+i; let i++;done;echo $sum</span></span><br><span class="line">5050</span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-continue-语句"><a href="#3-2-4-continue-语句" class="headerlink" title="3.2.4 continue 语句"></a>3.2.4 continue 语句</h4><p>continue [N]：提前结束第N层的本轮循环，直接进入下一轮判断；最内层为第1层</p>
<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;;<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$i</span> -eq 3 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">continue</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="variable">$i</span> </span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># bash test.sh</span></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-break-语句"><a href="#3-2-5-break-语句" class="headerlink" title="3.2.5 break 语句"></a>3.2.5 break 语句</h4><p>break[N]：提前结束第N层整个循环，最内层为第1层</p>
<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125;;<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$i</span> -eq 3 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">break</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="variable">$i</span> </span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># bash test.sh</span></span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p>实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat menu.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : menu.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-18</span></span><br><span class="line"><span class="comment"># * Description   : order dishes</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line">COLOR1=<span class="string">&#x27;echo -e \E[1;31m&#x27;</span></span><br><span class="line">COLOR2=<span class="string">&#x27;echo -e \E[1;32m&#x27;</span></span><br><span class="line">END=<span class="string">&#x27;\E[0m&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;\E[1;33m\c&quot;</span></span><br><span class="line">  <span class="built_in">cat</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">1) 小龙虾</span></span><br><span class="line"><span class="string">2) 葱油鸡</span></span><br><span class="line"><span class="string">3) 老母鸡汤</span></span><br><span class="line"><span class="string">4) 蒸蛋</span></span><br><span class="line"><span class="string">5) 烤肠</span></span><br><span class="line"><span class="string">6) 结账</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;\E[0m&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="built_in">read</span> -p <span class="string">&quot;Please select your dishes: &quot;</span> MENU</span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$MENU</span> <span class="keyword">in</span></span><br><span class="line">  1|4)</span><br><span class="line">    <span class="variable">$COLOR1</span><span class="string">&#x27;prices: $10&#x27;</span><span class="variable">$END</span></span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">sum</span>=<span class="built_in">sum</span>+10</span><br><span class="line">    ;;</span><br><span class="line">  3|5)</span><br><span class="line">    <span class="variable">$COLOR1</span><span class="string">&#x27;prices: $20&#x27;</span><span class="variable">$END</span></span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">sum</span>=<span class="built_in">sum</span>+20</span><br><span class="line">    ;;</span><br><span class="line">  2)</span><br><span class="line">    <span class="variable">$COLOR1</span><span class="string">&#x27;prices: $30&#x27;</span><span class="variable">$END</span></span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">sum</span>=<span class="built_in">sum</span>+30</span><br><span class="line">    ;;</span><br><span class="line">  6)</span><br><span class="line">    <span class="variable">$COLOR2</span><span class="string">&quot;All the prices are: \$<span class="variable">$sum</span>&quot;</span><span class="variable">$END</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Please input correct sequence!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>实例：猜大小</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">NUM=$[RANDOM%10]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -p <span class="string">&quot;Please input your number[0~9]: &quot;</span> INPUT ;<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$INPUT</span> -eq <span class="variable">$NUM</span> ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Congratulations on your correct guess!&quot;</span></span><br><span class="line">		<span class="built_in">break</span></span><br><span class="line">	<span class="keyword">elif</span> [ <span class="variable">$INPUT</span> -gt <span class="variable">$NUM</span> ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Too big, again please!&quot;</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Too small, again please!&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-6-shift命令"><a href="#3-2-6-shift命令" class="headerlink" title="3.2.6 shift命令"></a>3.2.6 shift命令</h4><p>​	shift [n] 用于将参数列表 list 左移指定次数，缺省为左移一次。</p>
<p>​	当参数列表 list 被移动，最左端的那个参数就从列表中删除。while循环遍历位置参数列表时，常用到 shift</p>
<p>示例1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">until [ -z <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ];<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">	<span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># bash test.sh a b c d e</span></span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">e</span><br></pre></td></tr></table></figure>

<p>实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shift 批量创建用户</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat batch_create_user.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ];<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">id</span> <span class="variable">$1</span> &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="variable">$1</span> user is exist</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		useradd <span class="variable">$1</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$1</span> user create successfully!&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># bash batch_create_user.sh Tom Jerry</span></span><br><span class="line">Tom user create successfully!</span><br><span class="line">Jerry user create successfully!</span><br></pre></td></tr></table></figure>

<h4 id="练习-5"><a href="#练习-5" class="headerlink" title="练习"></a>练习</h4><p>1、每隔3秒钟到系统上获取已经登录的用户的信息；如果发现用户hacker登录，则将登录时间和主机记录于日志&#x2F;var&#x2F;log&#x2F;login.log中,并退出脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">who</span> | grep <span class="string">&quot;hacker&quot;</span> &gt;&gt; /var/log/login.log &amp;&amp; <span class="built_in">break</span></span><br><span class="line">	<span class="built_in">sleep</span> 3</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>2、用文件名做为参数，统计所有参数文件的总行数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">[ <span class="variable">$#</span> -eq 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;Please input at lease one parameter: &#x27;/etc/fstab ...&#x27;&quot;</span></span><br><span class="line"><span class="keyword">for</span> FILE <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>;<span class="keyword">do</span></span><br><span class="line">	Lines=`<span class="built_in">cat</span> <span class="variable">$FILE</span> | <span class="built_in">wc</span> -l`</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;The number of lines for &#x27;<span class="variable">$FILE</span>&#x27; is <span class="variable">$Lines</span>.&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>3、用二个以上的数字为参数，显示其中的最大值和最小值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">[ <span class="variable">$#</span> -le 2 ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">&quot;Please input at least two parameters!&quot;</span>;<span class="built_in">exit</span> 1; &#125;</span><br><span class="line"></span><br><span class="line">MAX=<span class="variable">$1</span></span><br><span class="line">MIN=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">for</span> NUM <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span>;<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$MAX</span> -lt <span class="variable">$NUM</span> ];<span class="keyword">then</span></span><br><span class="line">		MAX=<span class="variable">$NUM</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$MIN</span> -gt <span class="variable">$NUM</span> ];<span class="keyword">then</span></span><br><span class="line">    MIN=<span class="variable">$NUM</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&#x27;$*&#x27;,the MAX number is <span class="variable">$MAX</span>; the MIN number is <span class="variable">$MIN</span>.&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-7-while-特殊用法-while-read"><a href="#3-2-7-while-特殊用法-while-read" class="headerlink" title="3.2.7 while 特殊用法 while read"></a>3.2.7 while 特殊用法 while read</h4><p>while 循环的特殊用法，遍历文件或文本的每一行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> LINE;<span class="keyword">do</span></span><br><span class="line">	loop body</span><br><span class="line"><span class="keyword">done</span> &lt; /PATH/SOMEFILE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依次读取/PATH/SOMEFILE文件中的每一行，且将行赋值给变量LINE</span></span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo Jerry | read x;echo $x</span></span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo Jerry | &#123; read x;echo $x; &#125;</span></span><br><span class="line">Jerry</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo Jerry | while read X;do echo $X;done</span></span><br><span class="line">Jerry</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo Tom Jerry Snoopy | while read X Y Z; do echo $X $Y $Z;done</span></span><br><span class="line">Tom Jerry Snoopy</span><br></pre></td></tr></table></figure>

<p>实例：磁盘检查</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat Check_Disk_Capacity.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : Check_Disk_Capacity.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-18</span></span><br><span class="line"><span class="comment"># * Description   : check disk capacity and send email warnings</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line">WARNING=80</span><br><span class="line">MAIL=wuhaolam@163.com</span><br><span class="line"></span><br><span class="line"><span class="built_in">df</span> | awk -F<span class="string">&quot; +|%&quot;</span>  <span class="string">&#x27;/^\/dev\/sd/&#123;print $1,$5&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> DEVICE UTILIZATION;<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$UTILIZATION</span> -ge <span class="variable">$WARNING</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DEVICE</span> will be full, Utilization: <span class="variable">$UTILIZATION</span>%&quot;</span> | mail -s <span class="string">&quot;Linux Disk Warning&quot;</span> <span class="variable">$MAIL</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>实例：检查DOS攻击</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat CheckLink.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : CheckLink.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-23</span></span><br><span class="line"><span class="comment"># * Description   : Check the number of attack connections</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line">WARNING=10</span><br><span class="line">[ ! -e /tmp/deny_hosts.txt ] &amp;&amp;  <span class="built_in">touch</span> /tmp/deny_hosts.txt</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  ss -nt | sed -nr <span class="string">&#x27;s#.* ([0-9.]+):[0-9]+ *#\1#p&#x27;</span> | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c |</span><br><span class="line">  <span class="keyword">while</span> <span class="built_in">read</span> COUNT IP;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$COUNT</span> -ge <span class="variable">$WARNING</span> ];<span class="keyword">then</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$IP</span> will be denied&quot;</span></span><br><span class="line">      grep -q <span class="string">&quot;<span class="variable">$IP</span>&quot;</span> /tmp/deny_hosts.txt || &#123; <span class="built_in">echo</span> <span class="variable">$IP</span> &gt;&gt; /tmp/deny_hosts.txt;iptables -A INPUT -s <span class="variable">$IP</span> -j REJECT; &#125;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">break</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>实例：查看&#x2F;sbin&#x2F;nologin的shell类型的用户名和UID</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> LINE;<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$LINE</span>&quot;</span> =~ /sbin/nologin$  ]];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$LINE</span>&quot;</span> | <span class="built_in">cut</span> -d: -f1,3 --output-delimiter=:</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; /etc/passwd</span><br></pre></td></tr></table></figure>

<h4 id="3-2-8-循环与菜单-select"><a href="#3-2-8-循环与菜单-select" class="headerlink" title="3.2.8 循环与菜单 select"></a>3.2.8 循环与菜单 select</h4><p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select NAME [<span class="keyword">in</span> WORDS ...;]<span class="keyword">do</span> COMMANDS;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">select VARIABLE <span class="keyword">in</span> list; <span class="keyword">do</span></span><br><span class="line">	循环体命令</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li>select 循环主要用于创建菜单，按数字顺序排列的菜单项显示在标准错误上，并显示 PS3 提示符，等待用户输入</li>
<li>用户输入菜单列表中的某个数字，执行相应的命令</li>
<li>用户的输入被保存在内置变量 REPLY 中</li>
<li>select 是个无限循环，因此要用break命令退出循环，或者用exit命令终止脚本</li>
<li>select 经常和case联合使用</li>
<li>与 for 循环类似，可以省略 in list，此时使用位置参数</li>
</ul>
<p>实例：餐馆点菜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 shell]<span class="comment">#cat select_menu.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="comment"># * Filename      : select_menu.sh</span></span><br><span class="line"><span class="comment"># * Author        : Herbert</span></span><br><span class="line"><span class="comment"># * Version       : 1.0</span></span><br><span class="line"><span class="comment"># * Email         : wuhaolam@163.com</span></span><br><span class="line"><span class="comment"># * Website       : wuhaolam.github.io</span></span><br><span class="line"><span class="comment"># * Date          : 2022-10-25</span></span><br><span class="line"><span class="comment"># * Description   : Use &#x27;select&#x27; command accomplish order function</span></span><br><span class="line"><span class="comment"># **********************************************************</span></span><br><span class="line"><span class="built_in">sum</span>=0</span><br><span class="line">PS3=<span class="string">&quot;Here is the menu.Please take you order(1-6): &quot;</span></span><br><span class="line">select MENU <span class="keyword">in</span> 老母鸡汤 紫薯饭 毛豆烧鸡 竹笋鸡翅 蒸蛋 点菜结束;<span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">  1)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$MENU</span> prince is ￥16&quot;</span></span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">sum</span>=<span class="built_in">sum</span>+16</span><br><span class="line">    ;;</span><br><span class="line">  2)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$MENU</span> prince is ￥3&quot;</span></span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">sum</span>=<span class="built_in">sum</span>+3</span><br><span class="line">    ;;</span><br><span class="line">  3)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$MENU</span> prince is ￥15&quot;</span></span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">sum</span>=<span class="built_in">sum</span>+15</span><br><span class="line">    ;;</span><br><span class="line">  4)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$MENU</span> prince is ￥12&quot;</span></span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">sum</span>=<span class="built_in">sum</span>+12</span><br><span class="line">    ;;</span><br><span class="line">  5)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$MENU</span> prince is ￥6&quot;</span></span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">sum</span>=<span class="built_in">sum</span>+6</span><br><span class="line">    ;;</span><br><span class="line">  6)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;点菜结束&quot;</span></span><br><span class="line">    <span class="built_in">break</span></span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Input error,please reselect!&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;A total of consumption: ￥<span class="variable">$sum</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="四、函数-function"><a href="#四、函数-function" class="headerlink" title="四、函数 function"></a>四、函数 function</h2><p>函数function是由若干条shell命令组成的语句块，实现代码重用和模块化编程</p>
<p>函数与shell程序形式上相似，不同的是它不是一个单独的进程，不能独立运行，而是shell程序的一部分</p>
<p>函数与shell程序的区别</p>
<ul>
<li>shell程序在子shell中运行</li>
<li>函数在当前shell中运行。故函数可以对shell中的变量进行修改</li>
</ul>
<h3 id="4-1-管理函数"><a href="#4-1-管理函数" class="headerlink" title="4.1 管理函数"></a>4.1 管理函数</h3><p>函数由两部分组成：函数名和函数体</p>
<p>帮助查看：help function</p>
<h4 id="4-1-1-定义函数"><a href="#4-1-1-定义函数" class="headerlink" title="4.1.1 定义函数"></a>4.1.1 定义函数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 形式一</span></span><br><span class="line"><span class="function"><span class="title">func_name</span></span> ()&#123;</span><br><span class="line">	... body ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 形式二</span></span><br><span class="line"><span class="keyword">function</span> func_name&#123;</span><br><span class="line">	... body ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 形式三</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">func_name</span></span> ()&#123;</span><br><span class="line">	... body ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-查看函数"><a href="#4-1-2-查看函数" class="headerlink" title="4.1.2 查看函数"></a>4.1.2 查看函数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前已定义的函数名</span></span><br><span class="line"><span class="built_in">declare</span> -F</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前已定义的函数定义</span></span><br><span class="line"><span class="built_in">declare</span> -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定当前已定义的函数名</span></span><br><span class="line"><span class="built_in">declare</span> -f func_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前已定义的函数名定义</span></span><br><span class="line"><span class="built_in">declare</span> -F func_name</span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-删除函数"><a href="#4-1-3-删除函数" class="headerlink" title="4.1.3 删除函数"></a>4.1.3 删除函数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> func_name</span><br></pre></td></tr></table></figure>

<h3 id="4-2-函数调用"><a href="#4-2-函数调用" class="headerlink" title="4.2 函数调用"></a>4.2 函数调用</h3><p>函数的调用方式</p>
<ul>
<li>可在交互式环境下定义函数</li>
<li>可将函数放在脚本文件中作为它的一部分</li>
<li>可放在只包含函数的单独文件中</li>
</ul>
<p>调用：函数只有被调用才会执行，通过给定函数名调用函数，执行函数中的代码</p>
<p>生命周期：被调用时创建，返回时终止</p>
<h4 id="4-2-1-交互式环境下定义和使用函数"><a href="#4-2-1-交互式环境下定义和使用函数" class="headerlink" title="4.2.1 交互式环境下定义和使用函数"></a>4.2.1 交互式环境下定义和使用函数</h4><p>在交互式环境下定义和使用函数</p>
<p>Example：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-client yum.repos.d]<span class="comment">#dir()&#123;</span></span><br><span class="line">&gt; <span class="built_in">ls</span> -l</span><br><span class="line">&gt; &#125;</span><br><span class="line">[root@Rocky8-client yum.repos.d]<span class="comment">#dir</span></span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 30 05:05 backup</span><br><span class="line">-rw-r--r-- 1 root root 2081 Oct 29 21:29 docker-ce.repo.bak</span><br><span class="line">-rw-r--r-- 1 root root 1079 Oct 29 07:59 yum.repo</span><br></pre></td></tr></table></figure>

<p>Example：判断当前系统的主版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-client ~]<span class="comment">#Rocky_version() &#123;</span></span><br><span class="line">&gt; sed -nr <span class="string">&#x27;s#.* ([0-9]+)\..*#\1#p&#x27;</span> /etc/redhat-release</span><br><span class="line">&gt; &#125;</span><br><span class="line">[root@Rocky8-client ~]<span class="comment">#Rocky_version </span></span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2-在脚本中定义及使用函数"><a href="#4-2-2-在脚本中定义及使用函数" class="headerlink" title="4.2.2 在脚本中定义及使用函数"></a>4.2.2 在脚本中定义及使用函数</h4><p>函数在使用前必须定义，因此将函数定义放在脚本开始部分。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">hello</span></span> ()&#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;program execution functions&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">hello</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;finished&quot;</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment">#bash test.sh </span></span><br><span class="line">program execution <span class="built_in">functions</span></span><br><span class="line">finished</span><br></pre></td></tr></table></figure>

<p>Example：简单的初始化脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">disable_selinux</span></span> ()&#123;</span><br><span class="line">	sed -i.bak <span class="string">&#x27;s/SELINUX=enforcing/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;SElinux has disabled!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">disable_firewalld</span></span> ()&#123;</span><br><span class="line">	systemctl <span class="built_in">disable</span> --now firewalld &amp;&gt; /dev/null</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;Firewalld has disabled!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">set_PS1</span></span> ()&#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;PS1=\[\e[1;32m\][\u@\h \W]\\$\[\e[0m\]&quot;</span> &gt; /etc/profile.d/ps1.sh</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;Prompt has been modified!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PS3=<span class="string">&quot;Select the operation you want to perform(1-5): &quot;</span></span><br><span class="line">MENU=<span class="string">&#x27;禁用SELinux 关闭防火墙 修改提示符 以上都实现 退出&#x27;</span></span><br><span class="line"></span><br><span class="line">select M <span class="keyword">in</span> <span class="variable">$MENU</span>;<span class="keyword">do</span></span><br><span class="line">	<span class="keyword">case</span> <span class="variable">$REPLY</span> <span class="keyword">in</span></span><br><span class="line">	1)</span><br><span class="line">		disable_selinux</span><br><span class="line">		;;</span><br><span class="line">	2)</span><br><span class="line">		disable_firewalld</span><br><span class="line">		;;</span><br><span class="line">	3)</span><br><span class="line">		set_PS1</span><br><span class="line">		;;</span><br><span class="line">	4)</span><br><span class="line">		disable_selinux</span><br><span class="line">		disable_firewalld</span><br><span class="line">		set_PS1</span><br><span class="line">		;;</span><br><span class="line">	5)</span><br><span class="line">		<span class="built_in">break</span></span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;Please enter correct number!&quot;</span></span><br><span class="line">		;;</span><br><span class="line">	<span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-使用函数文件"><a href="#4-2-3-使用函数文件" class="headerlink" title="4.2.3 使用函数文件"></a>4.2.3 使用函数文件</h4><p>可以将经常使用的函数存入一个单独的函数文件，然后将函数文件载入shell，再进行调用函数</p>
<p>函数文件名可以任意选取，但最好与相关任务有某种联系</p>
<p>当函数文件载入shell，就可以再命令行或脚本中调用函数</p>
<p>若要改动函数，首先要unset命令从shell中删除函数，改动完毕后，再重新载入此文件</p>
<p>函数文件实现的过程：</p>
<p> （1）创建函数文件，只存放函数的定义</p>
<p> （2）在shell脚本或交互式shell中调用函数文件</p>
<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat functions </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">hello</span></span> ()&#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment">#. functions</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment">#hello</span></span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<h3 id="4-3-函数返回值"><a href="#4-3-函数返回值" class="headerlink" title="4.3 函数返回值"></a>4.3 函数返回值</h3><p>函数的执行结果返回值：</p>
<ul>
<li>使用echo等命令进行输出</li>
<li>函数体中调用命令的输出结果</li>
</ul>
<p>函数的退出状态码：</p>
<ul>
<li>默认取决于函数中执行的最后一条命令的退出状态码</li>
<li>自定义退出状态码<ul>
<li>return                从函数中返回，用最后状态命令决定返回值</li>
<li>return 0             无错误返回</li>
<li>return 1-255      有错误返回</li>
</ul>
</li>
</ul>
<h3 id="4-4-环境函数"><a href="#4-4-环境函数" class="headerlink" title="4.4 环境函数"></a>4.4 环境函数</h3><p>类似于环境变量，也可以定义环境函数（子进程也可使用父进程定义的函数）</p>
<p>定义环境函数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> -f function_name</span><br><span class="line"><span class="built_in">declare</span> -xf function_name</span><br></pre></td></tr></table></figure>

<p>查看环境函数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> -f</span><br><span class="line"><span class="built_in">declare</span> -xf</span><br></pre></td></tr></table></figure>

<h3 id="4-5-函数参数"><a href="#4-5-函数参数" class="headerlink" title="4.5 函数参数"></a>4.5 函数参数</h3><p>函数可以接受参数</p>
<ul>
<li>传递参数给函数：在函数名后面以空白分隔给定参数列表即可，如：function_name arg1 arg2 …</li>
<li>在函数体中，可以使用$1, $2, … 调用这些参数；也可使用$@, $*, $#等特殊变量</li>
</ul>
<p>Example：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打印一个进度条</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">progress_bar</span></span>() &#123;</span><br><span class="line">	<span class="built_in">local</span> char=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">	<span class="built_in">local</span> number=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">	<span class="built_in">local</span> c</span><br><span class="line">	<span class="keyword">for</span> ((c=<span class="number">0</span>; c&lt;number; c++)); <span class="keyword">do</span></span><br><span class="line">		<span class="built_in">printf</span> <span class="string">&quot;<span class="variable">$char</span>&quot;</span></span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">COLOR=32</span><br><span class="line"><span class="comment"># 声明整数型变量end，赋值为50</span></span><br><span class="line"><span class="built_in">declare</span> -i end=50</span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">1</span>; i&lt;=end; i++)); <span class="keyword">do</span></span><br><span class="line">	<span class="built_in">printf</span> <span class="string">&quot;\e[1;<span class="variable">$&#123;COLOR&#125;</span>m\e[80D[&quot;</span></span><br><span class="line">	progress_bar <span class="string">&quot;#&quot;</span> <span class="variable">$i</span></span><br><span class="line">	progress_bar <span class="string">&quot; &quot;</span> $[end-i]</span><br><span class="line">	<span class="built_in">printf</span> <span class="string">&quot;] %3d%%\e[0m&quot;</span> $((i*<span class="number">2</span>))</span><br><span class="line">	<span class="built_in">sleep</span> 0.1s</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p><img src="D:/Documents/TyporaPicture/Shell%20%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/image-20221031191515701.png" alt="image-20221031191515701"></p>
<h3 id="4-6-函数变量"><a href="#4-6-函数变量" class="headerlink" title="4.6 函数变量"></a>4.6 函数变量</h3><p>变量的作用域：</p>
<ul>
<li>普通变量：只在当前shell进程中有效</li>
<li>环境变量：当前shell和子shell有效</li>
<li>本地变量：函数的生命周期；函数结束时变量自动销毁</li>
</ul>
<p>注意：</p>
<ul>
<li>如果函数中定义了普通变量，且名称和局部变量相同，则使用本地变量</li>
<li>由于普通变量和局部变量会冲突，建议在函数只使用本地变量</li>
</ul>
<p>在函数中定义本地变量的方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">local</span> NAME=VALUE</span><br></pre></td></tr></table></figure>

<h3 id="4-7-函数递归"><a href="#4-7-函数递归" class="headerlink" title="4.7 函数递归"></a>4.7 函数递归</h3><p>函数直接或间接调用自身称为函数的递归，注意递归层数，可能会陷入死循环</p>
<p>递归特点：</p>
<ul>
<li>函数内部自己调用自己</li>
<li>必须有结束函数的出口语句，防止死循环</li>
</ul>
<p>Example：给定一个整数参数，求它的阶乘</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment">#cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">fact</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$1</span> -eq 0 -o <span class="variable">$1</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> 1</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> $[<span class="variable">$1</span>*$(fact $[<span class="variable">$1</span>-1])]</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line">fact <span class="variable">$1</span></span><br></pre></td></tr></table></figure>

<h3 id="练习-6"><a href="#练习-6" class="headerlink" title="练习"></a>练习</h3><p>1、编写函数，实现OS的版本判断</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">os_version</span></span>() &#123;</span><br><span class="line">	sed -nr <span class="string">&#x27;/PRETTY_NAME/s#.*&quot;(.*)&quot;#\1#p&#x27;</span> /etc/os-release</span><br><span class="line">&#125;</span><br><span class="line">os_version</span><br></pre></td></tr></table></figure>

<p>2、编写函数，实现取出当前系统eth0的IP地址</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">IPaddress</span></span>() &#123;</span><br><span class="line">	ifconfig ens33 | awk <span class="string">&#x27;/\&lt;inet\&gt;/&#123;print $2&#125;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">IPaddress</span><br></pre></td></tr></table></figure>

<p>3、编写函数，实现打印绿色OK和红色FAILED</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">Green_ok</span></span>() &#123;</span><br><span class="line">	<span class="built_in">echo</span> -e <span class="string">&quot;\E[1;32mOK\E[0m&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">Red_failed</span></span>() &#123;</span><br><span class="line">	<span class="built_in">echo</span> -e <span class="string">&quot;\E[1;31mFAILED\E[0m&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">Green_ok</span><br><span class="line">Red_failed</span><br></pre></td></tr></table></figure>

<p>4、编写函数，事先判断是否无位置参数，若没有，提示错误</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">Determine_positional_parameters</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$1</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> -e <span class="string">&quot;\E[1;31mERROR! No positional parameters.\E[0m&quot;</span>;<span class="built_in">exit</span>	</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line">Determine_positional_parameters <span class="variable">$#</span></span><br></pre></td></tr></table></figure>

<p>5、编写函数，实现两个数字做参数，返回最大值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">Determine_positional_parameters</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$1</span> -lt 2 ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> -e <span class="string">&quot;\E[1;31mERROR! Please input two positional parameters.\E[0m&quot;</span>;<span class="built_in">exit</span>	</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">MAX</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$1</span> -gt <span class="variable">$2</span> ];<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;MAX=<span class="variable">$1</span>&quot;</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">&quot;MAX=<span class="variable">$2</span>&quot;</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Determine_positional_parameters <span class="variable">$#</span></span><br><span class="line">MAX <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>6、编写服务脚本 ‘&#x2F;root&#x2F;bin&#x2F;testsrv.sh’，完成如下要求</p>
<p>（1）脚本可接收参数：start，stop，restart，status</p>
<p>（2）如果参数非四者之一，提示使用格式后报错退出</p>
<p>（3）如果是 start：则创建 &#x2F;var&#x2F;lock&#x2F;subsys&#x2F;SCRIPT_NAME，并显示“启动成功”</p>
<p>​		 考虑：如果事先已经启动过一次，该如何处理？</p>
<p>（4）如果是 stop：则删除 &#x2F;var&#x2F;lock&#x2F;subsys&#x2F;SCRIPT_NAME，并显示“停止完成”</p>
<p>​		 考虑：如果已经停止了，该如何处理？</p>
<p>（5）如果是restart，则先stop，在start</p>
<p>​		 考虑：如果本来没有start，如何处理？</p>
<p>（6）如果是 status，当 &#x2F;var&#x2F;lock&#x2F;subsys&#x2F;SCRIPT_NAME 文件存在，则显示 “SCRIPT_NAME is running …”；当 &#x2F;var&#x2F;lock&#x2F;subsys&#x2F;SCRIPT_NAME 文件不存在，则显示“SCRIPT_NAME is stopped …”</p>
<p>（7）在所有模式下禁止启动该服务，可用 chkconfig 和 service 命令管理</p>
<p>说明：SCRIPT_NAME 为当前脚本名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>7、编写脚本 &#x2F;root&#x2F;bin&#x2F;copycmd.sh</p>
<p>（1）提示用户输入一个可执行命令名称<br>（2）获取此命令所依赖到的所有库文件列表<br>（3）复制命令至某目标目录(例如&#x2F;mnt&#x2F;sysroot)下的对应路径下</p>
<p>​          如：&#x2F;bin&#x2F;bash &#x3D;&#x3D;&gt; &#x2F;mnt&#x2F;sysroot&#x2F;bin&#x2F;bash</p>
<p>​                 &#x2F;usr&#x2F;bin&#x2F;passwd &#x3D;&#x3D;&gt; &#x2F;mnt&#x2F;sysroot&#x2F;usr&#x2F;bin&#x2F;passwd<br>（4）复制此命令依赖到的所有库文件至目标目录下的对应路径下： 如：&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 &#x3D;&#x3D;&gt; &#x2F;mnt&#x2F;sysroot&#x2F;lib64&#x2F;ld-linux-x86-64.so.2</p>
<p>（5）每次复制完成一个命令后，不要退出，而是提示用户键入新的要复制的命令，并重复完成上述功能；直到用户输入quit退出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>8、斐波那契数列又称黄金分割数列，因数学家列昂纳多·斐波那契以兔子繁殖为例子而引入，所以又被称为“兔子数列”，指的是这样一个数列：0、1、1、2、3、5、8、13、21、34、……，斐波纳契数列以如下被以递归的方法定义：F（0）&#x3D;0，F（1）&#x3D;1，F（n）&#x3D;F(n-1)+F(n-2)（n≥2），利用函数，求n阶斐波那契数列</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>9、汉诺塔（又称河内塔）问题是源于印度一个古老传说。大梵天创造世界的时候做了三根金刚石柱子，在一根柱子上从下往上按照大小顺序摞着64片黄金圆盘。大梵天命令婆罗门把圆盘从下面开始按大小顺序重新摆放在另一根柱子上。并且规定，在小圆盘上不能放大圆盘，在三根柱子之间一次只能移动一个圆盘，利用函数，实现N片盘的汉诺塔的移动步骤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="五、其它脚本相关工具"><a href="#五、其它脚本相关工具" class="headerlink" title="五、其它脚本相关工具"></a>五、其它脚本相关工具</h2><h3 id="5-1-信号捕捉-trap"><a href="#5-1-信号捕捉-trap" class="headerlink" title="5.1 信号捕捉 trap"></a>5.1 信号捕捉 trap</h3><p>trap 命令可以捕捉信号，修改信号原来的功能，实现自定义功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># trap -l</span></span><br><span class="line"> 1) SIGHUP	 2) SIGINT	 3) SIGQUIT	 4) SIGILL	 5) SIGTRAP</span><br><span class="line"> 6) SIGABRT	 7) SIGBUS	 8) SIGFPE	 9) SIGKILL	10) SIGUSR1</span><br><span class="line">11) SIGSEGV	12) SIGUSR2	13) SIGPIPE	14) SIGALRM	15) SIGTERM</span><br><span class="line">16) SIGSTKFLT	17) SIGCHLD	18) SIGCONT	19) SIGSTOP	20) SIGTSTP</span><br><span class="line">21) SIGTTIN	22) SIGTTOU	23) SIGURG	24) SIGXCPU	25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM	27) SIGPROF	28) SIGWINCH	29) SIGIO	30) SIGPWR</span><br><span class="line">31) SIGSYS	34) SIGRTMIN	35) SIGRTMIN+1	36) SIGRTMIN+2	37) SIGRTMIN+3</span><br><span class="line">38) SIGRTMIN+4	39) SIGRTMIN+5	40) SIGRTMIN+6	41) SIGRTMIN+7	42) SIGRTMIN+8</span><br><span class="line">43) SIGRTMIN+9	44) SIGRTMIN+10	45) SIGRTMIN+11	46) SIGRTMIN+12	47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14	49) SIGRTMIN+15	50) SIGRTMAX-14	51) SIGRTMAX-13	52) SIGRTMAX-12</span><br><span class="line">53) SIGRTMAX-11	54) SIGRTMAX-10	55) SIGRTMAX-9	56) SIGRTMAX-8	57) SIGRTMAX-7</span><br><span class="line">58) SIGRTMAX-6	59) SIGRTMAX-5	60) SIGRTMAX-4	61) SIGRTMAX-3	62) SIGRTMAX-2</span><br><span class="line">63) SIGRTMAX-1	64) SIGRTMAX	</span><br></pre></td></tr></table></figure>

<p>常用操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## &#x27;信号&#x27;可写全称；也可不写前三个字母，写简称；或写数字法描述（例：SIGINT INT 2）</span></span><br><span class="line"><span class="comment"># 进程收到系统发出的指定信号后，将执行自定义指令，而不会执行原操作</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;触发指令&#x27;</span> 信号</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略信号操作</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;&#x27;</span> 信号</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出自定义信号操作</span></span><br><span class="line"><span class="built_in">trap</span> -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当脚本退出时，执行finish函数</span></span><br><span class="line"><span class="built_in">trap</span> finish EXIT</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ctrl+c 即2信号: SIGINT; ctrl+\ 即3信号: SIGQUIT</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo &#x27;Press ctrl+c or ctrl+\&#x27;&quot;</span> int quit</span><br><span class="line"><span class="built_in">trap</span> -p</span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">0</span>;i&lt;=<span class="number">10</span>;i++));<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">sleep</span> 1</span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;&#x27;</span> int</span><br><span class="line"><span class="built_in">trap</span> -p</span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">11</span>;i&lt;=<span class="number">20</span>;i++));<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&#x27;-&#x27;</span> int</span><br><span class="line"><span class="built_in">trap</span> -p</span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">21</span>;i&lt;=<span class="number">30</span>;i++));<span class="keyword">do</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>示例：当脚本正常或异常退出时，会执行finish函数来确保一定会执行某些关键性的操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">finish</span></span>() &#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;finish_`date +%F_%T`&quot;</span> | <span class="built_in">tee</span> -a /root/finish.log</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">trap</span> finish <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> running</span><br><span class="line">	<span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-创建临时文件-mktemp"><a href="#5-2-创建临时文件-mktemp" class="headerlink" title="5.2 创建临时文件 mktemp"></a>5.2 创建临时文件 mktemp</h3><p>mktemp 命令用于创建并显示临时文件，避免文件冲突导致源文件被覆盖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mktemp</span> [OPTION]... [TEMPLATE]</span><br><span class="line"></span><br><span class="line">Note: </span><br><span class="line">	TEMPLATE: filenameXXX, 至少三个X</span><br></pre></td></tr></table></figure>

<p>常用选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-d                      创建临时目录</span><br><span class="line">-p DIR 或 --tmpdir=DIR  指明临时文件所存放目录位置</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># mktemp </span></span><br><span class="line">/tmp/tmp.YTJUtsVWbC</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mktemp /tmp/testXXXXX</span></span><br><span class="line">/tmp/test4FWuR</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mktemp -d /tmp/testXXX</span></span><br><span class="line">/tmp/testz2i</span><br></pre></td></tr></table></figure>

<p>示例：实现文件垃圾箱</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">DIR=`<span class="built_in">mktemp</span> -d /tmp/trash-$(<span class="built_in">date</span> +%F_%H)XXXXX`</span><br><span class="line"><span class="built_in">mv</span> $* <span class="variable">$DIR</span></span><br><span class="line"><span class="built_in">echo</span> $* is move to <span class="variable">$DIR</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># alias rm=/root/test.sh</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-安装复制文件-install"><a href="#5-3-安装复制文件-install" class="headerlink" title="5.3 安装复制文件 install"></a>5.3 安装复制文件 install</h3><p>install 功能相当于cp, chmod, chown, chgrp, mkdir 等相关工具的集合</p>
<p>选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-m MODE, 默认755</span><br><span class="line">-o OWNER</span><br><span class="line">-g GROUP</span><br><span class="line">-d DIRNAME 目录</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># install -m 700 -o wh -g wh /etc/issue /tmp/issue</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># ll /tmp/issue </span></span><br><span class="line">-rwx------ 1 wh wh 23 Nov  5 09:23 /tmp/issue</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># install -m 700 -o wh -g wh -d /tmp/testdir</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># ll -d /tmp/testdir/</span></span><br><span class="line">drwx------ 2 wh wh 6 Nov  5 09:24 /tmp/testdir/</span><br></pre></td></tr></table></figure>

<h3 id="5-4-交互式转化批处理工具-expect"><a href="#5-4-交互式转化批处理工具-expect" class="headerlink" title="5.4 交互式转化批处理工具 expect"></a>5.4 交互式转化批处理工具 expect</h3><p>expect 主要应用于自动化交互式操作的场景，通过expect处理交互的命令，可以将交互过程，如 ssh 登录，ftp 登录等写在脚本上，使之自动化完成。</p>
<p>示例：安装 expect 及 mkpasswd 工具使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># dnf -y install expect</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># rpm -ql expect | head</span></span><br><span class="line">/usr/bin/autoexpect</span><br><span class="line">/usr/bin/dislocate</span><br><span class="line">/usr/bin/expect</span><br><span class="line">/usr/bin/ftp-rfc</span><br><span class="line">/usr/bin/kibitz</span><br><span class="line">/usr/bin/lpunlock</span><br><span class="line">/usr/bin/mkpasswd</span><br><span class="line">/usr/bin/passmass</span><br><span class="line">/usr/bin/rftp</span><br><span class="line">/usr/bin/rlogin-cwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># -l 指定密码的长度 -d 指定生成的密码中数字出现的次数 -C 指定大写字母出现的次数</span></span><br><span class="line"><span class="comment"># 其余可参看 man mkpasswd</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mkpasswd -l 15 -d 3 -C 5</span></span><br><span class="line">cT<span class="variable">$jf76y1GGCAfu</span></span><br></pre></td></tr></table></figure>

<p>expect 相关命令</p>
<ul>
<li>spawn                 启动新进程</li>
<li>expect                 从进程接收字符串</li>
<li>send                    用于向进程发送字符串</li>
<li>interact                允许用户交互</li>
<li>exp_continue      匹配多个字符串</li>
</ul>
<p>单一分支模式语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># expect</span></span><br><span class="line">expect1.1&gt; expect <span class="string">&quot;Tom&quot;</span> &#123;send <span class="string">&quot;I am Jerry!&quot;</span>&#125;</span><br><span class="line">hi,Tom</span><br><span class="line">I am Jerry!</span><br></pre></td></tr></table></figure>

<p>多分支语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># expect</span></span><br><span class="line">expect1.1&gt; expect <span class="string">&quot;hi&quot;</span> &#123;send <span class="string">&quot;hi\n&quot;</span>&#125; <span class="string">&quot;hello&quot;</span> &#123;send <span class="string">&quot;hello\n&quot;</span>&#125;</span><br><span class="line">hihellohihello</span><br><span class="line">hi</span><br><span class="line">expect1.2&gt; expect <span class="string">&quot;hi&quot;</span> &#123;send <span class="string">&quot;hi\n&quot;</span>&#125; <span class="string">&quot;hello&quot;</span> &#123;send <span class="string">&quot;hello\n&quot;</span>&#125;</span><br><span class="line">hlhello</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>

<p>示例1：非交互式复制文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/expect</span></span><br><span class="line">spawn scp /etc/os-release 192.168.119.166:/data</span><br><span class="line">expect &#123;</span><br><span class="line">	<span class="string">&quot;yes/no&quot;</span> &#123; send <span class="string">&quot;yes\n&quot;</span>;exp_continue &#125;</span><br><span class="line">	<span class="string">&quot;password&quot;</span> &#123; send <span class="string">&quot;wuhaolam\n&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">expect eof</span><br></pre></td></tr></table></figure>

<p>示例2：自动登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/expect</span></span><br><span class="line">spawn ssh 192.168.119.166</span><br><span class="line">expect &#123;</span><br><span class="line">	<span class="string">&quot;yes/no&quot;</span> &#123; send <span class="string">&quot;yes\n&quot;</span>;exp_continue &#125;</span><br><span class="line">	<span class="string">&quot;password&quot;</span> &#123; send <span class="string">&quot;wuhaolam\n&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">interact</span><br></pre></td></tr></table></figure>

<p>示例3：expect 变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat expect </span></span><br><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> ip 192.168.119.166</span><br><span class="line"><span class="built_in">set</span> user root</span><br><span class="line"><span class="built_in">set</span> password wuhaolam</span><br><span class="line"><span class="built_in">set</span> <span class="built_in">timeout</span> 10</span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line">	<span class="string">&quot;yes/no&quot;</span> &#123; send <span class="string">&quot;yes\n&quot;</span>; exp_continue &#125;</span><br><span class="line">	<span class="string">&quot;password&quot;</span> &#123; send <span class="string">&quot;<span class="variable">$password</span>\n&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">interact</span><br></pre></td></tr></table></figure>

<p>示例4：expect 位置参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat expect </span></span><br><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 0]</span><br><span class="line"><span class="built_in">set</span> ip [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> password [lindex <span class="variable">$argv</span> 2]</span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line">	<span class="string">&quot;yes/no&quot;</span> &#123; send <span class="string">&quot;yes\n&quot;</span>; exp_continue &#125;</span><br><span class="line">	<span class="string">&quot;password&quot;</span> &#123; send <span class="string">&quot;<span class="variable">$password</span>\n&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">interact</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># ./expect root 192.168.119.166 wuhaolam</span></span><br></pre></td></tr></table></figure>

<p>示例5：expect 执行多个命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat expect </span></span><br><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 0]</span><br><span class="line"><span class="built_in">set</span> ip [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> password [lindex <span class="variable">$argv</span> 2]</span><br><span class="line"></span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line">	<span class="string">&quot;yes/no&quot;</span> &#123; send <span class="string">&quot;yes\n&quot;</span>; exp_continue &#125;</span><br><span class="line">	<span class="string">&quot;password&quot;</span> &#123; send <span class="string">&quot;<span class="variable">$password</span>\n&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">expect <span class="string">&quot;]#&quot;</span> &#123; send <span class="string">&quot;useradd Tom\n&quot;</span> &#125;</span><br><span class="line">expect <span class="string">&quot;]#&quot;</span> &#123; send <span class="string">&quot;id Tom\n&quot;</span> &#125;</span><br><span class="line">send <span class="string">&quot;exit\n&quot;</span></span><br><span class="line">expect eof</span><br></pre></td></tr></table></figure>

<p>示例6：shell 脚本调用 expect</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat test.sh </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">user=<span class="variable">$1</span></span><br><span class="line">ip=<span class="variable">$2</span></span><br><span class="line">password=<span class="variable">$3</span></span><br><span class="line">expect &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">spawn ssh $user@$ip</span></span><br><span class="line"><span class="string">expect &#123;</span></span><br><span class="line"><span class="string">	&quot;yes/no&quot; &#123; send &quot;yes\n&quot;; exp_continue &#125;</span></span><br><span class="line"><span class="string">	&quot;password&quot; &#123; send &quot;$password\n&quot; &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">expect &quot;]#&quot; &#123; send &quot;userdel -r Tom\n&quot; &#125;</span></span><br><span class="line"><span class="string">expect &quot;]#&quot; &#123; send &quot;id Tom\n&quot; &#125;</span></span><br><span class="line"><span class="string">expect &quot;]#&quot; &#123; send &quot;exit\n&quot; &#125;</span></span><br><span class="line"><span class="string">expect eof</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h2 id="六、数组-array"><a href="#六、数组-array" class="headerlink" title="六、数组 array"></a>六、数组 array</h2><h3 id="6-1-数据介绍"><a href="#6-1-数据介绍" class="headerlink" title="6.1 数据介绍"></a>6.1 数据介绍</h3><p>变量：存储单个元素的内存空间</p>
<p>数组：存储多个元素的连续的内存空间，相当于多个变量的集合</p>
<p>数组名和索引</p>
<ul>
<li>索引的编号从0开始，属于数值索引</li>
<li>索引可支持使用自定义的格式，而不仅是数值的格式，即为<strong>关联索引</strong>，bash4.0之后支持</li>
<li>bash 的数组支持稀疏格式（索引不连续）</li>
</ul>
<h3 id="6-2-声明数组"><a href="#6-2-声明数组" class="headerlink" title="6.2 声明数组"></a>6.2 声明数组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 普通数组可不用事先声明，直接使用</span></span><br><span class="line"><span class="built_in">declare</span> -a ARRAY_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关联数组必须实现声明再使用</span></span><br><span class="line"><span class="built_in">declare</span> -A ARRAY_NAME</span><br><span class="line"></span><br><span class="line">注：普通数组和关联数组不可相互转换</span><br></pre></td></tr></table></figure>

<h3 id="6-3-数组赋值"><a href="#6-3-数组赋值" class="headerlink" title="6.3 数组赋值"></a>6.3 数组赋值</h3><p>1、一次只赋值一个元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ARRAY_NAME[INDEX]=VALUE</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># name[0]=Tom</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># name[1]=Jerry</span></span><br></pre></td></tr></table></figure>

<p>2、一次性赋值全部元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ARRAY_NAME=(<span class="string">&quot;VAL1&quot;</span> <span class="string">&quot;VAL2&quot;</span> <span class="string">&quot;VAL3&quot;</span> ...)</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># name=(&quot;Tom&quot; &quot;Jerry&quot; &quot;Snoopy&quot;)</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># nums=(&#123;0..10&#125;)</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># file=( *.sh )</span></span><br></pre></td></tr></table></figure>

<p>3、只赋值特定元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARRAY_NAME=([0]=<span class="string">&quot;VAL1&quot;</span> [2]=<span class="string">&quot;VAL2&quot;</span> ...)</span><br></pre></td></tr></table></figure>

<p>4、交互式赋值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">read</span> -a ARRAY</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># read -a names</span></span><br><span class="line">wang wu zhou zheng</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;names[*]&#125;</span></span><br><span class="line">wang wu zhou zheng</span><br></pre></td></tr></table></figure>

<h3 id="6-4-显示所有数组"><a href="#6-4-显示所有数组" class="headerlink" title="6.4 显示所有数组"></a>6.4 显示所有数组</h3><p>显示所有数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -a</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># declare -a</span></span><br><span class="line"><span class="built_in">declare</span> -a BASH_ARGC=()</span><br><span class="line"><span class="built_in">declare</span> -a BASH_ARGV=()</span><br><span class="line"><span class="built_in">declare</span> -a BASH_COMPLETION_VERSINFO=([0]=<span class="string">&quot;2&quot;</span> [1]=<span class="string">&quot;7&quot;</span>)</span><br><span class="line"><span class="built_in">declare</span> -a BASH_LINENO=()</span><br><span class="line"><span class="built_in">declare</span> -a BASH_SOURCE=()</span><br><span class="line"><span class="built_in">declare</span> -ar BASH_VERSINFO=([0]=<span class="string">&quot;4&quot;</span> [1]=<span class="string">&quot;4&quot;</span> [2]=<span class="string">&quot;20&quot;</span> [3]=<span class="string">&quot;1&quot;</span> [4]=<span class="string">&quot;release&quot;</span> [5]=<span class="string">&quot;x86_64-redhat-linux-gnu&quot;</span>)</span><br><span class="line"><span class="built_in">declare</span> -a DIRSTACK=()</span><br><span class="line"><span class="built_in">declare</span> -a FUNCNAME</span><br><span class="line"><span class="built_in">declare</span> -a GROUPS=()</span><br><span class="line"><span class="built_in">declare</span> -a PIPESTATUS=([0]=<span class="string">&quot;2&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="6-5-引用数组"><a href="#6-5-引用数组" class="headerlink" title="6.5 引用数组"></a>6.5 引用数组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;ARRAY_NAME[INDEX]&#125;</span></span><br><span class="line"><span class="comment"># 如果省略[INDEX],表示引用下标为0的元素</span></span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># name=(&quot;Tom&quot; &quot;Jerry&quot; &quot;Snoopy&quot;)</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;name&#125;</span></span><br><span class="line">Tom</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;name[1]&#125;</span></span><br><span class="line">Jerry</span><br></pre></td></tr></table></figure>

<p>引用数组中所有元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;ARRAY_NAME[*]&#125;</span></span><br><span class="line"><span class="variable">$&#123;ARRAY_NAME[@]&#125;</span></span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;name[*]&#125;</span></span><br><span class="line">Tom Jerry Snoopy</span><br></pre></td></tr></table></figure>

<p>数组的长度，即数组中所有元素的个数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#ARRAY_NAME[*]&#125;</span></span><br><span class="line"><span class="variable">$&#123;#ARRAY_NAME[@]&#125;</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;#name[*]&#125;</span></span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h3 id="6-6-删除数组"><a href="#6-6-删除数组" class="headerlink" title="6.6 删除数组"></a>6.6 删除数组</h3><p>删除数组中某个元素时，会导致稀疏格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> ARRAY[INDEX]</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># unset name[1]</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;name[*]&#125;</span></span><br><span class="line">Tom Snoopy</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;name[1]&#125;</span></span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;name[2]&#125;</span></span><br><span class="line">Snoopy</span><br></pre></td></tr></table></figure>

<p>删除整个数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># unset name</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;name[*]&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-7-数组数据处理"><a href="#6-7-数组数据处理" class="headerlink" title="6.7 数组数据处理"></a>6.7 数组数据处理</h3><p>数组切片</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;ARRAY[@]:offset:number&#125;</span></span><br><span class="line">offset    <span class="comment"># 要跳过的元素个数</span></span><br><span class="line">number    <span class="comment"># 要取出的元素个数</span></span><br><span class="line"><span class="variable">$&#123;ARRAY[@]:offset&#125;</span> 取偏移量之后的所有元素</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># nums=(&#123;1..10&#125;)</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;nums[*]:2:3&#125;</span></span><br><span class="line">3 4 5</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;nums[*]:2&#125;</span></span><br><span class="line">3 4 5 6 7 8 9 10</span><br></pre></td></tr></table></figure>

<p>向数组中追加元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ARRAY[<span class="variable">$&#123;#ARRAY[*]&#125;</span>]=value</span><br><span class="line">ARRAY[<span class="variable">$&#123;#ARRAY[@]&#125;</span>]=value</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;nums[*]&#125;</span></span><br><span class="line">1 2 3 4 5 6 7 8 9 10</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># nums[$&#123;#nums[*]&#125;]=11</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;nums[*]&#125;</span></span><br><span class="line">1 2 3 4 5 6 7 8 9 10 11</span><br></pre></td></tr></table></figure>

<h3 id="6-8-关联数组"><a href="#6-8-关联数组" class="headerlink" title="6.8 关联数组"></a>6.8 关联数组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -A ARRAY_NAME</span><br><span class="line">ARRAY_NAME=([idex1]=<span class="string">&#x27;val1&#x27;</span> [idex2]=<span class="string">&#x27;val2&#x27;</span>...)</span><br><span class="line"><span class="comment"># 关联数组必须先声明再调用</span></span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># unset names</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># declare -A names</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># names[one]=Tom</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># names[two]=Jerry</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;names[one]&#125;</span></span><br><span class="line">Tom</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;names[two]&#125;</span></span><br><span class="line">Jerry</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># echo $&#123;names[*]&#125;</span></span><br><span class="line">Jerry Tom</span><br><span class="line"></span><br><span class="line">example:</span><br><span class="line">root@ubuntu18-server:~<span class="comment"># declare -A SUB</span></span><br><span class="line">root@ubuntu18-server:~<span class="comment"># SUB=([contry]=&#x27;CN&#x27; [provice]=&#x27;AnHui&#x27; [company]=&#x27;Tsinglink&#x27; [dept]=&#x27;IT&#x27;)</span></span><br><span class="line">root@ubuntu18-server:~<span class="comment"># echo $&#123;SUB[*]&#125;</span></span><br><span class="line">AnHui Tsinglink IT CN</span><br><span class="line">root@ubuntu18-server:~<span class="comment"># contry=$&#123;SUB[contry]&#125;;echo $contry</span></span><br><span class="line">CN</span><br></pre></td></tr></table></figure>

<h3 id="6-9-示例"><a href="#6-9-示例" class="headerlink" title="6.9 示例"></a>6.9 示例</h3><p>Example1：生成10个随机数保存于数组中，并找出最大值和最小值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># cat test.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -i MIN MAX</span><br><span class="line"><span class="built_in">declare</span> -a nums</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  nums[<span class="variable">$i</span>]=<span class="variable">$RANDOM</span></span><br><span class="line">  [ <span class="variable">$i</span> -eq 0 ] &amp;&amp; MIN=<span class="variable">$&#123;nums[0]&#125;</span> &amp;&amp; MAX=<span class="variable">$&#123;nums[0]&#125;</span> &amp;&amp; <span class="built_in">continue</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\E[1;39mAll numbers: <span class="variable">$&#123;nums[*]&#125;</span>\E[0m&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;nums[$i]&#125;</span> -gt <span class="variable">$MAX</span>  ];<span class="keyword">then</span></span><br><span class="line">    MAX=<span class="variable">$&#123;nums[$i]&#125;</span></span><br><span class="line">  <span class="keyword">elif</span> [ <span class="variable">$&#123;nums[$i]&#125;</span> -lt <span class="variable">$MIN</span> ];<span class="keyword">then</span></span><br><span class="line">    MIN=<span class="variable">$&#123;nums[$i]&#125;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;The MAX value: \E[1;32m<span class="variable">$MAX</span>\E[0m\nThe MIN value: \E[1;32m<span class="variable">$MIN</span>\E[0m&quot;</span></span><br></pre></td></tr></table></figure>

<p>Example2：编写脚本，定义一个数组，数组中的元素对应的值是&#x2F;var&#x2F;log目录下所有以.log结尾的文件；统计出其下标为偶数的文件中的行数之和</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="七、字符串处理"><a href="#七、字符串处理" class="headerlink" title="七、字符串处理"></a>七、字符串处理</h2><h2 id="八、高级变量"><a href="#八、高级变量" class="headerlink" title="八、高级变量"></a>八、高级变量</h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://wuhaolam.github.io">Wu Hao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wuhaolam.github.io/archives/c5a7de75.html">https://wuhaolam.github.io/archives/c5a7de75.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wuhaolam.github.io" target="_blank">穿着草鞋前往</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Shell%E8%84%9A%E6%9C%AC/">Shell脚本</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/%E5%A4%B4%E5%83%8F.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/be55afaa.html" title="软件管理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">软件管理</div></div></a></div><div class="next-post pull-right"><a href="/archives/8b87eef8.html" title="文本处理三剑客"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">文本处理三剑客</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NzA1My8zMzUxNw=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Wu Hao</div><div class="author-info__description">欢迎来到吴浩的博客！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wuhaolam/" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wuhaolam@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://weibo.com/u/6551419807" rel="external nofollow noreferrer" target="_blank" title="微博"><i class="fa-brands fa-weibo"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">个人博客，仅供参考学习。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Shell-%E8%84%9A%E6%9C%AC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-text">一、Shell 脚本的基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Shell-%E8%84%9A%E6%9C%AC%E7%9A%84%E7%94%A8%E9%80%94"><span class="toc-text">1.1 Shell 脚本的用途</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Shell-%E8%84%9A%E6%9C%AC%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-text">1.2 Shell 脚本的基本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Shell-%E8%84%9A%E6%9C%AC%E6%B3%A8%E9%87%8A%E8%A7%84%E8%8C%83"><span class="toc-text">1.3 Shell 脚本注释规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95Shell%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B"><span class="toc-text">1.4 第一个简单Shell脚本示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E8%84%9A%E6%9C%AC%E8%B0%83%E8%AF%95"><span class="toc-text">1.5 脚本调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-%E5%8F%98%E9%87%8F"><span class="toc-text">1.6 变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-1-%E5%8F%98%E9%87%8F"><span class="toc-text">1.6.1 变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-2-Shell-%E4%B8%AD%E5%8F%98%E9%87%8F%E7%9A%84%E5%91%BD%E5%90%8D%E6%B3%95%E5%88%99"><span class="toc-text">1.6.2 Shell 中变量的命名法则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-3-%E5%8F%98%E9%87%8F%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E5%BC%95%E7%94%A8"><span class="toc-text">1.6.3 变量的定义和引用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-4-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text">1.6.4 环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-5-%E5%8F%AA%E8%AF%BB%E5%8F%98%E9%87%8F"><span class="toc-text">1.6.5 只读变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-6-%E4%BD%8D%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-text">1.6.6 位置变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-7-%E9%80%80%E5%87%BA%E7%8A%B6%E6%80%81%E7%A0%81%E5%8F%98%E9%87%8F"><span class="toc-text">1.6.7 退出状态码变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-8-%E5%B1%95%E5%BC%80%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-text">1.6.8 展开命令行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-9-%E8%84%9A%E6%9C%AC%E5%AE%89%E5%85%A8%E5%92%8Cset"><span class="toc-text">1.6.9 脚本安全和set</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA-printf"><span class="toc-text">1.7 格式化输出 printf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97"><span class="toc-text">1.8 算数运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-9-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-text">1.9 逻辑运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-10-%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%91%BD%E4%BB%A4"><span class="toc-text">1.10 条件测试命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-10-1-%E5%8F%98%E9%87%8F%E6%B5%8B%E8%AF%95"><span class="toc-text">1.10.1 变量测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-10-2-%E6%95%B0%E5%80%BC%E6%B5%8B%E8%AF%95"><span class="toc-text">1.10.2 数值测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-10-3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%B5%8B%E8%AF%95"><span class="toc-text">1.10.3 字符串测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-10-4-%E6%96%87%E4%BB%B6%E6%B5%8B%E8%AF%95"><span class="toc-text">1.10.4 文件测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-11-%E5%85%B3%E4%BA%8E-%E4%B8%8E"><span class="toc-text">1.11 关于 () 与 {}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-12-%E7%BB%84%E5%90%88%E6%B5%8B%E8%AF%95%E6%9D%A1%E4%BB%B6"><span class="toc-text">1.12 组合测试条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-1-%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-text">1.12.1 第一种方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-12-2-%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-text">1.12.2 第二种方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-1"><span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-13-%E6%8E%A5%E6%94%B6%E9%94%AE%E7%9B%98%E7%9A%84%E8%BE%93%E5%85%A5%E2%80%94read%E5%91%BD%E4%BB%A4"><span class="toc-text">1.13 接收键盘的输入—read命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81bash-shell-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">二、bash shell 配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%8C%89%E7%85%A7%E7%94%9F%E6%95%88%E8%8C%83%E5%9B%B4%E5%88%92%E5%88%86"><span class="toc-text">2.1 按照生效范围划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-shell-%E7%99%BB%E5%BD%95%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%88%86%E7%B1%BB"><span class="toc-text">2.2 shell 登录两种方式分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%99%BB%E5%BD%95"><span class="toc-text">2.2.1 交互式登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E9%9D%9E%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%99%BB%E5%BD%95"><span class="toc-text">2.2.2 非交互式登录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%8C%89%E7%85%A7%E5%8A%9F%E8%83%BD%E5%88%92%E5%88%86"><span class="toc-text">2.3 按照功能划分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-profile-%E7%B1%BB"><span class="toc-text">2.3.1 profile 类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-bashrc-%E7%B1%BB"><span class="toc-text">2.3.2 bashrc 类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%94%9F%E6%95%88"><span class="toc-text">2.4 编辑配置文件生效</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E9%80%80%E5%87%BA%E4%BB%BB%E5%8A%A1"><span class="toc-text">2.5 退出任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-2"><span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-text">三、流程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%9D%A1%E4%BB%B6%E9%80%89%E6%8B%A9"><span class="toc-text">3.1 条件选择</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E9%80%89%E6%8B%A9%E6%89%A7%E8%A1%8C-if-%E8%AF%AD%E5%8F%A5"><span class="toc-text">3.1.1 选择执行 if 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD-case-%E8%AF%AD%E5%8F%A5"><span class="toc-text">3.1.2 条件判断 case 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-3"><span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%BE%AA%E7%8E%AF"><span class="toc-text">3.2 循环</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E5%BE%AA%E7%8E%AF-for"><span class="toc-text">3.2.1 循环 for</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F1"><span class="toc-text">格式1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F2"><span class="toc-text">格式2</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%EF%BC%88for%E5%AE%9E%E7%8E%B0%EF%BC%89"><span class="toc-text">练习（for实现）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%BE%AA%E7%8E%AF-while"><span class="toc-text">3.2.2 循环 while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-4"><span class="toc-text">练习</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E5%BE%AA%E7%8E%AF-until"><span class="toc-text">3.2.3 循环 until</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-continue-%E8%AF%AD%E5%8F%A5"><span class="toc-text">3.2.4 continue 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-break-%E8%AF%AD%E5%8F%A5"><span class="toc-text">3.2.5 break 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-6-shift%E5%91%BD%E4%BB%A4"><span class="toc-text">3.2.6 shift命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-5"><span class="toc-text">练习</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-7-while-%E7%89%B9%E6%AE%8A%E7%94%A8%E6%B3%95-while-read"><span class="toc-text">3.2.7 while 特殊用法 while read</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-8-%E5%BE%AA%E7%8E%AF%E4%B8%8E%E8%8F%9C%E5%8D%95-select"><span class="toc-text">3.2.8 循环与菜单 select</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%87%BD%E6%95%B0-function"><span class="toc-text">四、函数 function</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%AE%A1%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-text">4.1 管理函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-text">4.1.1 定义函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-%E6%9F%A5%E7%9C%8B%E5%87%BD%E6%95%B0"><span class="toc-text">4.1.2 查看函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-%E5%88%A0%E9%99%A4%E5%87%BD%E6%95%B0"><span class="toc-text">4.1.3 删除函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-text">4.2 函数调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-text">4.2.1 交互式环境下定义和使用函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-%E5%9C%A8%E8%84%9A%E6%9C%AC%E4%B8%AD%E5%AE%9A%E4%B9%89%E5%8F%8A%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-text">4.2.2 在脚本中定义及使用函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E6%96%87%E4%BB%B6"><span class="toc-text">4.2.3 使用函数文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">4.3 函数返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E7%8E%AF%E5%A2%83%E5%87%BD%E6%95%B0"><span class="toc-text">4.4 环境函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><span class="toc-text">4.5 函数参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E5%87%BD%E6%95%B0%E5%8F%98%E9%87%8F"><span class="toc-text">4.6 函数变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E5%87%BD%E6%95%B0%E9%80%92%E5%BD%92"><span class="toc-text">4.7 函数递归</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-6"><span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%85%B6%E5%AE%83%E8%84%9A%E6%9C%AC%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="toc-text">五、其它脚本相关工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BF%A1%E5%8F%B7%E6%8D%95%E6%8D%89-trap"><span class="toc-text">5.1 信号捕捉 trap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%88%9B%E5%BB%BA%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6-mktemp"><span class="toc-text">5.2 创建临时文件 mktemp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%AE%89%E8%A3%85%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6-install"><span class="toc-text">5.3 安装复制文件 install</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E4%BA%A4%E4%BA%92%E5%BC%8F%E8%BD%AC%E5%8C%96%E6%89%B9%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7-expect"><span class="toc-text">5.4 交互式转化批处理工具 expect</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%95%B0%E7%BB%84-array"><span class="toc-text">六、数组 array</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%95%B0%E6%8D%AE%E4%BB%8B%E7%BB%8D"><span class="toc-text">6.1 数据介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%A3%B0%E6%98%8E%E6%95%B0%E7%BB%84"><span class="toc-text">6.2 声明数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E6%95%B0%E7%BB%84%E8%B5%8B%E5%80%BC"><span class="toc-text">6.3 数组赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E6%98%BE%E7%A4%BA%E6%89%80%E6%9C%89%E6%95%B0%E7%BB%84"><span class="toc-text">6.4 显示所有数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E5%BC%95%E7%94%A8%E6%95%B0%E7%BB%84"><span class="toc-text">6.5 引用数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6-%E5%88%A0%E9%99%A4%E6%95%B0%E7%BB%84"><span class="toc-text">6.6 删除数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-7-%E6%95%B0%E7%BB%84%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-text">6.7 数组数据处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-%E5%85%B3%E8%81%94%E6%95%B0%E7%BB%84"><span class="toc-text">6.8 关联数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-%E7%A4%BA%E4%BE%8B"><span class="toc-text">6.9 示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86"><span class="toc-text">七、字符串处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E9%AB%98%E7%BA%A7%E5%8F%98%E9%87%8F"><span class="toc-text">八、高级变量</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/b2a531da.html" title="ansible role 实现 MySQL57 部署">ansible role 实现 MySQL57 部署</a><time datetime="2023-04-20T01:22:00.000Z" title="发表于 2023-04-20 09:22:00">2023-04-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/c27a22ea.html" title="ansible playbook 批量编译部署 nginx1.18">ansible playbook 批量编译部署 nginx1.18</a><time datetime="2023-04-20T01:22:00.000Z" title="发表于 2023-04-20 09:22:00">2023-04-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/fde1f0a.html" title="ansible role 实现 nginx1.18 部署">ansible role 实现 nginx1.18 部署</a><time datetime="2023-04-20T01:22:00.000Z" title="发表于 2023-04-20 09:22:00">2023-04-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/a580237d.html" title="ansible playbook 批量部署 MySQL5.7">ansible playbook 批量部署 MySQL5.7</a><time datetime="2023-04-20T01:22:00.000Z" title="发表于 2023-04-20 09:22:00">2023-04-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/441df178.html" title="利用LNMP架构实现WordPress部署"><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/wordpress.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="利用LNMP架构实现WordPress部署"/></a><div class="content"><a class="title" href="/archives/441df178.html" title="利用LNMP架构实现WordPress部署">利用LNMP架构实现WordPress部署</a><time datetime="2023-04-14T14:31:03.769Z" title="发表于 2023-04-14 22:31:03">2023-04-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By Wu Hao</div><div class="footer_custom_text"><div><a onclick="window.open('https://beian.miit.gov.cn')">皖ICP备2023003329号</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>