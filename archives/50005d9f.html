<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>磁盘存储和文件系统管理 | 穿着草鞋前往</title><meta name="author" content="Wu Hao"><meta name="copyright" content="Wu Hao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Linux中文件系统类型和对文件系统的管理"><link rel="shortcut icon" href="/img/image.jpg"><link rel="canonical" href="https://wuhaolam.github.io/archives/50005d9f.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-sPKc2fWStl"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '磁盘存储和文件系统管理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-30 21:01:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/%E5%A4%B4%E5%83%8F.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="穿着草鞋前往"><span class="site-name">穿着草鞋前往</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">磁盘存储和文件系统管理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-06T00:15:00.000Z" title="发表于 2022-11-06 08:15:00">2022-11-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-30T13:01:57.390Z" title="更新于 2022-11-30 21:01:57">2022-11-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux%E5%9F%BA%E7%A1%80/">Linux基础</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="磁盘存储和文件系统管理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一、磁盘结构"><a href="#一、磁盘结构" class="headerlink" title="一、磁盘结构"></a>一、磁盘结构</h1><h2 id="1-1-设备文件"><a href="#1-1-设备文件" class="headerlink" title="1.1 设备文件"></a>1.1 设备文件</h2><p>设备文件：关联至一个设备驱动程序，进而能够跟与之对应硬件设备进行通信</p>
<p>设备号码：</p>
<ul>
<li>主设备号：标识设备类型，如 &#x2F;dev&#x2F;sda，&#x2F;dev&#x2F;sdb …</li>
<li>次设备号：标识同一类型下的不同设备，如 sda1，sda2 …</li>
</ul>
<p>设备类型：</p>
<ul>
<li>块设备：block，存取单位为“块”，磁盘</li>
<li>字符设备：char，存取单位“字符”，键盘</li>
</ul>
<h1 id="二、管理存储"><a href="#二、管理存储" class="headerlink" title="二、管理存储"></a>二、管理存储</h1><h2 id="2-1-磁盘分区"><a href="#2-1-磁盘分区" class="headerlink" title="2.1 磁盘分区"></a>2.1 磁盘分区</h2><h3 id="2-1-1-分区的原因"><a href="#2-1-1-分区的原因" class="headerlink" title="2.1.1 分区的原因"></a>2.1.1 分区的原因</h3><ul>
<li>优化 I&#x2F;O 性能</li>
<li>实现磁盘空间配额限制</li>
<li>提高修复速度</li>
<li>隔离系统和程序</li>
<li>安装多个 OS</li>
<li>采用不同的文件系统</li>
</ul>
<h3 id="2-1-2-分区的方式"><a href="#2-1-2-分区的方式" class="headerlink" title="2.1.2 分区的方式"></a>2.1.2 分区的方式</h3><p>两种方式：MBR 和 GPT</p>
<h4 id="2-1-2-1-MBR-分区"><a href="#2-1-2-1-MBR-分区" class="headerlink" title="2.1.2.1 MBR 分区"></a>2.1.2.1 MBR 分区</h4><p>MBR: Master Boot Record，使用32位表示扇区数，分区不超过2T</p>
<p>0磁道0扇区: 512Bytes</p>
<p>​    446 bytes: boot loader 启动相关</p>
<p>​    64 bytes: 分区表，其中每 16 bytes 标识一个分区</p>
<p>​    2 bytes: 55AA</p>
<p>MBR 分区中一块硬盘最多有四个主分区，或者3个主分区+一个扩展分区（N个逻辑分区）</p>
<p>MBR 分区: 主和扩展分区为 1-4，逻辑分区从5开始</p>
<p>MBR（硬盘主引导记录）由4个部分组成</p>
<table>
<thead>
<tr>
<th align="center">0000-0088</th>
<th align="center">Master Boot Record</th>
<th align="center">主引导程序</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0089 - 01BD</td>
<td align="center">出错信息数据区</td>
<td align="center">数据区</td>
</tr>
<tr>
<td align="center">01BE - 01CD</td>
<td align="center">分区项1（16字节）</td>
<td align="center">分区表</td>
</tr>
<tr>
<td align="center">01CE - 01DD</td>
<td align="center">分区项2（16字节）</td>
<td align="center">分区表</td>
</tr>
<tr>
<td align="center">01DE - 01ED</td>
<td align="center">分区项3（16字节）</td>
<td align="center">分区表</td>
</tr>
<tr>
<td align="center">01EE - 01FD</td>
<td align="center">分区项4（16字节）</td>
<td align="center">分区表</td>
</tr>
<tr>
<td align="center">01FE</td>
<td align="center">55</td>
<td align="center">结束标志</td>
</tr>
<tr>
<td align="center">01FF</td>
<td align="center">AA</td>
<td align="center">结束标志</td>
</tr>
</tbody></table>
<ul>
<li>主引导程序（偏移地址 0000H-0088H），它负责从活动分区中装载，并运行系统引导程序</li>
<li>出错信息数据区，偏移地址0089H-00E1H为出错信息，00E2H-01BDH全为0字节</li>
<li>分区表（DPT，Disk Partition Table）含4个分区项，偏移地址01BEH-01FDH，每个分区表项长16个字节，划分成4个分区项，共64字节</li>
<li>结束标志，偏移地址01FE-01FF的2个字节值为结束标志55AA</li>
</ul>
<p>MBR中的DPT结构</p>
<table>
<thead>
<tr>
<th align="left">存贮字节位</th>
<th align="left">内容及含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">第1字节</td>
<td align="left">引导标志 。若值为80H表示活动分区，若值为00H表示非活动分区。</td>
</tr>
<tr>
<td align="left">第2、3、4字节</td>
<td align="left">本分区的起始磁头号、扇区号、柱面号。其中:<br />    磁头号 – 第2字节<br />    扇区号 – 第3字节的低6位<br />    柱面号 – 第3字节高2位+第4字节8位</td>
</tr>
<tr>
<td align="left">第5字节</td>
<td align="left">分区类型符 <br />    00H：表示该分区未使用<br />    06H：FAT16 基本分区<br />    0BH：FAT32 基本分区<br />    05H：扩展分区<br />    07H：NTFS分区<br />    0FH：（LBA模式）扩展分区（83H 为 Linux 分区等）</td>
</tr>
<tr>
<td align="left">第6、7、8字节</td>
<td align="left">本分区的结束磁头号、扇区号、柱面号。<br />    磁头号 – 第6字节<br />    扇区号 – 第7字节的低6位<br />    柱面号 – 第7字节的高2位+第8字节</td>
</tr>
<tr>
<td align="left">第9、10、11、12字节</td>
<td align="left">本分区之前已用了的扇区数</td>
</tr>
<tr>
<td align="left">第13、14、15、16字节</td>
<td align="left">本分区的总扇区数</td>
</tr>
</tbody></table>
<p>示例：备份MBR的分区表，破坏之后恢复</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份MBR分区表</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda of=/data/dpt.img bs=1 count=64 skip=446</span><br><span class="line">scp /data/dpt.img 192.168.119.166:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 破坏MBR分区表</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/data/sda bs=1 count=64 seek=446</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启计算机，本机无法启动</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用光盘启动，进入rescue mode，选择第三项 skip to shell</span></span><br><span class="line"></span><br><span class="line">scp 192.168.119.166:/root/dpt.img .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复分区表</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=dpt.img of=/dev/sda bs=1 count=64 seek=446</span><br><span class="line"></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-2-GPT-分区"><a href="#2-1-2-2-GPT-分区" class="headerlink" title="2.1.2.2 GPT 分区"></a>2.1.2.2 GPT 分区</h4><p>GPT：GUID partition table 支持128个分区</p>
<p>使用128位UUID表示磁盘分区和分区，GPT分区表自动备份在头和尾两份，并有CRC校验位</p>
<p>UEFI（统一可扩展固件接口）硬件支持GPT，使得操作系统可以启动</p>
<p><strong>GPT分区结构图</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/GPT.png"></p>
<p>GPT分区结构分为4个区域：</p>
<ul>
<li>GPT头</li>
<li>分区表</li>
<li>GPT分区</li>
<li>备份区域</li>
</ul>
<h3 id="2-1-3-BIOS-和-UEFI"><a href="#2-1-3-BIOS-和-UEFI" class="headerlink" title="2.1.3 BIOS 和 UEFI"></a>2.1.3 BIOS 和 UEFI</h3><p>BIOS（Basic Input Output System 基本输入输出系统）主要完成系统硬件自检和引导操作系统，操作系统开始启动之后，BIOS的任务就完成了。</p>
<p>UEFI(Unified Extensible Firmware Interface)统一的可扩展固件接口， 是一种详细描述类型接口的标准。UEFI 相当于一个轻量化的操作系统，提供了硬件和操作系统之间的一个接口，提供了图形化的操作界面。最关键的是引入了GPT分区表，支持2T以上的硬盘，硬盘分区不受限制。</p>
<p>BIOS 和 UEFI 的区别</p>
<ul>
<li>BIOS采用了16位汇编语言编写，只能运行在实模式（内存寻址方式由16位段寄存器的内容乘以16(10H)当做段基地址，加上16位偏移地址形成20位的物理地址）下，可访问的内存空间为1MB，只支持字符操作界面</li>
<li>UEFI采用32位或者64位的C语言编写，突破了实模式的限制，可以达到最大的寻址空间，支持图形操作界面，使用文件方式保存信息，支持GPT分区启动，适合和较新的系统和硬件的配合使用</li>
</ul>
<p><strong>BIOS + MBR 与 UEFI + GPT</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221117201115270.png" alt="image-20221117201115270"></p>
<p>Windows 只能安装BIOS + MBR 或 UEFI + GPT 的组合，而BIOS + GPT 和 UEFI + MBR 是不允许的，但是 BIOS + GPT + GRUB 启动Linux可以。</p>
<h3 id="2-1-4-管理分区"><a href="#2-1-4-管理分区" class="headerlink" title="2.1.4 管理分区"></a>2.1.4 管理分区</h3><p>列出块设备</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure>

<p>创建分区命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fdisk 管理MBR分区</span><br><span class="line">gdisk 管理GPT分区</span><br><span class="line">parted 高级分区操作，可以是交互或非交互式</span><br></pre></td></tr></table></figure>

<p>刷新内存中的分区信息，同步分区表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 适用于除Centos 6之外的其它版本</span></span><br><span class="line">partprobe</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-1-parted-命令"><a href="#2-1-4-1-parted-命令" class="headerlink" title="2.1.4.1 parted 命令"></a>2.1.4.1 parted 命令</h4><p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parted [option]... [设备 [命令 [参数]...]...]</span><br></pre></td></tr></table></figure>

<p>常用命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更改 /dev/sdb 的 Partition Table 的值为 gpt 或 msdos</span></span><br><span class="line">parted /dev/sdb mklable gpt|msdos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印指定设备的所有分区信息</span></span><br><span class="line">parted /dev/sdb <span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建主分区, 大小为200M, 单位默认为M</span></span><br><span class="line">parted /dev/sdb mkpart primary 1 200</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除指定设备分区 1 的信息</span></span><br><span class="line">parted /dev/sdb <span class="built_in">rm</span> 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有磁盘分区信息</span></span><br><span class="line">parted -l</span><br></pre></td></tr></table></figure>

<p>范例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># parted /dev/sdb print</span></span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 5369MB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: msdos</span><br><span class="line">Disk Flags: </span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    Type     File system  Flags</span><br><span class="line"> 1      1049kB  2149MB  2147MB  primary  ext4</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-2-fdisk-和-gdisk"><a href="#2-1-4-2-fdisk-和-gdisk" class="headerlink" title="2.1.4.2 fdisk 和 gdisk"></a>2.1.4.2 fdisk 和 gdisk</h4><p>常见用法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l [device ...]    查看分区</span><br><span class="line">fdisk [device ...]       管理MBR分区</span><br><span class="line">gdisk [device ...]       GPT分区工具，类fdisk使用</span><br></pre></td></tr></table></figure>

<p>管理分区时使用的子命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p  分区列表</span><br><span class="line">t  更改分区类型 </span><br><span class="line">n  创建新分区</span><br><span class="line">d  删除分区</span><br><span class="line">v  校验分区</span><br><span class="line">u  转换单位</span><br><span class="line">w  保存并退出</span><br><span class="line">q  不保存退出</span><br></pre></td></tr></table></figure>

<p>查看内核是否已经识别新的分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/partitions</span><br></pre></td></tr></table></figure>

<p>CentOS 7,8 同步分区表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">partprobe</span><br></pre></td></tr></table></figure>

<h2 id="2-2-文件系统"><a href="#2-2-文件系统" class="headerlink" title="2.2 文件系统"></a>2.2 文件系统</h2><h3 id="2-2-1-什么是文件系统"><a href="#2-2-1-什么是文件系统" class="headerlink" title="2.2.1 什么是文件系统"></a>2.2.1 什么是文件系统</h3><p>计算机的<strong>文件系统</strong>是一种存储和组织计算机数据的方法，它使得对其访问和查找变得容易，文件系统使用<strong>文件</strong>和<strong>树形目录</strong>的抽象逻辑概念代替了硬盘和光盘等物理设备使用数据块的概念，用户使用文件系统来保存数据不必关心数据实际保存在硬盘（或者光盘）的地址为多少的数据块上，只需要记住这个文件的所属目录和文件名。在写入新数据之前，用户不必关心硬盘上的那个块地址没有被使用，硬盘上的存储空间管理（分配和释放）功能由文件系统自动完成，用户只需要记住数据被写入到了哪个文件中。</p>
<p>支持的文件系统类型</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># ls /lib/modules/`uname -r`/kernel/fs</span></span><br><span class="line">binfmt_misc.ko.xz  ceph  cramfs  ext4  fscache  gfs2   jbd2   mbcache.ko.xz  nfs_common  nls        pstore    udf</span><br><span class="line">cachefiles         cifs  dlm     fat   fuse     isofs  lockd  nfs            nfsd        overlayfs  squashfs  xfs</span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-文件系统类型"><a href="#2-2-2-文件系统类型" class="headerlink" title="2.2.2 文件系统类型"></a>2.2.2 文件系统类型</h3><p>Linux 中常用文件系统</p>
<ul>
<li>ext4：ext 文件系统最新版</li>
<li>xfs：SGI，支持最大8EB的文件系统</li>
<li>swap</li>
<li>iso9660 光盘</li>
<li>btrfs（Oracle）</li>
<li>reiserfs</li>
</ul>
<p>Windows 中常用文件系统</p>
<ul>
<li>FAT32</li>
<li>NTFS</li>
<li>exFAT</li>
</ul>
<h3 id="2-2-3-文件系统的组成部分"><a href="#2-2-3-文件系统的组成部分" class="headerlink" title="2.2.3 文件系统的组成部分"></a>2.2.3 文件系统的组成部分</h3><p>内核中的模块：ext4, xfs, vfat</p>
<p>Linux的虚拟文件系统：VFS</p>
<p>用户空间的管理工具：mkfs.ext4, mkfs.xfs, mkfs.vfat</p>
<p>注：用户执行的命令不直接和各文件系统进行连接，而是通过虚拟文件系统，虚拟文件系统对外提供统一的访问接口，再通过虚拟文件系统和多个不同类型的文件系统连接，这样只要使用一个命令就可以访问不同的文件系统。</p>
<img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221120202829203.png" alt="image-20221120202829203" style="zoom:80%;" />

<h3 id="2-2-4-文件系统选择管理"><a href="#2-2-4-文件系统选择管理" class="headerlink" title="2.2.4 文件系统选择管理"></a>2.2.4 文件系统选择管理</h3><h4 id="2-2-4-1-创建文件系统"><a href="#2-2-4-1-创建文件系统" class="headerlink" title="2.2.4.1 创建文件系统"></a>2.2.4.1 创建文件系统</h4><p>创建文件管理工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkfs</span><br><span class="line">  mkfs.FS_TYPE /dev/DEVICE</span><br><span class="line">  	FS_TYPE: ext4 xfs btrfs vfat</span><br><span class="line">  mkfs -t FS_TYPE /dev/DEVICE</span><br><span class="line">       -L <span class="string">&#x27;LABEL&#x27;</span> 设定卷标</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mke2fs: ext 系列文件系统专用管理工具</span><br><span class="line"> -t &#123;ext2|ext3|ext4|xfs&#125;    指定文件系统类型</span><br><span class="line"> -b &#123;1024|2048|4096&#125;        指定块大小</span><br><span class="line"> -L <span class="string">&#x27;LABEL&#x27;</span>                 设置卷标</span><br><span class="line"> -j                         创建ext3系列文件系统</span><br><span class="line"> -i <span class="comment">#                       每多少个字节创建一个inode，不应该小于block大小</span></span><br><span class="line"> -N <span class="comment">#                       指定分区中创建多少个inode</span></span><br><span class="line"> -I                         一个inode记录占用的磁盘空间大小，128-4096</span><br><span class="line"> -m <span class="comment">#                       为管理人员预留空间占总空间的百分比，默认5%</span></span><br><span class="line"> -O FEATURE                 启用指定特性</span><br><span class="line"> -O ^FEATURE                关闭指定特性</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-2-查看和管理分区信息"><a href="#2-2-4-2-查看和管理分区信息" class="headerlink" title="2.2.4.2 查看和管理分区信息"></a>2.2.4.2 查看和管理分区信息</h4><p><strong>blkid 查看块设备属性信息</strong></p>
<p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">blkid [option] [DEVICE]</span><br><span class="line"></span><br><span class="line">  option:</span><br><span class="line">    -U UUID: 根据指定的UUID来查找对应的设备</span><br><span class="line">    -L LABEL: 根据指定的LABEL来查找对应的设备</span><br></pre></td></tr></table></figure>

<p><strong>e2label：管理ext系列文件系统的LABEL</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e2label DEVICE [LABEL]</span><br></pre></td></tr></table></figure>

<p><strong>findfs：查找分区</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">findfs [options] LABEL=&lt;label&gt;</span><br><span class="line">findfs [options] UUID=&lt;uuid&gt;</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># findfs UUID=&quot;4ec1a2f6-693f-4d0a-a605-7335893cb82b&quot;</span></span><br><span class="line">/dev/sda1</span><br></pre></td></tr></table></figure>

<p><strong>tune2fs：重新设定ext系列文件系统可调整参数的值</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-l  查看指定文件系统超级块信息</span><br><span class="line">-L <span class="string">&#x27;LABEL&#x27;</span>  修改卷标</span><br><span class="line">-m <span class="comment">#  修改预留给管理员的空间百分比</span></span><br><span class="line">-j  将ext2升级为ext3</span><br><span class="line">-O  文件系统属性启用或禁用</span><br><span class="line">-o  调整文件系统的默认挂载选项</span><br><span class="line">-U UUID  修改UUID号</span><br></pre></td></tr></table></figure>

<p><strong>dumpe2fs：显示ext文件系统信息，将磁盘块分组管理</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">-h  查看超级块信息，不显示分组信息</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># dumpe2fs -h /dev/sdb1</span></span><br><span class="line">dumpe2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem volume name:   &lt;none&gt;</span><br><span class="line">Last mounted on:          /mnt/sdb1</span><br><span class="line">Filesystem UUID:          9e5c5fe3-be05-4c0b-95cd-9edda1c6c8cb</span><br><span class="line">Filesystem magic number:  0xEF53</span><br><span class="line">Filesystem revision <span class="comment">#:    1 (dynamic)</span></span><br><span class="line">Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize</span><br><span class="line">Filesystem flags:         signed_directory_hash </span><br><span class="line">Default mount options:    user_xattr acl</span><br><span class="line">Filesystem state:         clean</span><br><span class="line">Errors behavior:          Continue</span><br><span class="line">Filesystem OS <span class="built_in">type</span>:       Linux</span><br><span class="line">Inode count:              131072</span><br><span class="line">Block count:              524288</span><br><span class="line">Reserved block count:     26214</span><br><span class="line">Free blocks:              88531</span><br><span class="line">Free inodes:              131060</span><br><span class="line">First block:              0</span><br><span class="line">Block size:               4096</span><br><span class="line">Fragment size:            4096</span><br><span class="line">Group descriptor size:    64</span><br><span class="line">Reserved GDT blocks:      255</span><br><span class="line">Blocks per group:         32768</span><br><span class="line">Fragments per group:      32768</span><br><span class="line">Inodes per group:         8192</span><br><span class="line">Inode blocks per group:   512</span><br><span class="line">Flex block group size:    16</span><br><span class="line">Filesystem created:       Mon Sep 12 20:13:42 2022</span><br><span class="line">Last mount time:          Thu Nov 17 20:43:15 2022</span><br><span class="line">Last write time:          Thu Nov 17 20:43:15 2022</span><br><span class="line">Mount count:              47</span><br><span class="line">Maximum mount count:      -1</span><br><span class="line">Last checked:             Mon Sep 12 20:13:42 2022</span><br><span class="line">Check interval:           0 (&lt;none&gt;)</span><br><span class="line">Lifetime writes:          2700 MB</span><br><span class="line">Reserved blocks uid:      0 (user root)</span><br><span class="line">Reserved blocks gid:      0 (group root)</span><br><span class="line">First inode:              11</span><br><span class="line">Inode size:	          256</span><br><span class="line">Required extra isize:     28</span><br><span class="line">Desired extra isize:      28</span><br><span class="line">Journal inode:            8</span><br><span class="line">Default directory <span class="built_in">hash</span>:   half_md4</span><br><span class="line">Directory Hash Seed:      af9e86d0-9c2c-4caf-a4fd-da1266fc172a</span><br><span class="line">Journal backup:           inode blocks</span><br><span class="line">Journal features:         journal_incompat_revoke journal_64bit</span><br><span class="line">Journal size:             64M</span><br><span class="line">Journal length:           16384</span><br><span class="line">Journal sequence:         0x0000000c</span><br><span class="line">Journal start:            0</span><br></pre></td></tr></table></figure>

<p><strong>xfs_info：显示未挂载或已挂载的xfs文件系统信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xfs_info mountpoint|devname</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># xfs_info /dev/sda1</span></span><br><span class="line">meta-data=/dev/sda1              isize=512    agcount=4, agsize=65536 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=1, sparse=1, rmapbt=0</span><br><span class="line">         =                       reflink=1</span><br><span class="line">data     =                       bsize=4096   blocks=262144, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0, ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>

<p><strong>超级块和 INODE TABEL</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221124213614993.png" alt="image-20221124213614993"></p>
<p><strong>块组描述符表（GDT）</strong></p>
<p>ext文件系统每一个块组信息使用32字节描述，这32个字节称为块组描述符，所有块组的块组描述符组成块组描述符表GDT(group descriptor table)。虽然每个块组都需要块组描述符来记录块组的信息和属性元数据，但是不是每个块组中都存放了块组描述符。将所有块组的块组信息组成一个GDT保存,并将该GDT存放于某些块组中，类似存放superblock和备份superblock的块。</p>
<h4 id="2-2-4-3-文件系统检测和修复"><a href="#2-2-4-3-文件系统检测和修复" class="headerlink" title="2.2.4.3 文件系统检测和修复"></a>2.2.4.3 文件系统检测和修复</h4><p>文件系统故障常发生于死机或者非正常关机之后，挂载文件系统标记为“no clean”</p>
<p>​    注：进行磁盘修复时一定要取消文件系统的挂载</p>
<p>fsck：File System Check</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fsck.FS_TYPE</span><br><span class="line">fsck -t FS_TYPE</span><br><span class="line">  注：FS_TYPE 一定要与分区上的文件系统相同</span><br><span class="line">  </span><br><span class="line">常用选项:</span><br><span class="line">  -a 自动修复</span><br><span class="line">  -r 交互式修复错误</span><br></pre></td></tr></table></figure>

<p>e2fsck：ext 系列文件专用的检测修复工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-y 自动回答 <span class="built_in">yes</span></span><br><span class="line">-f 强制修复</span><br><span class="line">-p 安全的进行文件系统的修复</span><br></pre></td></tr></table></figure>

<p>xfs_repair：xfs文件系统专用检测修复工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-f 修复文件</span><br><span class="line">-n 只检查</span><br><span class="line">-d 紧急修复。允许修复只读的挂载设备，在单用户下修复 / 时使用，然后立即reboot</span><br></pre></td></tr></table></figure>

<p>示例：修改破坏的ext文件系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># !df</span></span><br><span class="line"><span class="built_in">df</span> -Th /dev/sdc</span><br><span class="line">Filesystem     Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdc       ext4  9.8G   37M  9.3G   1% /mnt/sdc</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># ls /mnt/sdc/</span></span><br><span class="line">fstab  lost+found  passwd</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># dd if=/dev/zero of=/dev/sdc bs=1M count=1</span></span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">1048576 bytes (1.0 MB, 1.0 MiB) copied, 0.00332407 s, 315 MB/s</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># ls /mnt/sdc/  </span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># tune2fs -l /dev/sdc</span></span><br><span class="line">tune2fs 1.45.6 (20-Mar-2020)</span><br><span class="line">tune2fs: Bad magic number <span class="keyword">in</span> super-block <span class="keyword">while</span> trying to open /dev/sdc</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># df -Th /dev/sdc</span></span><br><span class="line">Filesystem     Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdc       ext4   64Z   64Z  9.8G 100% /mnt/sdc</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># umount /mnt/sdc </span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># e2fsck -y -f /dev/sdc</span></span><br><span class="line">e2fsck 1.45.6 (20-Mar-2020)</span><br><span class="line">ext2fs_open2: Bad magic number <span class="keyword">in</span> super-block</span><br><span class="line">e2fsck: Superblock invalid, trying backup blocks...</span><br><span class="line">Resize inode not valid.  Recreate? <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure</span><br><span class="line">Pass 3: Checking directory connectivity</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">Pass 5: Checking group summary information</span><br><span class="line">Block bitmap differences:  +(98304--99330) +(163840--164866) +(229376--230402) +(294912--295938) +(819200--820226) +(884736--885762) +(1605632--1606658)</span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Free blocks count wrong <span class="keyword">for</span> group <span class="comment">#0 (23510, counted=23511).</span></span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Free blocks count wrong <span class="keyword">for</span> group <span class="comment">#1 (31741, counted=31739).</span></span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Free blocks count wrong (2554686, counted=2554685).</span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Free inodes count wrong <span class="keyword">for</span> group <span class="comment">#0 (8181, counted=8179).</span></span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Free inodes count wrong (655349, counted=655347).</span><br><span class="line">Fix? <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Padding at end of inode bitmap is not <span class="built_in">set</span>. Fix? <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/dev/sdc: ***** FILE SYSTEM WAS MODIFIED *****</span><br><span class="line">/dev/sdc: 13/655360 files (0.0% non-contiguous), 66755/2621440 blocks</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># tune2fs -l  /dev/sdc</span></span><br><span class="line">tune2fs 1.45.6 (20-Mar-2020)</span><br><span class="line">Filesystem volume name:   &lt;none&gt;</span><br><span class="line">Last mounted on:          &lt;not available&gt;</span><br><span class="line">Filesystem UUID:          0a133b5e-e5f7-466e-8693-2250f0398266</span><br><span class="line">Filesystem magic number:  0xEF53</span><br><span class="line">Filesystem revision <span class="comment">#:    1 (dynamic)</span></span><br><span class="line">Filesystem features:      has_journal ext_attr resize_inode dir_index filetype extent 64bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize metadata_csum</span><br><span class="line">Filesystem flags:         signed_directory_hash </span><br><span class="line">Default mount options:    user_xattr acl</span><br><span class="line">Filesystem state:         clean</span><br><span class="line">Errors behavior:          Continue</span><br><span class="line">Filesystem OS <span class="built_in">type</span>:       Linux</span><br><span class="line">Inode count:              655360</span><br><span class="line">Block count:              2621440</span><br><span class="line">Reserved block count:     131072</span><br><span class="line">Free blocks:              2554685</span><br><span class="line">Free inodes:              655347</span><br><span class="line">First block:              0</span><br><span class="line">Block size:               4096</span><br><span class="line">Fragment size:            4096</span><br><span class="line">Group descriptor size:    64</span><br><span class="line">Reserved GDT blocks:      1024</span><br><span class="line">Blocks per group:         32768</span><br><span class="line">Fragments per group:      32768</span><br><span class="line">Inodes per group:         8192</span><br><span class="line">Inode blocks per group:   512</span><br><span class="line">Flex block group size:    16</span><br><span class="line">Filesystem created:       Fri Nov 25 21:52:06 2022</span><br><span class="line">Last mount time:          n/a</span><br><span class="line">Last write time:          Fri Nov 25 21:56:53 2022</span><br><span class="line">Mount count:              0</span><br><span class="line">Maximum mount count:      -1</span><br><span class="line">Last checked:             Fri Nov 25 21:56:53 2022</span><br><span class="line">Check interval:           0 (&lt;none&gt;)</span><br><span class="line">Lifetime writes:          8 MB</span><br><span class="line">Reserved blocks uid:      0 (user root)</span><br><span class="line">Reserved blocks gid:      0 (group root)</span><br><span class="line">First inode:              11</span><br><span class="line">Inode size:	          256</span><br><span class="line">Required extra isize:     32</span><br><span class="line">Desired extra isize:      32</span><br><span class="line">Journal inode:            8</span><br><span class="line">Default directory <span class="built_in">hash</span>:   half_md4</span><br><span class="line">Directory Hash Seed:      7e999f31-eee7-479f-ad7f-f3d1f3f1b409</span><br><span class="line">Journal backup:           inode blocks</span><br><span class="line">Checksum <span class="built_in">type</span>:            crc32c</span><br><span class="line">Checksum:                 0xd4f66ca7</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mount /dev/sdc /mnt/sdc/</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># ls /mnt/sdc/</span></span><br><span class="line">fstab  lost+found  passwd</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat /mnt/fstab </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Sun Mar 13 06:11:42 2022</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk/&#x27;.</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># After editing this file, run &#x27;systemctl daemon-reload&#x27; to update systemd</span></span><br><span class="line"><span class="comment"># units generated from this file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">/dev/mapper/rl-root     /                       xfs     defaults        0 0</span><br><span class="line">UUID=4ec1a2f6-693f-4d0a-a605-7335893cb82b /boot                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/rl-data     /data                   ext4    defaults        1 2</span><br><span class="line">/dev/mapper/rl-swap     none                    swap    defaults        0 0</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># df -Th /dev/sdc</span></span><br><span class="line">Filesystem     Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdc       ext4  9.8G   37M  9.3G   1% /mnt/sdc</span><br></pre></td></tr></table></figure>

<h2 id="2-3-挂载"><a href="#2-3-挂载" class="headerlink" title="2.3 挂载"></a>2.3 挂载</h2><p>挂载：将额外文件系统与根文件系统某现存目录建立连接关系，使该目录作为访问该文件系统的入口</p>
<p>卸载：取消该关联关系的过程</p>
<p>挂载点原有文件在挂载完成后会被临时隐藏，因此，挂载点目录一般为空；挂载的设备正在使用中时无法被卸载</p>
<h3 id="2-3-1-挂载文件系统-mount"><a href="#2-3-1-挂载文件系统-mount" class="headerlink" title="2.3.1 挂载文件系统 mount"></a>2.3.1 挂载文件系统 mount</h3><p>格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mount [-fnrsvw] [-t vfstype] [-o options] device mountpoint</span><br><span class="line"></span><br><span class="line">device: 指明要挂载的设备</span><br><span class="line">  · 设备文件：如 /dev/sda1</span><br><span class="line">  · 卷标：-L <span class="string">&#x27;LABEL&#x27;</span></span><br><span class="line">  · UUID：-U <span class="string">&#x27;UUID&#x27;</span></span><br><span class="line">  · 伪文件系统名称：proc, sysfs, devtmpfs, configfs</span><br><span class="line">  </span><br><span class="line">mountpoint: 挂载点目录必须事先存在, 建议使用空目录</span><br></pre></td></tr></table></figure>

<p>mount 常用命令选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-t fstype             指定要挂载的设备上的文件系统类型，如ext4、xfs</span><br><span class="line">-r                    <span class="built_in">readonly</span>，只读挂载</span><br><span class="line">-w                    <span class="built_in">read</span> and write，读写挂载，默认选项</span><br><span class="line">-n                    不更新/etc/mtab，mount 不可见</span><br><span class="line">-a                    自动挂载设备（定义在/etc/fstab文件中，且挂载选项中有auto功能）</span><br><span class="line">-L <span class="string">&#x27;LABEL&#x27;</span>            以卷标指定挂载设备</span><br><span class="line">-U <span class="string">&#x27;UUID&#x27;</span>             以UUID指定要挂载的设备</span><br><span class="line">-B, --<span class="built_in">bind</span>            绑定目录到另一个目录上</span><br><span class="line">-o options: (挂载文件系统的选项，多个选项之间使用逗号分隔)</span><br><span class="line">    async                   异步模式，内存更改，先写入缓冲区，之后写入磁盘，效率高，但不安全</span><br><span class="line">    <span class="built_in">sync</span>                    同步模式，内存更改直接写入磁盘，安全但效率低</span><br><span class="line">    atime/noatime           包含目录和文件</span><br><span class="line">    diratime/nodiratime     目录的访问时间戳</span><br><span class="line">    auto/noauto             是否支持开机自动选项，即是否支持-a选项</span><br><span class="line">    <span class="built_in">exec</span>/noexec             是否支持在文件系统上运行应用程序</span><br><span class="line">    suid/nosuid             是否支持suid和sgid权限</span><br><span class="line">    remount                 重新挂载</span><br><span class="line">    ro/rw                   只读、读写</span><br><span class="line">    user/nouser             是否允许普通用户挂载此设备，在/etc/fstab中使用</span><br><span class="line">    acl/noacl               启用此文件系统上的acl功能</span><br><span class="line">    loop                    使用loop设备</span><br><span class="line">    _netdev                 当网络可用时对网络资源进行挂载，如 NFS 文件系统</span><br><span class="line">    defaults                相当于rw, suid, dev, <span class="built_in">exec</span>, auto, nouser, async</span><br></pre></td></tr></table></figure>

<p>挂载规则：</p>
<ul>
<li>一个挂载点同一时间只能挂载一个设备</li>
<li>一个挂载点同一时间挂载了多个设备，只能看到最后一个设备的数据，其它设备上的数据将被隐藏</li>
<li>一个设备可以同时挂载到多个挂载点</li>
<li>通常挂载点一般是已经存在的空目录</li>
</ul>
<h3 id="2-3-2-卸载文件系统-umount"><a href="#2-3-2-卸载文件系统-umount" class="headerlink" title="2.3.2 卸载文件系统 umount"></a>2.3.2 卸载文件系统 umount</h3><p>卸载：可使用设备，也可以使用挂载点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount 设备名|挂载点</span><br></pre></td></tr></table></figure>

<h3 id="2-3-3-查看挂载情况"><a href="#2-3-3-查看挂载情况" class="headerlink" title="2.3.3 查看挂载情况"></a>2.3.3 查看挂载情况</h3><p>查看挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(1) 通过查看/etc/mtab文件显示当前已挂载的所有设备</span><br><span class="line">(2) mount</span><br><span class="line">(3) 查看内核追踪到的已挂载的所有设备 <span class="built_in">cat</span> /proc/mounts</span><br></pre></td></tr></table></figure>

<p>查看挂载点情况</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findmnt MOUNT_POINT | DEVICE</span><br></pre></td></tr></table></figure>

<p>查看正在访问指定文件系统的进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsof MOUNT_POINT</span><br><span class="line">fuser -v MOUNT_POINT</span><br></pre></td></tr></table></figure>

<p>终止所有正在访问指定的文件系统的进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuser -km MOUNT_POINT</span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-持久挂载"><a href="#2-3-4-持久挂载" class="headerlink" title="2.3.4 持久挂载"></a>2.3.4 持久挂载</h3><p>将挂载信息写入到 &#x2F;etc&#x2F;fstab 文件中，下次开机时实现自动挂载；写入后，可使用<code>mount -a</code>及时生效</p>
<p>&#x2F;etc&#x2F;fstab 格式帮助<code>man 5 fstab</code></p>
<p>该文件中，每行定义一个要挂载的文件系统，包括如下选项</p>
<ul>
<li>要挂载的设备或伪文件系统<ul>
<li>设备文件</li>
<li>LABEL：LABEL&#x3D;“”</li>
<li>UUID：UUID&#x3D;“”</li>
<li>伪文件系统名称：proc，sysfs</li>
</ul>
</li>
<li>挂载点：必须是事先存在的目录</li>
<li>文件系统类型：ext4，xfs，iso9600，nfs，none</li>
<li>挂载选项：defaults，acl，bind</li>
<li>转储频率：0 不做备份，1 每天转储，2 每隔一天转储</li>
<li>fsck 检查文件系统的顺序：0 不自检，1 首先自检 一般rootfs使用，2 非rootfs使用</li>
</ul>
<p>示例：Centos7，8 中 &#x2F;etc&#x2F;fstab 的分区UUID错误导致系统无法启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">系统进入到 Emergency mode，输入 root 密码</span><br><span class="line"><span class="built_in">cat</span> /proc/mounts    可以看见 / 以读写形式挂载</span><br><span class="line">vim /etc/fstab      修改错误的挂载信息</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>

<p>示例：Centos6 中 &#x2F;etc&#x2F;fstab 的分区挂载信息错误导致无法正常启动操作系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 若挂载设备的文件系统出现错误，且实行开机自检，修改 /etc/fstab 文件时，需要修改为0（开机不自检）</span></span><br><span class="line">系统自动进入到 Emergency mode，输入 root 密码</span><br><span class="line"><span class="built_in">cat</span> /proc/mounts    可以看见 / 以只读形式挂载，无法直接修改配置文件</span><br><span class="line">mount -o remount,rw /</span><br><span class="line">vim /etc/fstab</span><br></pre></td></tr></table></figure>

<h2 id="2-4-处理交换文件和分区"><a href="#2-4-处理交换文件和分区" class="headerlink" title="2.4 处理交换文件和分区"></a>2.4 处理交换文件和分区</h2><h3 id="2-4-1-swap"><a href="#2-4-1-swap" class="headerlink" title="2.4.1 swap"></a>2.4.1 swap</h3><p>swap 交换分区是系统RAM的补充，swap 分区支持虚拟内存。当没有足够的 RAM 保存系统处理的数据时会将数据写入swap分区，当系统缺乏 swap 空间时，内核会因 RAM 内存耗尽而终止进程。过多的 swap 空间会造成存储设备处于分配状态但闲置，造成浪费，过多 swap 空间还会掩盖内存泄露。</p>
<p>推荐 swap 空间的分配</p>
<table>
<thead>
<tr>
<th>系统中的 RAM 大小</th>
<th>推荐的 swap 空间</th>
<th>允许休眠的 swap 空间大小建议</th>
</tr>
</thead>
<tbody><tr>
<td>低于2GB</td>
<td>RAM 大小的2倍</td>
<td>RAM 大小的3倍</td>
</tr>
<tr>
<td>2GB - 8GB</td>
<td>等于 RAM 的大小</td>
<td>等于 RAM 的大小</td>
</tr>
<tr>
<td>8GB - 64GB</td>
<td>4GB 至 RAM 空间大小的0.5倍</td>
<td>RAM 空间大小的 1.5 倍</td>
</tr>
<tr>
<td>超过 64GB</td>
<td>独立负载（至少4GB）</td>
<td>不建议使用休眠功能</td>
</tr>
</tbody></table>
<h3 id="2-4-2-交换分区的实现过程"><a href="#2-4-2-交换分区的实现过程" class="headerlink" title="2.4.2 交换分区的实现过程"></a>2.4.2 交换分区的实现过程</h3><p>1、创建交换分区或文件</p>
<p>2、使用mkswap写入特殊签名</p>
<p>3、在 &#x2F;etc&#x2F;fstab 文件中添加挂载项</p>
<p>4、使用<code>swapon -a</code>激活交换空间</p>
<p>启用swap分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">swapon [options] [DEVICES]</span><br><span class="line"></span><br><span class="line">[options]</span><br><span class="line">  -a  激活所有交换分区</span><br><span class="line">  -p priority  指定优先级，或在/etc/fstab文件中的第4列指定 pri=value</span><br></pre></td></tr></table></figure>

<p>示例：创建交换分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># echo -e &quot;n\np\n\n+1G\nt\82\nw\n&quot; | fdisk /dev/sdb</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># partprobe</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># mkswap /dev/sdb2</span></span><br><span class="line">Setting up swapspace version 1, size = 1048572 KiB</span><br><span class="line">no label, UUID=84124053-781e-4f29-821a-3bbed29a13fa</span><br><span class="line">[root@centos7 ~]<span class="comment"># vim /etc/fstab</span></span><br><span class="line">UUID=84124053-781e-4f29-821a-3bbed29a13fa swap swap     defaults        0 0</span><br><span class="line">[root@centos7 ~]<span class="comment"># free -h</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.8G        187M        1.4G        9.6M        186M        1.4G</span><br><span class="line">Swap:          3.0G          0B        3.0G</span><br><span class="line"><span class="comment"># 优先级越大越优先</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cat /proc/swaps </span></span><br><span class="line">Filename				Type		Size	Used	Priority</span><br><span class="line">/dev/dm-1                               partition	2097148	0	-2</span><br><span class="line">/dev/sdb2                               partition	1048572	0	-3</span><br></pre></td></tr></table></figure>

<p>禁用swap分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">swapoff [option] [device]</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">sed -i.bak <span class="string">&#x27;/swap/d&#x27;</span> /etc/fstab</span><br><span class="line">swapoff -a</span><br></pre></td></tr></table></figure>

<p><strong>swap 优先级</strong></p>
<p>可以指定swap分区的优先级从0到32767，值越大优先级越高</p>
<p>如果没有指定，会自动指定一个优先级，从-1开始。每加入一个没有指定优先级的swap，优先级减一</p>
<p>先添加的swap的缺省优先级高 ，用户可以指定优先级且必须是正数，那么永远高于默认指定的优先级</p>
<p>示例：以文件形式实现swap功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># dd if=/dev/zero of=/root/swapfile bs=1M count=1024</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mkswap swapfile</span></span><br><span class="line"><span class="comment"># 此处挂载直接使用文件名称，不要使用UUID</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># vim /etc/fstab</span></span><br><span class="line">/root/swapfile          swap                    swap    defaults        0 0</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># chmod 600 /root/swapfile </span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># swapon -a</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># swapon -s</span></span><br><span class="line">Filename				Type		Size	Used	Priority</span><br><span class="line">/dev/dm-1                              	partition	2097148	0	-2</span><br><span class="line">/root/swapfile                         	file    	1048572	0	-3</span><br></pre></td></tr></table></figure>

<h3 id="2-4-3-swap-的使用策略"><a href="#2-4-3-swap-的使用策略" class="headerlink" title="2.4.3 swap 的使用策略"></a>2.4.3 swap 的使用策略</h3><p><code>/proc/sys/vm/swappiness</code>的值决定了当内存占用达到一定的百分比时，会启用swap分区的空间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat /proc/sys/vm/swappiness </span></span><br><span class="line">30</span><br><span class="line">root@ubuntu18-server:~<span class="comment"># cat /proc/sys/vm/swappiness</span></span><br><span class="line">60</span><br></pre></td></tr></table></figure>

<p>注：内存使用到100-30&#x3D;70%的时候，就开始出现有交换分区的使用。简单的说这个参数定义了系统对swap的使用倾向，值越大越倾向于使用swap。可以设置为0，但并不会禁止对swap的使用，只是最大限度的降低使用swap。</p>
<h2 id="2-5-磁盘常见工具"><a href="#2-5-磁盘常见工具" class="headerlink" title="2.5 磁盘常见工具"></a>2.5 磁盘常见工具</h2><h3 id="2-5-1-文件系统实际占用空间查看工具-df"><a href="#2-5-1-文件系统实际占用空间查看工具-df" class="headerlink" title="2.5.1 文件系统实际占用空间查看工具 df"></a>2.5.1 文件系统实际占用空间查看工具 df</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> [option] [device]</span><br><span class="line"></span><br><span class="line">常用选项：</span><br><span class="line"> -H  以10为单位</span><br><span class="line"> -T  文件系统类型</span><br><span class="line"> -h  易于阅读</span><br><span class="line"> -i  使用inode的使用情况代替block的使用情况</span><br><span class="line"> -P  以POSIX兼容的格式输出</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># df -Th</span></span><br><span class="line">Filesystem          Type      Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs            devtmpfs  877M     0  877M   0% /dev</span><br><span class="line">tmpfs               tmpfs     896M     0  896M   0% /dev/shm</span><br><span class="line">tmpfs               tmpfs     896M  8.8M  887M   1% /run</span><br><span class="line">tmpfs               tmpfs     896M     0  896M   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/rl-root xfs        30G  3.1G   27G  11% /</span><br><span class="line">/dev/sda1           xfs      1014M  212M  803M  21% /boot</span><br><span class="line">/dev/mapper/rl-data ext4       17G   54M   16G   1% /data</span><br><span class="line">tmpfs               tmpfs     180M     0  180M   0% /run/user/0</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># lsblk -f</span></span><br><span class="line">NAME        FSTYPE      LABEL                UUID                                   MOUNTPOINT</span><br><span class="line">sda                                                                                 </span><br><span class="line">├─sda1      xfs                              4ec1a2f6-693f-4d0a-a605-7335893cb82b   /boot</span><br><span class="line">└─sda2      LVM2_member                      odzCiV-0bL1-GIR3-7651-S41G-ZvHI-8Mm2Y3 </span><br><span class="line">  ├─rl-root xfs                              62ae4f5a-be31-4cf7-ab63-b33f57740bbd   /</span><br><span class="line">  ├─rl-swap swap                             e342fd6e-55ce-4947-802a-38e589a95440   [SWAP]</span><br><span class="line">  └─rl-data ext4                             fefe9937-ef64-40af-a057-0a126274aba5   /data</span><br><span class="line">sdb                                                                                 </span><br><span class="line">sdc                                                                                 </span><br><span class="line">sr0         iso9660     Rocky-8-5-x86_64-dvd 2021-11-14-09-31-13-00</span><br></pre></td></tr></table></figure>

<h3 id="2-5-2-查看目录空间的使用情况-du"><a href="#2-5-2-查看目录空间的使用情况-du" class="headerlink" title="2.5.2 查看目录空间的使用情况 du"></a>2.5.2 查看目录空间的使用情况 du</h3><p>显示指定目录下各个子目录的大小，单位为KB</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">du</span> [option] DIR</span><br><span class="line"></span><br><span class="line">常用选项</span><br><span class="line"> -h    易于阅读</span><br><span class="line"> -s    summary</span><br><span class="line"> --max-depth=<span class="comment">#    指定最大的目录层</span></span><br><span class="line"> -x, --one-file-system    忽略不在同一个文件系统的目录</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># du -h -x --max-depth=1 /</span></span><br><span class="line">24M	/etc</span><br><span class="line">1.1G	/root</span><br><span class="line">233M	/var</span><br><span class="line">1.5G	/usr</span><br><span class="line">36K	/home</span><br><span class="line">0	/media</span><br><span class="line">0	/mnt</span><br><span class="line">33M	/opt</span><br><span class="line">0	/srv</span><br><span class="line">4.0K	/tmp</span><br><span class="line">24M	/backup</span><br><span class="line">2.8G	/</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># du -s -h -x  /</span></span><br><span class="line">2.8G	/</span><br></pre></td></tr></table></figure>

<p>面试题：df 和 du 的区别</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> 查看文件系统的大小</span><br><span class="line"><span class="built_in">du</span> 查看的是目录中所有文件的大小</span><br><span class="line"></span><br><span class="line"><span class="comment"># 刚创建的文件系统 df &gt; du </span></span><br><span class="line">刚创建一个文件系统时，没有产生任何数据，使用<span class="built_in">df</span>查看会因为文件系统中的元数据而造成<span class="built_in">df</span>查看的大小比<span class="built_in">du</span>查看的空间要大</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目录中挂载其它分区 df &lt; du</span></span><br><span class="line">当一个目录中存在被其它分区挂载的挂载点，使用<span class="built_in">df</span>只会统计该目录的文件系统大小，挂载的设备分区不会统计；而使用<span class="built_in">du</span>命令查看时，它只关系该目录中的文件占用了多少空间，会将挂载点的其它分区使用大小也会计算进去</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除文件但不释放空间时 df &gt; du</span></span><br><span class="line">当某一个文件正在使用，如果此时将它删除，那么该文件不会立刻释放。使用<span class="built_in">df</span>查看会认为该文件没有释放，但使用<span class="built_in">du</span>查看会认为该文件被删除了，所以不存在。此时<span class="built_in">df</span>查看的空间比<span class="built_in">du</span>查看的空间要大</span><br></pre></td></tr></table></figure>

<h3 id="2-5-3-dd-工具"><a href="#2-5-3-dd-工具" class="headerlink" title="2.5.3 dd 工具"></a>2.5.3 dd 工具</h3><p>dd：Copy a file, converting and formatting according to the operands.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">格式</span><br><span class="line">  <span class="built_in">dd</span> <span class="keyword">if</span>=/PATH/SRC_FILE of=/PATH/DEST_FILE bs=<span class="comment"># count=#</span></span><br><span class="line">  </span><br><span class="line">常用选项</span><br><span class="line">  <span class="keyword">if</span>=file       <span class="built_in">read</span> from FILE instead of stdin</span><br><span class="line">  of=file       write to FILE instead of stdout</span><br><span class="line">  ibs=size      <span class="built_in">read</span> up to BYTES bytes at a time (default: 512)</span><br><span class="line">  obs=size      write BYTES bytes at a time (default: 512)</span><br><span class="line">  bs=size       <span class="built_in">read</span> and write up to BYTES bytes at a time (default: 512); overrides ibs and obs</span><br><span class="line">  cbs=size      convert BYTES bytes at a time</span><br><span class="line">  skip=N        skip N ibs-sized blocks at start of input</span><br><span class="line">  seek=N        skip N obs-sized blocks at start of output</span><br><span class="line">  count=N       copy only N input blocks</span><br><span class="line">  conv=conversion    convert the file as per the comma separated symbol list</span><br><span class="line">  </span><br><span class="line">  conversion 转换参数:</span><br><span class="line">    ascii    from EBCDIC to ASCII</span><br><span class="line">    ebcdic   from ASCII to EBCDIC</span><br><span class="line">    lcase    change upper <span class="keyword">case</span> to lower <span class="keyword">case</span></span><br><span class="line">    ucase    change lower <span class="keyword">case</span> to upper <span class="keyword">case</span></span><br><span class="line">    nocreat  <span class="keyword">do</span> not create the output file</span><br><span class="line">    noerror  <span class="built_in">continue</span> after <span class="built_in">read</span> errors</span><br><span class="line">    notrunc  <span class="keyword">do</span> not <span class="built_in">truncate</span> the output file</span><br><span class="line">    <span class="built_in">sync</span>     pad  every  input  block with NULs to ibs-size; when used with block or unblock, pad with spaces rather than NULs</span><br><span class="line">    fdatasync  physically write output file data before finishing</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat f1.txt f2.txt </span></span><br><span class="line">abcdefg</span><br><span class="line">123456789</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># dd if=f1.txt of=f2.txt bs=1 count=2 skip=3 seek=4</span></span><br><span class="line">2+0 records <span class="keyword">in</span></span><br><span class="line">2+0 records out</span><br><span class="line">2 bytes copied, 0.000114454 s, 17.5 kB/s</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat f2.txt </span></span><br><span class="line">1234de[root@Rocky8-mini ~]<span class="comment"># echo 123456789 &gt; f2.txt</span></span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat f1.txt f2.txt </span></span><br><span class="line">abcdefg</span><br><span class="line">123456789</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># dd if=f1.txt of=f2.txt bs=1 count=2 skip=3 seek=4 conv=notrunc</span></span><br><span class="line">2+0 records <span class="keyword">in</span></span><br><span class="line">2+0 records out</span><br><span class="line">2 bytes copied, 8.7494e-05 s, 22.9 kB/s</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># cat f2.txt </span></span><br><span class="line">1234de789</span><br></pre></td></tr></table></figure>

<p>示例2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份MBR</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda of=/tmp/mbr.bak bs=512 count=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 破坏MBR中的BootLoader</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/sda bs=64 count=1 seek=446</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有一个大于2K的二进制文件fileA。现想从第64个字节开始读取，需要读取128 Bytes。又有文件fileB，想将之前读取到的128 Bytes写入到第32字节开始的位置，替换128字节。</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=fileA of=fileB bs=1 count=128 skip=63 seek=31 conv=notrunc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将本地的/dev/sdx整盘备份到/dev/sdy中</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx of=/dev/sdy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将/dev/sdx全盘数据备份到指定路径的image文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx of=/PATH/TO/image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份/dev/sdx全盘数据，并利用gzip压缩，保存到指定路径</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdx | gzip &gt; /path/to/image.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将备份文件恢复到指定盘</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/path/to/image of=/dev/sdx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将压缩的备份文件恢复到指定盘</span></span><br><span class="line">gzip -dc /path/to/image.gz | <span class="built_in">dd</span> of=/dev/sdx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝光盘数据到root文件夹中，并保存为cdrom.iso文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/cdrom of=/root/cdrom.iso</span><br><span class="line"></span><br><span class="line"><span class="comment"># 销毁磁盘数据</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/urandom of=/dev/sda1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试硬盘写速度</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/root/1Gb.file bs=1024 count=1000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试硬盘读速度</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/root/1Gb.file bs=64k | <span class="built_in">dd</span> of=/dev/null</span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>1、创建一个2G的文件系统，块大小为2048byte，预留1%可用空间,文件系统ext4，卷标为TEST，要求此分区开机后自动挂载至&#x2F;test目录，且默认有acl挂载选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个2G大小的空间</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># fdisk /dev/sdb</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># lsblk /dev/sdb</span></span><br><span class="line">NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdb      8:16   0  20G  0 disk </span><br><span class="line">└─sdb1   8:17   0   2G  0 part</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建文件系统</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mke2fs -t ext4 -b 2048 -L &#x27;TEST&#x27; -m 1 /dev/sdb1</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># blkid /dev/sdb1</span></span><br><span class="line">/dev/sdb1: LABEL=<span class="string">&quot;TEST&quot;</span> UUID=<span class="string">&quot;de913645-871f-40bf-a737-820ace5def18&quot;</span> BLOCK_SIZE=<span class="string">&quot;2048&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;c4a635d0-01&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 持久挂载</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mkdir /test</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># vim /etc/fstab</span></span><br><span class="line">/dev/sdb1              /test                    ext4    acl             0 0</span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mount -a</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># df -Th /dev/sdb1</span></span><br><span class="line">Filesystem     Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sdb1      ext4  2.0G  9.1M  2.0G   1% /test</span><br></pre></td></tr></table></figure>

<h1 id="三、RAID"><a href="#三、RAID" class="headerlink" title="三、RAID"></a>三、RAID</h1><h2 id="3-1-什么是RAID"><a href="#3-1-什么是RAID" class="headerlink" title="3.1 什么是RAID"></a>3.1 什么是RAID</h2><p>独立硬盘冗余阵列（RAID, Redundant Array of Independent Disks），旧称廉价磁盘冗余阵列（Redundant Array of Inexpensive Disks），简称磁盘阵列。利用虚拟化存储技术把多个硬盘组合起来，成为一个或多个硬盘阵列组，目的为提升性能或数据冗余，或是两者同时提升。</p>
<p>RAID 层级不同，数据会以多种模式分散于各个硬盘，RAID 层级的命名会以 RAID 开头并带数字，例如：RAID 0、RAID 1、RAID 5、RAID 6、RAID 7、RAID 01、RAID 10、RAID 50、RAID 60。每种模式都有其理论上的优缺点，不同的等级在两个目标间获取平衡，分别是增加数据可靠性以及增加存储器（群）读写性能。</p>
<h2 id="3-2-RAID-级别"><a href="#3-2-RAID-级别" class="headerlink" title="3.2 RAID 级别"></a>3.2 RAID 级别</h2><h3 id="3-2-1-RAID-0"><a href="#3-2-1-RAID-0" class="headerlink" title="3.2.1 RAID 0"></a>3.2.1 RAID 0</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221121202456048.png" alt="image-20221121202456048" style="zoom:80%;" />

<p>条带卷<br>最少两块<br>可用空间：N * min(disk1, disk2, …)<br>无容错</p>
<h3 id="3-2-2-RAID-1"><a href="#3-2-2-RAID-1" class="headerlink" title="3.2.2 RAID 1"></a>3.2.2 RAID 1</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221121202550639.png" alt="image-20221121202550639" style="zoom:80%;" />

<p>读性能略有提升，写性能略有下降<br>利用率：50%<br>可用空间：1 * min(disk1, disk2, …)<br>有冗余<br>最少两块</p>
<h3 id="3-2-3-RAID-4"><a href="#3-2-3-RAID-4" class="headerlink" title="3.2.3 RAID 4"></a>3.2.3 RAID 4</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221121202614625.png" alt="image-20221121202614625" style="zoom:80%;" />

<p>其中一块磁盘保存其余磁盘信息的奇偶校验<br>利用率：(N-1)&#x2F;N<br>有冗余<br>至少3块</p>
<h3 id="3-2-4-RAID-5"><a href="#3-2-4-RAID-5" class="headerlink" title="3.2.4 RAID 5"></a>3.2.4 RAID 5</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221121202658516.png" alt="image-20221121202658516" style="zoom:80%;" />

<p>阵列数据的奇偶校验信息分布在阵列的所有磁盘上<br>利用率：(N-1)&#x2F;N<br>有容错<br>至少3块</p>
<h3 id="3-2-5-RAID-6"><a href="#3-2-5-RAID-6" class="headerlink" title="3.2.5 RAID 6"></a>3.2.5 RAID 6</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221121202720771.png" alt="image-20221121202720771" style="zoom:80%;" />

<p>类似于 RAID5，双奇偶校验信息位<br>利用率：(N-2)&#x2F;N<br>有容错<br>至少4块</p>
<h3 id="3-2-6-RAID-10"><a href="#3-2-6-RAID-10" class="headerlink" title="3.2.6 RAID 10"></a>3.2.6 RAID 10</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221121202756833.png" alt="image-20221121202756833" style="zoom:80%;" />

<p>多块磁盘先组合成 RAID 1，在两两组合成 RAID 0<br>至少4块</p>
<h3 id="3-2-7-RAID-01"><a href="#3-2-7-RAID-01" class="headerlink" title="3.2.7 RAID 01"></a>3.2.7 RAID 01</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221121202831767.png" alt="image-20221121202831767" style="zoom:80%;" />

<p>多块磁盘先组合成 RAID 0，在两两组合成 RAID 1<br>至少4块</p>
<h3 id="3-2-8-RAID-50"><a href="#3-2-8-RAID-50" class="headerlink" title="3.2.8 RAID 50"></a>3.2.8 RAID 50</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221121202903746.png" alt="image-20221121202903746" style="zoom:80%;" />

<p>多块磁盘先组合成 RAID 5，再组合成 RAID 0<br>至少6块</p>
<h3 id="3-2-9-RAID-60"><a href="#3-2-9-RAID-60" class="headerlink" title="3.2.9 RAID 60"></a>3.2.9 RAID 60</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221121202946490.png" alt="image-20221121202946490" style="zoom:80%;" />

<p>多块磁盘先组合成 RAID 6，再组合成 RAID 0<br>至少6块</p>
<h3 id="3-2-10-其它级别"><a href="#3-2-10-其它级别" class="headerlink" title="3.2.10 其它级别"></a>3.2.10 其它级别</h3><p><strong>JBOD：Just a Bunch Of Disks</strong></p>
<p>功能：将多块磁盘的空间合并成一个大的连续的空间使用<br>第一块磁盘存放所有磁盘的分段信息，如果损坏，整个阵列会失败；后续磁盘损坏只会影响本块磁盘的数据</p>
<p><strong>RAID 7</strong></p>
<p>RAID 7并非公开的RAID标准，而是Storage Computer Corporation的专利硬件产品名称，RAID 7是以RAID 3及RAID 4为基础所发展，但是经过强化以解决原来的一些限制。另外，在实现中使用大量的缓冲存储器以及用以实现异步数组管理的专用即时处理器，使得RAID 7可以同时处理大量的IO要求，所以性能甚至超越了许多其他RAID标准的实现产品。但也因为如此，在价格方面非常的高昂。</p>
<p><strong>SHR(Synology Hybrid RAID)</strong></p>
<p>群辉公司的技术，适合不了解RAID的普通用户，根据磁盘的个数自动组成不同的RAID，只支持群辉系统</p>
<h3 id="3-2-11-RAID-总结"><a href="#3-2-11-RAID-总结" class="headerlink" title="3.2.11 RAID 总结"></a>3.2.11 RAID 总结</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221127190830485.png" alt="image-20221127190830485"  />

<h1 id="四、逻辑卷管理器"><a href="#四、逻辑卷管理器" class="headerlink" title="四、逻辑卷管理器"></a>四、逻辑卷管理器</h1><h2 id="4-1-LVM-介绍"><a href="#4-1-LVM-介绍" class="headerlink" title="4.1 LVM 介绍"></a>4.1 LVM 介绍</h2><p>LVM：Logical Volume Manager 可以允许对卷进行方便操作的抽象层，包括重新设定文件系统的大小，允许在多个物理设备之间重新组织文件系统</p>
<p>实现过程：</p>
<ul>
<li>将设备指定成物理卷</li>
<li>用一个或多个物理卷组成一个卷组</li>
<li>在卷组中分配空间创建逻辑卷</li>
<li>逻辑卷中创建文件系统并挂载</li>
</ul>
<p>PV 加入到 VG 中后，VG 在逻辑层次上将空间划分成固定大小的块，称之为 PE（默认为 4M）；在 VG 上创建 LV 时，就是在 VG 中指定特定数量的 PE 来组织成 LV 的大小，当 PE 被分配给 LV 时，在 LV 中的存储概念称之为 LE。</p>
<p>物理区域–PE（Physical Extent）<br>    物理区域是物理卷中可⽤于分配的最⼩存储单元，物理区域的⼤⼩可根据实际情况在建⽴物理卷时指定。物理区域大小一旦确定将不能更改，同⼀卷组中的所有物理卷的物理区域⼤⼩需要⼀致。</p>
<p>逻辑区域―LE（Logical Extent）<br>    逻辑区域是逻辑卷中可⽤于分配的最⼩存储单元，逻辑区域的⼤⼩取决于逻辑卷所在卷组中的物理区域的⼤小。</p>
<h2 id="4-2-实现逻辑卷"><a href="#4-2-实现逻辑卷" class="headerlink" title="4.2 实现逻辑卷"></a>4.2 实现逻辑卷</h2><h3 id="4-2-1-pv-管理工具"><a href="#4-2-1-pv-管理工具" class="headerlink" title="4.2.1 pv 管理工具"></a>4.2.1 pv 管理工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建物理卷 pv</span></span><br><span class="line">pvcreate /dev/DEVICe</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示 pv 信息</span></span><br><span class="line">pvs</span><br><span class="line">pvdisplay</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 pv</span></span><br><span class="line">pvremove /dev/DEVICE</span><br></pre></td></tr></table></figure>

<h3 id="4-2-2-vg-管理工具"><a href="#4-2-2-vg-管理工具" class="headerlink" title="4.2.2 vg 管理工具"></a>4.2.2 vg 管理工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建卷组 vg</span></span><br><span class="line">vgcreate [-s <span class="comment">#[kKmMgGtTpPeE]] VolumeGroupName PhysicalDevicePath</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示卷组</span></span><br><span class="line">vgs</span><br><span class="line">vgdisplay</span><br><span class="line"></span><br><span class="line"><span class="comment"># 管理卷组</span></span><br><span class="line">vgextend VolumeGroupName PhysicalDevicePath</span><br><span class="line">vgreduce VolumeGroupName PhysicalDevicePath</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-lv-管理工具"><a href="#4-2-3-lv-管理工具" class="headerlink" title="4.2.3 lv 管理工具"></a>4.2.3 lv 管理工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示逻辑卷</span></span><br><span class="line">lvs</span><br><span class="line">lvdisplay</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建逻辑卷</span></span><br><span class="line">LVcreate -L <span class="comment">#[mMgGtT] -n NAME VolumeGroup</span></span><br><span class="line"><span class="comment">## 创建60%的lv大小</span></span><br><span class="line">lvcreate -l 60%VG -n mylv testvg</span><br><span class="line"><span class="comment">## 将卷组中剩余空间全部用于创建lv</span></span><br><span class="line">lvcreate -l 100%FREE -n lv2 testvg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除逻辑卷</span></span><br><span class="line">lvremove /dev/VGName/LVName</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新设定文件系统大小</span></span><br><span class="line">resize2fs [-f] [-F] [-M] [-P] [-p] device [new_size]</span><br><span class="line">xfs_growfs /mountpoint</span><br></pre></td></tr></table></figure>

<p><strong>示例：逻辑卷创建示例</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">1、创建分区并调整分区类型为8e</span><br><span class="line">[root@localhost ~]<span class="comment"># fdisk /dev/sdb</span></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): e                // 直接创建扩展分区</span><br><span class="line">Partition number (1-4, default 1): </span><br><span class="line">First sector (2048-10485759, default 2048): </span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-10485759, default 10485759): </span><br><span class="line">Using default value 10485759</span><br><span class="line">Partition 1 of <span class="built_in">type</span> Extended and of size 5 GiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n           </span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (0 primary, 1 extended, 3 free)</span><br><span class="line">   l   logical (numbered from 5)</span><br><span class="line">Select (default p): l                              // 在扩展分区上创建逻辑分区5,6,7,8,9</span><br><span class="line">Adding logical partition 6</span><br><span class="line">First sector (1030144-10485759, default 1030144): </span><br><span class="line">Using default value 1030144</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (1030144-10485759, default 10485759): +500M</span><br><span class="line">Partition 6 of <span class="built_in">type</span> Linux and of size 500 MiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): t                             // 调整分区类型             </span><br><span class="line">Partition number (1,5-9, default 9): 5</span><br><span class="line">Hex code (<span class="built_in">type</span> L to list all codes): 8e</span><br><span class="line">Changed <span class="built_in">type</span> of partition <span class="string">&#x27;Linux&#x27;</span> to <span class="string">&#x27;Linux LVM&#x27;</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line">Disk /dev/sdb: 5368 MB, 5368709120 bytes, 10485760 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x5372fd24</span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048    10485759     5241856    5  Extended</span><br><span class="line">/dev/sdb5            4096     1028095      512000   8e  Linux LVM</span><br><span class="line">/dev/sdb6         1030144     2054143      512000   8e  Linux LVM</span><br><span class="line">/dev/sdb7         2056192     3080191      512000   8e  Linux LVM</span><br><span class="line">/dev/sdb8         3082240     5179391     1048576   8e  Linux LVM</span><br><span class="line">/dev/sdb9         5181440    10485759     2652160   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w               // 保存退出</span><br><span class="line">The partition table has been altered!</span><br><span class="line">	</span><br><span class="line">2、刷新分区</span><br><span class="line">[root@localhost ~]<span class="comment"># partprobe /dev/sdb</span></span><br><span class="line">[root@localhost ~]<span class="comment"># lsblk /dev/sdb</span></span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdb      8:16   0    5G  0 disk </span><br><span class="line">├─sdb1   8:17   0    1K  0 part </span><br><span class="line">├─sdb5   8:21   0  500M  0 part </span><br><span class="line">├─sdb6   8:22   0  500M  0 part </span><br><span class="line">├─sdb7   8:23   0  500M  0 part </span><br><span class="line">├─sdb8   8:24   0    1G  0 part </span><br><span class="line">└─sdb9   8:25   0  2.5G  0 part </span><br><span class="line"></span><br><span class="line">3、创建 pv</span><br><span class="line">[root@localhost ~]<span class="comment"># pvcreate /dev/sdb&#123;5,6,7&#125;</span></span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sdb5&quot;</span> successfully created.</span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sdb6&quot;</span> successfully created.</span><br><span class="line">  Physical volume <span class="string">&quot;/dev/sdb7&quot;</span> successfully created.</span><br><span class="line">[root@localhost ~]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG     Fmt  Attr PSize   PFree  </span><br><span class="line">  /dev/sda2  centos lvm2 a--  &lt;19.00g      0 </span><br><span class="line">  /dev/sdb5         lvm2 ---  500.00m 500.00m</span><br><span class="line">  /dev/sdb6         lvm2 ---  500.00m 500.00m</span><br><span class="line">  /dev/sdb7         lvm2 ---  500.00m 500.00m</span><br><span class="line"></span><br><span class="line">4、创建 VG</span><br><span class="line">[root@localhost ~]<span class="comment"># vgcreate myvg /dev/sdb&#123;5,6&#125;</span></span><br><span class="line">  Volume group <span class="string">&quot;myvg&quot;</span> successfully created</span><br><span class="line">[root@localhost ~]<span class="comment"># vgs</span></span><br><span class="line">  VG     <span class="comment">#PV #LV #SN Attr   VSize   VFree  </span></span><br><span class="line">  centos   1   2   0 wz--n- &lt;19.00g      0 </span><br><span class="line">  myvg     2   0   0 wz--n- 992.00m 992.00m</span><br><span class="line">[root@localhost ~]<span class="comment"># vgextend myvg /dev/sdb7								// 扩展vg</span></span><br><span class="line">  Volume group <span class="string">&quot;myvg&quot;</span> successfully extended</span><br><span class="line"></span><br><span class="line">5、创建 LV</span><br><span class="line">[root@localhost ~]<span class="comment"># lvcreate -L 400M -n mylv myvg       // -L 大小 -n lv_name vg_name</span></span><br><span class="line">  Logical volume <span class="string">&quot;mylv&quot;</span> created.</span><br><span class="line">[root@localhost ~]<span class="comment"># lvs</span></span><br><span class="line">  LV   VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root centos -wi-ao---- &lt;17.00g                                                 </span><br><span class="line">  swap centos -wi-ao----   2.00g                                                 </span><br><span class="line">  mylv myvg   -wi-a----- 400.00m </span><br><span class="line">  </span><br><span class="line">6、创建文件系统</span><br><span class="line">[root@localhost ~]<span class="comment"># mke2fs -t ext4 -b 1024 -L MYLV /dev/myvg/mylv</span></span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=MYLV</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=1024 (<span class="built_in">log</span>=0)</span><br><span class="line">Fragment size=1024 (<span class="built_in">log</span>=0)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">102400 inodes, 409600 blocks</span><br><span class="line">20480 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=1</span><br><span class="line">Maximum filesystem blocks=34078720</span><br><span class="line">50 block <span class="built_in">groups</span></span><br><span class="line">8192 blocks per group, 8192 fragments per group</span><br><span class="line">2048 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">	8193, 24577, 40961, 57345, 73729, 204801, 221185, 401409</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span>                            </span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (8192 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span> </span><br><span class="line"></span><br><span class="line">7、挂载</span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/myvg/mylv /mnt/mylv.mount/</span></span><br><span class="line">[root@localhost mapper]<span class="comment"># lsblk /dev/sdb</span></span><br><span class="line">NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdb             8:16   0    5G  0 disk </span><br><span class="line">├─sdb1          8:17   0    1K  0 part </span><br><span class="line">├─sdb5          8:21   0  500M  0 part </span><br><span class="line">│ └─myvg-mylv 253:2    0  400M  0 lvm  /mnt/mylv.mount</span><br><span class="line">├─sdb6          8:22   0  500M  0 part </span><br><span class="line">├─sdb7          8:23   0  500M  0 part </span><br><span class="line">├─sdb8          8:24   0    1G  0 part </span><br><span class="line">└─sdb9          8:25   0  2.5G  0 part </span><br></pre></td></tr></table></figure>

<h3 id="4-2-4-扩展和缩减逻辑卷"><a href="#4-2-4-扩展和缩减逻辑卷" class="headerlink" title="4.2.4 扩展和缩减逻辑卷"></a>4.2.4 扩展和缩减逻辑卷</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 扩展和缩减准备</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># pvcreate /dev/sdb</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># vgcreate vg0 /dev/sdb </span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># lvcreate -L 1G -n mylv vg0</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mkfs.ext4 /dev/vg0/mylv</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mount /dev/vg0/mylv /mnt/mylv</span></span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># pvcreate /dev/sdc</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># vgcreate vg1 /dev/sdc</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># lvcreate -L 1G -n xfs_lv vg1</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mkfs.xfs /dev/vg1/xfs_lv</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mount /dev/vg1/xfs_lv /mnt/xfs_lv</span></span><br></pre></td></tr></table></figure>

<p><strong>1、扩展逻辑卷</strong></p>
<p>第一步先扩展逻辑卷的空间大小<br>第二步实现文件系统的扩展</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看逻辑卷 mylv 的大小</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># lvs /dev/vg0/mylv</span></span><br><span class="line">  LV   VG  Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  mylv vg0 -wi-ao---- 1.00g</span><br><span class="line"><span class="comment"># 查看卷组的剩余空间，如果空间不足需要先扩容卷组的空间</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># vgs /dev/vg0</span></span><br><span class="line">  VG  <span class="comment">#PV #LV #SN Attr   VSize   VFree  </span></span><br><span class="line">  vg0   1   1   0 wz--n- &lt;20.00g &lt;19.00g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展逻辑卷 mylv 的空间至3G</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># lvextend -L +2G /dev/vg0/mylv </span></span><br><span class="line">  Size of logical volume vg0/mylv changed from 1.00 GiB (256 extents) to 3.00 GiB (768 extents).</span><br><span class="line">  Logical volume vg0/mylv successfully resized.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实现 mylv 文件系统的扩展</span></span><br><span class="line"><span class="comment">## 对于 ext 系列文件系统使用 resize2fs 命令</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># resize2fs /dev/vg0/mylv</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># df -Th /dev/vg0/mylv </span></span><br><span class="line">Filesystem           Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg0-mylv ext4  3.0G  3.0M  2.8G   1% /mnt/mylv</span><br><span class="line"><span class="comment">## 对于 xfs 系列文件系统使用 xfs_growfs</span></span><br><span class="line"><span class="comment">## xfs 文件系统空间扩展同ext系列，大小由1G扩展到2G</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># xfs_growfs /mnt/xfs_lv/</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># df -Th /dev/vg1/xfs_lv </span></span><br><span class="line">Filesystem             Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg1-xfs_lv xfs   2.0G   47M  2.0G   3% /mnt/xfs_lv</span><br><span class="line"></span><br><span class="line"><span class="comment">### 文件系统扩展命令</span></span><br><span class="line">resize2fs /dev/VG_NAME/LV_NAME</span><br><span class="line">xfs_growfs MOUNTPOINT</span><br><span class="line"></span><br><span class="line"><span class="comment">### 不关注文件系统类型，一次性扩容并同步文件系统大小</span></span><br><span class="line"><span class="comment">#### 将卷组中剩余空间全部分配给指定逻辑卷</span></span><br><span class="line">lvresize -r -l +100%FREE /dev/VG_NAME/LV_NAME</span><br></pre></td></tr></table></figure>

<p><strong>2、缩减逻辑卷</strong></p>
<p>注：缩减有数据损坏的风险，建议先备份在缩减，xfs 文件系统不支持缩减</p>
<p>缩减逻辑卷相关过程命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">umount /dev/VG_NAME/LV_NAME</span><br><span class="line">e2fsck -f /dev/VG_NAME/LV_NAME</span><br><span class="line">resize2fs /dev/VG_NAME/LV_NAME <span class="comment">#[mMgGtT]</span></span><br><span class="line">lvreduce -L <span class="comment">#[mMgGtT] /dev/VG_NAME/LV_NAME</span></span><br><span class="line">mount /dev/VG_NAME/LV_NAME mountpoint</span><br></pre></td></tr></table></figure>

<p>示例：缩减ext系列文件系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以 /dev/mapper/vg0-mylv 为例</span></span><br><span class="line">[root@Rocky8-mini mnt]<span class="comment"># df -Th</span></span><br><span class="line">Filesystem             Type      Size  Used Avail Use% Mounted on</span><br><span class="line">devtmpfs               devtmpfs  877M     0  877M   0% /dev</span><br><span class="line">tmpfs                  tmpfs     896M     0  896M   0% /dev/shm</span><br><span class="line">tmpfs                  tmpfs     896M  8.8M  887M   1% /run</span><br><span class="line">tmpfs                  tmpfs     896M     0  896M   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/rl-root    xfs        30G  3.1G   27G  11% /</span><br><span class="line">/dev/sda1              xfs      1014M  212M  803M  21% /boot</span><br><span class="line">/dev/mapper/rl-data    ext4       17G   54M   16G   1% /data</span><br><span class="line">tmpfs                  tmpfs     180M     0  180M   0% /run/user/0</span><br><span class="line">/dev/mapper/vg0-mylv   ext4      3.0G  3.0M  2.8G   1% /mnt/mylv</span><br><span class="line">/dev/mapper/vg1-xfs_lv xfs       2.0G   47M  2.0G   3% /mnt/xfs_lv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消挂载</span></span><br><span class="line">[root@Rocky8-mini mnt]<span class="comment"># umount /mnt/mylv</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进行磁盘检查</span></span><br><span class="line">[root@Rocky8-mini mnt]<span class="comment"># fsck -f /dev/vg0/mylv </span></span><br><span class="line">fsck from util-linux 2.32.1</span><br><span class="line">e2fsck 1.45.6 (20-Mar-2020)</span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure</span><br><span class="line">Pass 3: Checking directory connectivity</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">Pass 5: Checking group summary information</span><br><span class="line">/dev/mapper/vg0-mylv: 11/196608 files (0.0% non-contiguous), 21308/786432 blocks</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缩减文件系统大小至2G</span></span><br><span class="line">[root@Rocky8-mini mnt]<span class="comment"># resize2fs /dev/vg0/mylv 2G</span></span><br><span class="line">resize2fs 1.45.6 (20-Mar-2020)</span><br><span class="line">Resizing the filesystem on /dev/vg0/mylv to 524288 (4k) blocks.</span><br><span class="line">The filesystem on /dev/vg0/mylv is now 524288 (4k) blocks long.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缩减逻辑卷空间大小</span></span><br><span class="line">[root@Rocky8-mini mnt]<span class="comment"># lvreduce -L 2G /dev/vg0/mylv </span></span><br><span class="line">  WARNING: Reducing active logical volume to 2.00 GiB.</span><br><span class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want to reduce vg0/mylv? [y/n]: y</span><br><span class="line">  Size of logical volume vg0/mylv changed from 3.00 GiB (768 extents) to 2.00 GiB (512 extents).</span><br><span class="line">  Logical volume vg0/mylv successfully resized.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新挂载该逻辑卷</span></span><br><span class="line">[root@Rocky8-mini mnt]<span class="comment"># mount /dev/vg0/mylv /mnt/mylv/</span></span><br><span class="line">[root@Rocky8-mini mnt]<span class="comment"># df -Th /mnt/mylv/</span></span><br><span class="line">Filesystem           Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg0-mylv ext4  2.0G  3.0M  1.9G   1% /mnt/mylv</span><br></pre></td></tr></table></figure>

<p>示例：缩减xfs系列文件系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># XFS文件系统不支持缩减，但可采取以下方法</span></span><br><span class="line"><span class="comment">## 使用xfsdump命令</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># yum -y install xfsdump</span></span><br><span class="line">[root@Rocky8-mini xfs_lv]<span class="comment"># ls</span></span><br><span class="line">file1  file2  file3  file4  file5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先备份xfs文件系统数据</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># xfsdump -f data.img /mnt/xfs_lv</span></span><br><span class="line">xfsdump: using file dump (drive_simple) strategy</span><br><span class="line">xfsdump: version 3.1.8 (dump format 3.0) - <span class="built_in">type</span> ^C <span class="keyword">for</span> status and control</span><br><span class="line"></span><br><span class="line"> ============================= dump label dialog ==============================</span><br><span class="line"></span><br><span class="line">please enter label <span class="keyword">for</span> this dump session (<span class="built_in">timeout</span> <span class="keyword">in</span> 300 sec)</span><br><span class="line"> -&gt; xfs_lv</span><br><span class="line">session label entered: <span class="string">&quot;xfs_lv&quot;</span></span><br><span class="line"></span><br><span class="line"> --------------------------------- end dialog ---------------------------------</span><br><span class="line"></span><br><span class="line">xfsdump: level 0 dump of Rocky8-mini:/mnt/xfs_lv</span><br><span class="line">xfsdump: dump <span class="built_in">date</span>: Wed Nov 23 20:36:58 2022</span><br><span class="line">xfsdump: session <span class="built_in">id</span>: 3a187a59-a2f2-4637-81dc-cd1090d16dea</span><br><span class="line">xfsdump: session label: <span class="string">&quot;xfs_lv&quot;</span></span><br><span class="line">xfsdump: ino map phase 1: constructing initial dump list</span><br><span class="line">xfsdump: ino map phase 2: skipping (no pruning necessary)</span><br><span class="line">xfsdump: ino map phase 3: skipping (only one dump stream)</span><br><span class="line">xfsdump: ino map construction complete</span><br><span class="line">xfsdump: estimated dump size: 22400 bytes</span><br><span class="line"></span><br><span class="line"> ============================= media label dialog =============================</span><br><span class="line"></span><br><span class="line">please enter label <span class="keyword">for</span> media <span class="keyword">in</span> drive 0 (<span class="built_in">timeout</span> <span class="keyword">in</span> 300 sec)</span><br><span class="line"> -&gt; q</span><br><span class="line">media label entered: <span class="string">&quot;q&quot;</span></span><br><span class="line"></span><br><span class="line"> --------------------------------- end dialog ---------------------------------</span><br><span class="line"></span><br><span class="line">xfsdump: creating dump session media file 0 (media 0, file 0)</span><br><span class="line">xfsdump: dumping ino map</span><br><span class="line">xfsdump: dumping directories</span><br><span class="line">xfsdump: dumping non-directory files</span><br><span class="line">xfsdump: ending media file</span><br><span class="line">xfsdump: media file size 22576 bytes</span><br><span class="line">xfsdump: dump size (non-dir files) : 0 bytes</span><br><span class="line">xfsdump: dump complete: 26 seconds elapsed</span><br><span class="line">xfsdump: Dump Summary:</span><br><span class="line">xfsdump:   stream 0 /root/data.img OK (success)</span><br><span class="line">xfsdump: Dump Status: SUCCESS</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消挂载</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># umount /mnt/xfs_lv </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 缩减逻辑卷大小</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># lvreduce -L 1G /dev/vg1/xfs_lv </span></span><br><span class="line">  WARNING: Reducing active logical volume to 1.00 GiB.</span><br><span class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want to reduce vg1/xfs_lv? [y/n]: y</span><br><span class="line">  Size of logical volume vg1/xfs_lv changed from 2.00 GiB (512 extents) to 1.00 GiB (256 extents).</span><br><span class="line">  Logical volume vg1/xfs_lv successfully resized.</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 重新创建文件系统</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mkfs.xfs -f /dev/vg1/xfs_lv </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新挂载</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mount /dev/vg1/xfs_lv /mnt/xfs_lv/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 还原数据</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># xfsrestore -f data.img /mnt/xfs_lv</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># ls /mnt/xfs_lv/</span></span><br><span class="line">file1  file2  file3  file4  file5</span><br></pre></td></tr></table></figure>

<h3 id="4-2-5-跨主机迁移卷组"><a href="#4-2-5-跨主机迁移卷组" class="headerlink" title="4.2.5 跨主机迁移卷组"></a>4.2.5 跨主机迁移卷组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 在源主机中，取消挂载所有的逻辑卷</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 禁用卷组</span></span><br><span class="line">vgchange -a n vg0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 导出卷组</span></span><br><span class="line">vgexport vg0</span><br><span class="line">pvscan</span><br><span class="line">vgdisplay</span><br><span class="line"></span><br><span class="line"><span class="comment">## 拆下旧硬盘在目标计算机上，并导入卷组</span></span><br><span class="line">vgimport vg0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启用卷组</span></span><br><span class="line">vgchange -ay vg0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 挂载所有卷组上的逻辑卷在迁移之后的新主机上</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-6-拆除指定的PV存储设备"><a href="#4-2-6-拆除指定的PV存储设备" class="headerlink" title="4.2.6 拆除指定的PV存储设备"></a>4.2.6 拆除指定的PV存储设备</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini etc]<span class="comment"># df -Th /mnt/mylv</span></span><br><span class="line">Filesystem           Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg0-mylv ext4  2.0G  3.0M  1.9G   1% /mnt/mylv</span><br><span class="line"></span><br><span class="line">[root@Rocky8-mini etc]<span class="comment"># umount /mnt/mylv</span></span><br><span class="line">[root@Rocky8-mini etc]<span class="comment"># lvremove /dev/vg0/mylv </span></span><br><span class="line">Do you really want to remove active logical volume vg0/mylv? [y/n]: y</span><br><span class="line">  Logical volume <span class="string">&quot;mylv&quot;</span> successfully removed.</span><br><span class="line">[root@Rocky8-mini etc]<span class="comment"># vgremove /dev/vg0</span></span><br><span class="line">  Volume group <span class="string">&quot;vg0&quot;</span> successfully removed          </span><br><span class="line">[root@Rocky8-mini etc]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG  Fmt  Attr PSize   PFree </span><br><span class="line">  /dev/sda2  rl  lvm2 a--  &lt;49.00g     0 </span><br><span class="line">  /dev/sdb       lvm2 ---   20.00g 20.00g</span><br><span class="line">  /dev/sdc   vg1 lvm2 a--  &lt;10.00g &lt;9.51g</span><br><span class="line">[root@Rocky8-mini etc]<span class="comment"># pvremove /dev/sdb </span></span><br><span class="line">  Labels on physical volume <span class="string">&quot;/dev/sdb&quot;</span> successfully wiped.</span><br></pre></td></tr></table></figure>

<h2 id="4-3-逻辑卷快照"><a href="#4-3-逻辑卷快照" class="headerlink" title="4.3 逻辑卷快照"></a>4.3 逻辑卷快照</h2><h3 id="4-3-1-逻辑卷快照工作原理"><a href="#4-3-1-逻辑卷快照工作原理" class="headerlink" title="4.3.1 逻辑卷快照工作原理"></a>4.3.1 逻辑卷快照工作原理</h3><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/image-20221124212331438.png" alt="image-20221124212331438" style="zoom:80%;" />

<p>快照是特殊的逻辑卷，它是在生成快照时存在的逻辑卷的准确拷贝,对于需要备份或者复制的现有数据临<br>时拷贝以及其它操作来说，快照是最合适的选择,快照只有在它们和原来的逻辑卷不同时才会消耗空间，<br>建立快照的卷大小小于等于原始逻辑卷,也可以使用lvextend扩展快照</p>
<p>逻辑卷管理器快照<br>快照就是将当时的系统信息记录下来，就好像照相一般，若将来有任何数据改动了，则原始数据会被移<br>动到快照区，没有改动的区域则由快照区和文件系统共享</p>
<p>逻辑卷快照工作原理</p>
<ul>
<li>在生成快照时会分配给它一定的空间，但只有在原来的逻辑卷或者快照有所改变才会使用这些空间</li>
<li>当原来的逻辑卷中有所改变时，会将旧的数据复制到快照中</li>
<li>快照中只含有原来的逻辑卷中更改的数据或者自生成快照后的快照中更改的数据</li>
</ul>
<p>由于快照区与原本的LV共用很多PE的区块，因此快照与被快照的LV必须在同一个VG中.系统恢复的时候<br>的文件数量不能高于快照区的实际容量</p>
<p>快照特点：</p>
<ul>
<li>备份速度快，瞬间完</li>
<li>应用场景是测试环境，不能完成代替备份</li>
<li>快照后，逻辑卷的修改速度会一定有影响</li>
</ul>
<h3 id="4-3-2-逻辑卷快照的实现"><a href="#4-3-2-逻辑卷快照的实现" class="headerlink" title="4.3.2 逻辑卷快照的实现"></a>4.3.2 逻辑卷快照的实现</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@Rocky8-mini ~]<span class="comment"># df -Th /mnt/xfs_lv</span></span><br><span class="line">Filesystem             Type  Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg1-xfs_lv xfs   495M   29M  466M   6% /mnt/xfs_lv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为该逻辑卷创建快照，ext4必须使用 -p r 实现只读</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># lvcreate -l 64 -s -n data-snapshot /dev/vg1/xfs_lv</span></span><br><span class="line">  Logical volume <span class="string">&quot;data-snapshot&quot;</span> created.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 挂载快照，xfs 需使用 -o ro 实现只读，防止快照被修改</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mkdir /mnt/snap         </span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># mount -o ro,nouuid /dev/vg1/data-snapshot /mnt/snap</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复快照</span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># umount /mnt/xfs_lv </span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># umount /mnt/snap </span></span><br><span class="line">[root@Rocky8-mini ~]<span class="comment"># lvconvert --merge /dev/vg1/data-snapshot </span></span><br><span class="line">  Merging of volume vg1/data-snapshot started.</span><br><span class="line">  vg1/xfs_lv: Merged: 100.00%</span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://wuhaolam.github.io">Wu Hao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wuhaolam.github.io/archives/50005d9f.html">https://wuhaolam.github.io/archives/50005d9f.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wuhaolam.github.io" target="_blank">穿着草鞋前往</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux%E5%9F%BA%E7%A1%80/">Linux基础</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/%E5%A4%B4%E5%83%8F.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/f82bde29.html" title="网卡名修改和静态IP地址配置"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">网卡名修改和静态IP地址配置</div></div></a></div><div class="next-post pull-right"><a href="/archives/c871820f.html" title="文件查找和打包压缩"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">文件查找和打包压缩</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/archives/c31ae19.html" title="Linux基础入门和帮助"><img class="cover" src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/rockyLinux.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-14</div><div class="title">Linux基础入门和帮助</div></div></a></div><div><a href="/archives/c871820f.html" title="文件查找和打包压缩"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-11</div><div class="title">文件查找和打包压缩</div></div></a></div><div><a href="/archives/8b87eef8.html" title="文本处理三剑客"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-17</div><div class="title">文本处理三剑客</div></div></a></div><div><a href="/archives/bd60744f.html" title="文本处理工具与正则表达式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-17</div><div class="title">文本处理工具与正则表达式</div></div></a></div><div><a href="/archives/be55afaa.html" title="软件管理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-11</div><div class="title">软件管理</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NzA1My8zMzUxNw=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Wu Hao</div><div class="author-info__description">欢迎来到吴浩的博客！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wuhaolam/" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wuhaolam@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://weibo.com/u/6551419807" rel="external nofollow noreferrer" target="_blank" title="微博"><i class="fa-brands fa-weibo"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">个人博客，仅供参考学习。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84"><span class="toc-text">一、磁盘结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E8%AE%BE%E5%A4%87%E6%96%87%E4%BB%B6"><span class="toc-text">1.1 设备文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%AE%A1%E7%90%86%E5%AD%98%E5%82%A8"><span class="toc-text">二、管理存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA"><span class="toc-text">2.1 磁盘分区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E5%88%86%E5%8C%BA%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-text">2.1.1 分区的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E5%88%86%E5%8C%BA%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">2.1.2 分区的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-1-MBR-%E5%88%86%E5%8C%BA"><span class="toc-text">2.1.2.1 MBR 分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-2-GPT-%E5%88%86%E5%8C%BA"><span class="toc-text">2.1.2.2 GPT 分区</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-BIOS-%E5%92%8C-UEFI"><span class="toc-text">2.1.3 BIOS 和 UEFI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-%E7%AE%A1%E7%90%86%E5%88%86%E5%8C%BA"><span class="toc-text">2.1.4 管理分区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-1-parted-%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1.4.1 parted 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-2-fdisk-%E5%92%8C-gdisk"><span class="toc-text">2.1.4.2 fdisk 和 gdisk</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-text">2.2 文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-text">2.2.1 什么是文件系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.2.2 文件系统类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86"><span class="toc-text">2.2.3 文件系统的组成部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E9%80%89%E6%8B%A9%E7%AE%A1%E7%90%86"><span class="toc-text">2.2.4 文件系统选择管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-1-%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-text">2.2.4.1 创建文件系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-2-%E6%9F%A5%E7%9C%8B%E5%92%8C%E7%AE%A1%E7%90%86%E5%88%86%E5%8C%BA%E4%BF%A1%E6%81%AF"><span class="toc-text">2.2.4.2 查看和管理分区信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-3-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A3%80%E6%B5%8B%E5%92%8C%E4%BF%AE%E5%A4%8D"><span class="toc-text">2.2.4.3 文件系统检测和修复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E6%8C%82%E8%BD%BD"><span class="toc-text">2.3 挂载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E6%8C%82%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-mount"><span class="toc-text">2.3.1 挂载文件系统 mount</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E5%8D%B8%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-umount"><span class="toc-text">2.3.2 卸载文件系统 umount</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E6%9F%A5%E7%9C%8B%E6%8C%82%E8%BD%BD%E6%83%85%E5%86%B5"><span class="toc-text">2.3.3 查看挂载情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E6%8C%81%E4%B9%85%E6%8C%82%E8%BD%BD"><span class="toc-text">2.3.4 持久挂载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%A4%84%E7%90%86%E4%BA%A4%E6%8D%A2%E6%96%87%E4%BB%B6%E5%92%8C%E5%88%86%E5%8C%BA"><span class="toc-text">2.4 处理交换文件和分区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-swap"><span class="toc-text">2.4.1 swap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E4%BA%A4%E6%8D%A2%E5%88%86%E5%8C%BA%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-text">2.4.2 交换分区的实现过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-swap-%E7%9A%84%E4%BD%BF%E7%94%A8%E7%AD%96%E7%95%A5"><span class="toc-text">2.4.3 swap 的使用策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E7%A3%81%E7%9B%98%E5%B8%B8%E8%A7%81%E5%B7%A5%E5%85%B7"><span class="toc-text">2.5 磁盘常见工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%99%85%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7-df"><span class="toc-text">2.5.1 文件系统实际占用空间查看工具 df</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-%E6%9F%A5%E7%9C%8B%E7%9B%AE%E5%BD%95%E7%A9%BA%E9%97%B4%E7%9A%84%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5-du"><span class="toc-text">2.5.2 查看目录空间的使用情况 du</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-3-dd-%E5%B7%A5%E5%85%B7"><span class="toc-text">2.5.3 dd 工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81RAID"><span class="toc-text">三、RAID</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BB%80%E4%B9%88%E6%98%AFRAID"><span class="toc-text">3.1 什么是RAID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-RAID-%E7%BA%A7%E5%88%AB"><span class="toc-text">3.2 RAID 级别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-RAID-0"><span class="toc-text">3.2.1 RAID 0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-RAID-1"><span class="toc-text">3.2.2 RAID 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-RAID-4"><span class="toc-text">3.2.3 RAID 4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-RAID-5"><span class="toc-text">3.2.4 RAID 5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-RAID-6"><span class="toc-text">3.2.5 RAID 6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-6-RAID-10"><span class="toc-text">3.2.6 RAID 10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-7-RAID-01"><span class="toc-text">3.2.7 RAID 01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-8-RAID-50"><span class="toc-text">3.2.8 RAID 50</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-9-RAID-60"><span class="toc-text">3.2.9 RAID 60</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-10-%E5%85%B6%E5%AE%83%E7%BA%A7%E5%88%AB"><span class="toc-text">3.2.10 其它级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-11-RAID-%E6%80%BB%E7%BB%93"><span class="toc-text">3.2.11 RAID 总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-text">四、逻辑卷管理器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-LVM-%E4%BB%8B%E7%BB%8D"><span class="toc-text">4.1 LVM 介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%8D%B7"><span class="toc-text">4.2 实现逻辑卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-pv-%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-text">4.2.1 pv 管理工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-vg-%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-text">4.2.2 vg 管理工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-lv-%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-text">4.2.3 lv 管理工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-%E6%89%A9%E5%B1%95%E5%92%8C%E7%BC%A9%E5%87%8F%E9%80%BB%E8%BE%91%E5%8D%B7"><span class="toc-text">4.2.4 扩展和缩减逻辑卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-%E8%B7%A8%E4%B8%BB%E6%9C%BA%E8%BF%81%E7%A7%BB%E5%8D%B7%E7%BB%84"><span class="toc-text">4.2.5 跨主机迁移卷组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-6-%E6%8B%86%E9%99%A4%E6%8C%87%E5%AE%9A%E7%9A%84PV%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87"><span class="toc-text">4.2.6 拆除指定的PV存储设备</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E9%80%BB%E8%BE%91%E5%8D%B7%E5%BF%AB%E7%85%A7"><span class="toc-text">4.3 逻辑卷快照</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-%E9%80%BB%E8%BE%91%E5%8D%B7%E5%BF%AB%E7%85%A7%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">4.3.1 逻辑卷快照工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-%E9%80%BB%E8%BE%91%E5%8D%B7%E5%BF%AB%E7%85%A7%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">4.3.2 逻辑卷快照的实现</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/40f861a5.html" title="一键编译安装Nginx1.8脚本">一键编译安装Nginx1.8脚本</a><time datetime="2023-03-19T08:21:53.797Z" title="发表于 2023-03-19 16:21:53">2023-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/10f0528f.html" title="二进制安装MySQL5.7">二进制安装MySQL5.7</a><time datetime="2023-02-27T01:22:00.000Z" title="发表于 2023-02-27 09:22:00">2023-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/d76dfaee.html" title="MySQL 数据库"><img src="https://cdn.jsdelivr.net/gh/wuhaolam/picgo_demo/img/mysql.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL 数据库"/></a><div class="content"><a class="title" href="/archives/d76dfaee.html" title="MySQL 数据库">MySQL 数据库</a><time datetime="2023-02-07T13:49:33.701Z" title="发表于 2023-02-07 21:49:33">2023-02-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/30f2a840.html" title="ssh 实现基于key验证">ssh 实现基于key验证</a><time datetime="2023-01-04T01:22:00.000Z" title="发表于 2023-01-04 09:22:00">2023-01-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/7ca84884.html" title="自签名CA证书并颁发应用证书">自签名CA证书并颁发应用证书</a><time datetime="2022-12-10T01:22:00.000Z" title="发表于 2022-12-10 09:22:00">2022-12-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By Wu Hao</div><div class="footer_custom_text"><div><a onclick="window.open('https://beian.miit.gov.cn')">皖ICP备2023003329号</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>